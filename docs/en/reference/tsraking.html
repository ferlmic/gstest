<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Restore cross-sectional (contemporaneous) aggregation constraints — tsraking • gstest</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Restore cross-sectional (contemporaneous) aggregation constraints — tsraking"><meta name="description" content="
Replication of the G-Series 2.0 SAS\(^\circledR\) TSRAKING procedure (PROC TSRAKING). See the
G-Series 2.0 documentation for details (Statistics Canada 2016).
This function will restore cross-sectional aggregation constraints in a system of time series. The
aggregation constraints may come from a 1 or 2-dimensional table. Optionally, temporal constraints
can also be preserved.
tsraking() is usually called in practice through tsraking_driver() in order to reconcile
all periods of the time series system in a single function call."><meta property="og:description" content="
Replication of the G-Series 2.0 SAS\(^\circledR\) TSRAKING procedure (PROC TSRAKING). See the
G-Series 2.0 documentation for details (Statistics Canada 2016).
This function will restore cross-sectional aggregation constraints in a system of time series. The
aggregation constraints may come from a 1 or 2-dimensional table. Optionally, temporal constraints
can also be preserved.
tsraking() is usually called in practice through tsraking_driver() in order to reconcile
all periods of the time series system in a single function call."><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gstest</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">3.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/gstest.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/benchmarking-cookbook.html">Benchmarking CookBook</a></li>
    <li><a class="dropdown-item" href="../articles/benchmarking-demo-script.html">A Beginner's Benchmarking Demo Script</a></li>
    <li><a class="dropdown-item" href="../articles/osqp-settings-sequence-dataframe.html">OSQP Settings Sequence Data Frame</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news"><li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ferlmic/gstest/tree/main/">G-Series 3.0 (latest - R package gstest 3.0.0)</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ferlmic/gstest/releases/tag/v2.0/">G-Series 2.0 (SAS® version)</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ferlmic/gstest/releases/tag/v1.04/">G-Series 1.04 (SAS® version)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ferlmic/gstest/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>

    <ul class="navbar-nav"><li class="nav-item"><a class="nav-link" href="#" onclick="window.location = location.href.replace('/en/','/fr/');"><span class="fa fa-language fa-lg"></span> Français</a></li></ul></div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Restore cross-sectional (contemporaneous) aggregation constraints</h1>
      <small class="dont-index">Source: <a href="https://github.com/ferlmic/gstest/tree/main/R/tsraking.R" class="external-link"><code>R/tsraking.R</code></a></small>
      <div class="d-none name"><code>tsraking.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p></p>
<p><em>Replication of the G-Series 2.0 SAS\(^\circledR\) TSRAKING procedure (PROC TSRAKING). See the
G-Series 2.0 documentation for details (Statistics Canada 2016).</em></p>
<p>This function will restore cross-sectional aggregation constraints in a system of time series. The
aggregation constraints may come from a 1 or 2-dimensional table. Optionally, temporal constraints
can also be preserved.</p>
<p><code>tsraking()</code> is usually called in practice through <code><a href="tsraking_driver.html">tsraking_driver()</a></code> in order to reconcile
all periods of the time series system in a single function call.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">tsraking</span><span class="op">(</span></span>
<span>  <span class="va">data_df</span>,</span>
<span>  <span class="va">metadata_df</span>,</span>
<span>  alterability_df <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  alterSeries <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  alterTotal1 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  alterTotal2 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  alterAnnual <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  tolV <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>  tolP <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  warnNegResult <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  tolN <span class="op">=</span> <span class="op">-</span><span class="fl">0.001</span>,</span>
<span>  id <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span></span>
<span>  <span class="co"># New in G-Series 3.0</span></span>
<span>  Vmat_option <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  warnNegInput <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data-df">data_df<a class="anchor" aria-label="anchor" href="#arg-data-df"></a></dt>
<dd><p>(mandatory)</p>
<p>Data frame, or object to be coerced to one, that contains the time series data to be reconciled. It must minimally
contain variables corresponding to the component series and cross-sectional control totals specified in the
metadata data frame (argument <code>metadata_df</code>). If more than one observation (period) is provided, the sum of
the provided component series values will also be preserved as part of implicit temporal constraints.</p></dd>


<dt id="arg-metadata-df">metadata_df<a class="anchor" aria-label="anchor" href="#arg-metadata-df"></a></dt>
<dd><p>(mandatory)</p>
<p>Data frame, or object to be coerced to one, that describes the cross-sectional aggregation constraints
(additivity rules) for the raking problem. Two character variables must be included in the metadata data frame:
<code>series</code> and <code>total1</code>. Two variables are optional: <code>total2</code> (character) and <code>alterAnnual</code> (numeric). The values
of variable <code>series</code> represent the variable names of the component series in the input time series data frame
(argument <code>data_df</code>). Similarly, the values of variables <code>total1</code> and <code>total2</code> represent the variable names of
the 1<sup>st</sup> and 2<sup>nd</sup> dimension cross-sectional control totals in the input time series data
frame. Variable <code>alterAnnual</code> contains the alterability coefficient for the temporal constraint associated to
each component series. When specified, the latter will override the default alterability coefficient specified
with argument <code>alterAnnual</code>.</p></dd>


<dt id="arg-alterability-df">alterability_df<a class="anchor" aria-label="anchor" href="#arg-alterability-df"></a></dt>
<dd><p>(optional)</p>
<p>Data frame, or object to be coerced to one, or <code>NULL</code>, that contains the alterability coefficients variables.
They must correspond to a component series or a cross-sectional control total, that is, a variable with the same
name must exist in the input time series data frame (argument <code>data_df</code>). The values of these alterability
coefficients will override the default alterability coefficients specified with arguments <code>alterSeries</code>,
<code>alterTotal1</code> and <code>alterTotal2</code>. When the input time series data frame contains several observations and the
alterability coefficients data frame contains only one, the alterability coefficients are used (repeated) for
all observations of the input time series data frame. Alternatively, the alterability coefficients data frame
may contain as many observations as the input time series data frame.</p>
<p><strong>Default value</strong> is <code>alterability_df = NULL</code> (default alterability coefficients).</p></dd>


<dt id="arg-alterseries">alterSeries<a class="anchor" aria-label="anchor" href="#arg-alterseries"></a></dt>
<dd><p>(optional)</p>
<p>Nonnegative real number specifying the default alterability coefficient for the component series values. It
will apply to component series for which alterability coefficients have not already been specified in the
alterability coefficients data frame (argument <code>alterability_df</code>).</p>
<p><strong>Default value</strong> is <code>alterSeries = 1.0</code> (nonbinding component series values).</p></dd>


<dt id="arg-altertotal-">alterTotal1<a class="anchor" aria-label="anchor" href="#arg-altertotal-"></a></dt>
<dd><p>(optional)</p>
<p>Nonnegative real number specifying the default alterability coefficient for the 1<sup>st</sup> dimension
cross-sectional control totals. It will apply to cross-sectional control totals for which alterability
coefficients have not already been specified in the alterability coefficients data frame (argument
<code>alterability_df</code>).</p>
<p><strong>Default value</strong> is <code>alterTotal1 = 0.0</code> (binding 1<sup>st</sup> dimension cross-sectional control totals)</p></dd>


<dt id="arg-altertotal-">alterTotal2<a class="anchor" aria-label="anchor" href="#arg-altertotal-"></a></dt>
<dd><p>(optional)</p>
<p>Nonnegative real number specifying the default alterability coefficient for the 2<sup>nd</sup> dimension
cross-sectional control totals. It will apply to cross-sectional control totals for which alterability
coefficients have not already been specified in the alterability coefficients data frame (argument
<code>alterability_df</code>).</p>
<p><strong>Default value</strong> is <code>alterTotal2 = 0.0</code> (binding 2<sup>nd</sup> dimension cross-sectional control totals).</p></dd>


<dt id="arg-alterannual">alterAnnual<a class="anchor" aria-label="anchor" href="#arg-alterannual"></a></dt>
<dd><p>(optional)</p>
<p>Nonnegative real number specifying the default alterability coefficient for the component series temporal
constraints (e.g., annual totals). It will apply to component series for which alterability coefficients
have not already been specified in the metadata data frame (argument <code>metadata_df</code>).</p>
<p><strong>Default value</strong> is <code>alterAnnual = 0.0</code> (binding temporal control totals).</p></dd>


<dt id="arg-tolv-tolp">tolV, tolP<a class="anchor" aria-label="anchor" href="#arg-tolv-tolp"></a></dt>
<dd><p>(optional)</p>
<p>Nonnegative real number, or <code>NA</code>, specifying the tolerance, in absolute value or percentage, to be used
when performing the ultimate test in the case of binding totals (alterability coefficient of \(0.0\)
for temporal or cross-sectional control totals). The test compares the input binding control totals with
the ones calculated from the reconciled (output) component series. Arguments <code>tolV</code> and <code>tolP</code> cannot be both
specified together (one must be specified while the other must be <code>NA</code>).</p>
<p><strong>Example:</strong> to set a tolerance of 10 <em>units</em>, specify <code>tolV = 10, tolP = NA</code>; to set a tolerance of 1%,
specify <code>tolV = NA, tolP = 0.01</code>.</p>
<p><strong>Default values</strong> are <code>tolV = 0.001</code> and <code>tolP = NA</code>.</p></dd>


<dt id="arg-warnnegresult">warnNegResult<a class="anchor" aria-label="anchor" href="#arg-warnnegresult"></a></dt>
<dd><p>(optional)</p>
<p>Logical argument specifying whether a warning message is generated when a negative value created by the
function in the reconciled (output) series is smaller than the threshold specified by argument <code>tolN</code>.</p>
<p><strong>Default value</strong> is <code>warnNegResult = TRUE</code>.</p></dd>


<dt id="arg-toln">tolN<a class="anchor" aria-label="anchor" href="#arg-toln"></a></dt>
<dd><p>(optional)</p>
<p>Negative real number specifying the threshold for the identification of negative values. A value is
considered negative when it is smaller than this threshold.</p>
<p><strong>Default value</strong> is <code>tolN = -0.001</code>.</p></dd>


<dt id="arg-id">id<a class="anchor" aria-label="anchor" href="#arg-id"></a></dt>
<dd><p>(optional)</p>
<p>String vector (minimum length of 1), or <code>NULL</code>, specifying the name of additional variables to be transferred
from the input time series data frame (argument <code>data_df</code>) to the output time series data frame, the
object returned by the function (see section <strong>Value</strong>). By default, the output series data frame only contains
the variables listed in the metadata data frame (argument <code>metadata_df</code>).</p>
<p><strong>Default value</strong> is <code>id = NULL</code>.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>(optional)</p>
<p>Logical argument specifying whether information on intermediate steps with execution time (real time,
not CPU time) should be displayed. Note that specifying argument <code>quiet = TRUE</code> would <em>nullify</em> argument
<code>verbose</code>.</p>
<p><strong>Default value</strong> is <code>verbose = FALSE</code>.</p></dd>


<dt id="arg-vmat-option">Vmat_option<a class="anchor" aria-label="anchor" href="#arg-vmat-option"></a></dt>
<dd><p>(optional)</p>
<p>Specification of the option for the variance matrices (\(V_e\) and \(V_\epsilon\); see section <strong>Details</strong>):</p><table class="table table"><tr><td><strong>Value</strong></td><td><strong>Description</strong></td></tr><tr><td><code>1</code></td><td>Use vectors \(x\) and \(g\) in the variance matrices.</td></tr><tr><td><code>2</code></td><td>Use vectors \(|x|\) and \(|g|\) in the variance matrices.</td></tr></table><p>See Ferland (2016) and subsection <strong>Arguments <code>Vmat_option</code> and <code>warnNegInput</code></strong> in section <strong>Details</strong> for
more information.</p>
<p><strong>Default value</strong> is <code>Vmat_option = 1</code>.</p></dd>


<dt id="arg-warnneginput">warnNegInput<a class="anchor" aria-label="anchor" href="#arg-warnneginput"></a></dt>
<dd><p>(optional)</p>
<p>Logical argument specifying whether a warning message is generated when a negative value smaller than
the threshold specified by argument <code>tolN</code> is found in the input time series data frame (argument <code>data_df</code>).</p>
<p><strong>Default value</strong> is <code>warnNegInput = TRUE</code>.</p></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p>(optional)</p>
<p>Logical argument specifying whether or not to display only essential information such as warnings and errors.
Specifying <code>quiet = TRUE</code> would also <em>nullify</em> argument <code>verbose</code> and is equivalent to <em>wrapping</em> your
<code>tsraking()</code> call with <code><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages()</a></code>.</p>
<p><strong>Default value</strong> is <code>quiet = FALSE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The function returns a data frame containing the reconciled component series, reconciled cross-sectional control
totals and variables specified with  argument <code>id</code>. Note that the "data.frame" object can be explicitly coerced to
another type of object with the appropriate <code>as*()</code> function (e.g., <code><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">tibble::as_tibble()</a></code> would coerce it to a tibble).</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function returns the generalized least squared solution of a specific, simple variant of the general
regression-based raking model proposed by Dagum and Cholette (Dagum and Cholette 2006). The model, in matrix form, is:
$$\displaystyle
\begin{bmatrix} x \\ g \end{bmatrix} =
\begin{bmatrix} I \\ G \end{bmatrix} \theta +
\begin{bmatrix} e \\ \varepsilon \end{bmatrix}
$$
where</p><ul><li><p>\(x\) is the vector of the initial component series values.</p></li>
<li><p>\(\theta\) is the vector of the final (reconciled) component series values.</p></li>
<li><p>\(e \sim \left( 0, V_e \right)\) is the vector of the measurement errors of \(x\) with covariance
matrix \(V_e = \mathrm{diag} \left( c_x x \right)\), or \(V_e = \mathrm{diag} \left( \left|
c_x x \right| \right)\) when argument <code>Vmat_option = 2</code>, where \(c_x\) is the vector of the
alterability coefficients of \(x\).</p></li>
<li><p>\(g\) is the vector of the initial control totals, including the component series temporal totals (when
applicable).</p></li>
<li><p>\(\varepsilon \sim (0, V_\varepsilon)\) is the vector of the measurement errors of
\(g\) with covariance matrix \(V_\varepsilon = \mathrm{diag} \left( c_g g \right)\), or
\(V_\varepsilon = \mathrm{diag} \left( \left| c_g g \right| \right)\) when argument
<code>Vmat_option = 2</code>, where \(c_g\) is the vector of the alterability coefficients of \(g\).</p></li>
<li><p>\(G\) is the matrix of aggregation constraints, including the implicit temporal constraints (when applicable).</p></li>
</ul><p>The generalized least squared solution is:
$$\displaystyle
\hat{\theta} = x + V_e G^{\mathrm{T}} \left( G V_e G^{\mathrm{T}} + V_\varepsilon \right)^+ \left( g - G x \right)
$$
where \(A^{+}\) designates the Moore-Penrose inverse of matrix \(A\).</p>
<p><code>tsraking()</code> solves a single raking problem, i.e., either a single period of the time series system, or a single
temporal group (e.g., all periods of a given year) when temporal total preservation is required. Several call to
<code>tsraking()</code> are therefore necessary in order to reconcile all the periods of the time series system.
<code><a href="tsraking_driver.html">tsraking_driver()</a></code> can achieve this in a single call: it conveniently determines the required set of raking
problems to be solved and internally generates the individual calls to <code>tsraking()</code>.</p><div class="section">
<h3 id="alterability-coefficients">Alterability Coefficients<a class="anchor" aria-label="anchor" href="#alterability-coefficients"></a></h3>


<p>Alterability coefficients \(c_x\) and \(c_g\) conceptually represent the measurement errors associated with the
input component series values \(x\) and control totals \(g\) respectively. They are nonnegative real numbers which,
in practice, specify the extent to which an initial value can be modified in relation to other values. Alterability
coefficients of \(0.0\) define fixed (binding) values while alterability coefficients greater than \(0.0\) define
free (nonbinding) values. Increasing the alterability coefficient of an intial value results in more changes for that
value in the reconciled (output) data and, conversely, less changes when decreasing the alterability coefficient. The
default alterability coefficients are \(1.0\) for the component series values and \(0.0\) for the cross-sectional
control totals and, when applicable, the component series temporal totals. These default alterability coefficients
result in a proportional allocation of the discrepancies to the component series. Setting the component series
alterability coefficients to the inverse of the component series initial values would result in a uniform allocation
of the discrepancies instead. <em>Almost binding</em> totals can be obtained in practice by specifying very small
(almost \(0.0\)) alterability coefficients relative to those of the (nonbinding) component series.</p>
<p><strong>Temporal total preservation</strong> refers to the fact that temporal totals, when applicable, are usually kept
“as close as possible” to their initial value. <em>Pure preservation</em> is achieved by default with binding temporal
totals while the change is minimized with nonbinding temporal totals (in accordance with the set of alterability
coefficients).</p>
</div>

<div class="section">
<h3 id="arguments-vmat-option-and-warnneginput">Arguments <code>Vmat_option</code> and <code>warnNegInput</code><a class="anchor" aria-label="anchor" href="#arguments-vmat-option-and-warnneginput"></a></h3>


<p>These arguments allow for an alternative handling of negative values in the input data, similar to that of <code><a href="tsbalancing.html">tsbalancing()</a></code>.
Their default values correspond to the G-Series 2.0 behaviour (SAS\(^\circledR\) PROC TSRAKING) for which equivalent
options are not defined. The latter was developed with "nonnegative input data only" in mind, similar to SAS\(^\circledR\)
PROC BENCHMARKING in G-Series 2.0 that did not allow negative values either with proportional benchmarking, which explains
the "suspicious use of proportional raking" warning in presence of negative values with PROC TSRAKING in G-Series 2.0 and
when <code>warnNegInput = TRUE</code> (default). However, (proportional) raking in the presence of negative values generally works well
with <code>Vmat_option = 2</code> and produces reasonable, intuitive solutions. E.g., while the default <code>Vmat_option = 1</code> fails at
solving constraint <code>A + B = C</code> with input data <code>A = 2</code>, <code>B = -2</code>, <code>C = 1</code> and the default alterability coefficients,
<code>Vmat_option = 2</code> returns the (intuitive) solution <code>A = 2.5</code>, <code>B = -1.5</code>, <code>C = 1</code> (25% increase for <code>A</code> and <code>B</code>). See
Ferland (2016) for more details.</p>
</div>

<div class="section">
<h3 id="treatment-of-missing-na-values">Treatment of Missing (<code>NA</code>) Values<a class="anchor" aria-label="anchor" href="#treatment-of-missing-na-values"></a></h3>


<p>Missing values in the input time series data frame (argument <code>data_df</code>) or alterability coefficients data frame
(argument <code>alterability_df</code>) for any of the raking problem data (variables listed in the metadata data frame
with argument <code>metadata_df</code>) will generate an error message and stop the function execution.</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="comparing-tsraking-and-tsbalancing-">Comparing <code>tsraking()</code> and <code><a href="tsbalancing.html">tsbalancing()</a></code><a class="anchor" aria-label="anchor" href="#comparing-tsraking-and-tsbalancing-"></a></h2>

<ul><li><p><code>tsraking()</code> is limited to one- and two-dimensional aggregation table raking problems (with temporal total
preservation if required) while <code><a href="tsbalancing.html">tsbalancing()</a></code> handles more general balancing problems (e.g., higher dimensional
raking problems, nonnegative solutions, general linear equality and inequality constraints as opposed to aggregation
rules only, etc.).</p></li>
<li><p><code>tsraking()</code> returns the generalized least squared solution of the Dagum and Cholette regression-based raking
model (Dagum and Cholette 2006) while <code><a href="tsbalancing.html">tsbalancing()</a></code> solves the corresponding quadratic minimization problem using
a numerical solver. In most cases, <em>convergence to the minimum</em> is achieved and the <code><a href="tsbalancing.html">tsbalancing()</a></code> solution matches
the (exact) <code>tsraking()</code> least square solution. It may not be the case, however, if convergence could not be achieved
after a reasonable number of iterations. Having said that, only in very rare occasions will the <code><a href="tsbalancing.html">tsbalancing()</a></code>
solution <em>significantly</em> differ from the <code>tsraking()</code> solution.</p></li>
<li><p><code><a href="tsbalancing.html">tsbalancing()</a></code> is usually faster than <code>tsraking()</code>, especially for large raking problems, but is generally more
sensitive to the presence of (small) inconsistencies in the input data associated to the redundant constraints of
fully specified (over-specified) raking problems. <code>tsraking()</code> handles these inconsistencies by using the
Moore-Penrose inverse (uniform distribution among all binding totals).</p></li>
<li><p><code><a href="tsbalancing.html">tsbalancing()</a></code> accommodates the specification of sparse problems in their reduced form. This is not true in the
case of <code>tsraking()</code> where aggregation rules must always be fully specified since a <em>complete data cube</em> without
missing data is expected as input (every single <em>inner-cube</em> component series must contribute to all dimensions of
the cube, i.e., to every single <em>outer-cube</em> marginal total series).</p></li>
<li><p>Both tools handle negative values in the input data differently by default. While the solutions of raking problems
obtained from <code><a href="tsbalancing.html">tsbalancing()</a></code> and <code>tsraking()</code> are identical when all input data points are positive, they will
differ if some data points are negative (unless argument <code>Vmat_option = 2</code> is specified with <code>tsraking()</code>).</p></li>
<li><p>While both <code><a href="tsbalancing.html">tsbalancing()</a></code> and <code>tsraking()</code> allow the preservation of temporal totals, time management is not
incorporated in <code>tsraking()</code>. For example, the construction of the processing groups (sets of periods of each raking
problem) is left to the user with <code>tsraking()</code> and separate calls must be submitted for each processing group (each
raking problem). That's where helper function <code><a href="tsraking_driver.html">tsraking_driver()</a></code> comes in handy with <code>tsraking()</code>.</p></li>
<li><p><code><a href="tsbalancing.html">tsbalancing()</a></code> returns the same set of series as the input time series object while <code>tsraking()</code> returns the set
of series involved in the raking problem plus those specified with argument <code>id</code> (which could correspond to a subset
of the input series).</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Bérubé, J. and S. Fortier (2009). "PROC TSRAKING: An in-house SAS\(^\circledR\) procedure for balancing
time series". In <strong>JSM Proceedings, Business and Economic Statistics Section</strong>. Alexandria, VA: American Statistical
Association.</p>
<p>Dagum, E. B. and P. Cholette (2006). <strong>Benchmarking, Temporal Distribution and Reconciliation Methods
of Time Series</strong>. Springer-Verlag, New York, Lecture Notes in Statistics, Vol. 186.</p>
<p>Ferland, M. (2016). "Negative Values with PROC TSRAKING". <strong>Internal document</strong>. Statistics Canada, Ottawa,
Canada.</p>
<p>Fortier, S. and B. Quenneville (2009). "Reconciliation and Balancing of Accounts and Time Series".
In <strong>JSM Proceedings, Business and Economic Statistics Section</strong>. Alexandria, VA: American Statistical Association.</p>
<p>Quenneville, B. and S. Fortier (2012). "Restoring Accounting Constraints in Time Series – Methods and
Software for a Statistical Agency". <strong>Economic Time Series: Modeling and Seasonality</strong>. Chapman &amp; Hall, New York.</p>
<p>Statistics Canada (2016). "The TSRAKING Procedure". <strong>G-Series 2.0 User Guide</strong>. Statistics Canada,
Ottawa, Canada.</p>
<p>Statistics Canada (2018). <strong>Theory and Application of Reconciliation (Course code 0437)</strong>.
Statistics Canada, Ottawa, Canada.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="tsraking_driver.html">tsraking_driver()</a></code> <code><a href="tsbalancing.html">tsbalancing()</a></code> <code><a href="rkMeta_to_blSpecs.html">rkMeta_to_blSpecs()</a></code> <code><a href="gs.gInv_MP.html">gs.gInv_MP()</a></code> <code><a href="build_raking_problem.html">build_raking_problem()</a></code> <a href="aliases.html">aliases</a></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">###########</span></span></span>
<span class="r-in"><span><span class="co"># Example 1: Simple 1-dimensional raking problem where the values of `cars` and `vans`</span></span></span>
<span class="r-in"><span><span class="co">#            must sum up to the value of `total`.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Problem metadata</span></span></span>
<span class="r-in"><span><span class="va">my_metadata1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>series <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cars"</span>, <span class="st">"vans"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           total1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"total"</span>, <span class="st">"total"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">my_metadata1</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   series total1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   cars  total</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   vans  total</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Problem data</span></span></span>
<span class="r-in"><span><span class="va">my_series1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>cars <span class="op">=</span> <span class="fl">25</span>, vans <span class="op">=</span> <span class="fl">5</span>, total <span class="op">=</span> <span class="fl">40</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Reconcile the data</span></span></span>
<span class="r-in"><span><span class="va">out_raked1</span> <span class="op">&lt;-</span> <span class="fu">tsraking</span><span class="op">(</span><span class="va">my_series1</span>, <span class="va">my_metadata1</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> --- Package gstest 3.0.0 - (EN) 'G-Series' in 'R' | (FR) 'G-Séries' en 'R' ---</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Created on April 8, 2025, at 3:40:01 PM EDT</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> URL: https://ferlmic.github.io/gstest/en/</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>      https://ferlmic.github.io/gstest/fr/</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Email: g-series@statcan.gc.ca</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> tsraking() function:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     data_df         = my_series1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     metadata_df     = my_metadata1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterability_df = NULL (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterSeries     = 1 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterTotal1     = 0 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterTotal2     = 0 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterAnnual     = 0 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     tolV            = 0.001 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     warnNegResult   = TRUE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     tolN            = -0.001 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     id              = NULL (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     verbose         = FALSE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)Vmat_option  = 1 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)warnNegInput = TRUE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)quiet        = FALSE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*) indicates new arguments in G-Series 3.0</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Initial data</span></span></span>
<span class="r-in"><span><span class="va">my_series1</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   cars vans total</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   25    5    40</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Reconciled data</span></span></span>
<span class="r-in"><span><span class="va">out_raked1</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       cars     vans total</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 33.33333 6.666667    40</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Check the output cross-sectional constraint</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">out_raked1</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cars"</span>, <span class="st">"vans"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, <span class="va">out_raked1</span><span class="op">$</span><span class="va">total</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Check the control total (fixed)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">my_series1</span><span class="op">$</span><span class="va">total</span>, <span class="va">out_raked1</span><span class="op">$</span><span class="va">total</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">###########</span></span></span>
<span class="r-in"><span><span class="co"># Example 2: 2-dimensional raking problem similar to the 1st example but adding</span></span></span>
<span class="r-in"><span><span class="co">#            regional sales for the 3 prairie provinces (Alb., Sask. and Man.)</span></span></span>
<span class="r-in"><span><span class="co">#            and where the sales of vans in Sask. are non-alterable</span></span></span>
<span class="r-in"><span><span class="co">#            (alterability coefficient = 0), with `quiet = TRUE` to avoid</span></span></span>
<span class="r-in"><span><span class="co">#            displaying the function header.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Problem metadata</span></span></span>
<span class="r-in"><span><span class="va">my_metadata2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>series <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cars_alb"</span>, <span class="st">"cars_sask"</span>, <span class="st">"cars_man"</span>,</span></span>
<span class="r-in"><span>                                      <span class="st">"vans_alb"</span>, <span class="st">"vans_sask"</span>, <span class="st">"vans_man"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           total1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"cars_total"</span>, <span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                      <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"vans_total"</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           total2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alb_total"</span>, <span class="st">"sask_total"</span>, <span class="st">"man_total"</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">my_metadata2</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      series     total1     total2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  cars_alb cars_total  alb_total</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 cars_sask cars_total sask_total</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  cars_man cars_total  man_total</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  vans_alb vans_total  alb_total</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 vans_sask vans_total sask_total</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  vans_man vans_total  man_total</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Problem data</span></span></span>
<span class="r-in"><span><span class="va">my_series2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>cars_alb <span class="op">=</span> <span class="fl">12</span>, cars_sask <span class="op">=</span> <span class="fl">14</span>, cars_man <span class="op">=</span> <span class="fl">13</span>,</span></span>
<span class="r-in"><span>                         vans_alb <span class="op">=</span> <span class="fl">20</span>, vans_sask <span class="op">=</span> <span class="fl">20</span>, vans_man <span class="op">=</span> <span class="fl">24</span>,</span></span>
<span class="r-in"><span>                         alb_total <span class="op">=</span> <span class="fl">30</span>, sask_total <span class="op">=</span> <span class="fl">31</span>, man_total <span class="op">=</span> <span class="fl">32</span>,</span></span>
<span class="r-in"><span>                         cars_total <span class="op">=</span> <span class="fl">40</span>, vans_total <span class="op">=</span> <span class="fl">53</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Reconciled data</span></span></span>
<span class="r-in"><span><span class="va">out_raked2</span> <span class="op">&lt;-</span> <span class="fu">tsraking</span><span class="op">(</span><span class="va">my_series2</span>, <span class="va">my_metadata2</span>,</span></span>
<span class="r-in"><span>                       alterability_df <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>vans_sask <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                       quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Initial data</span></span></span>
<span class="r-in"><span><span class="va">my_series2</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   cars_alb cars_sask cars_man vans_alb vans_sask vans_man alb_total sask_total</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1       12        14       13       20        20       24        30         31</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   man_total cars_total vans_total</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        32         40         53</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Reconciled data</span></span></span>
<span class="r-in"><span><span class="va">out_raked2</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   cars_alb cars_sask cars_man vans_alb vans_sask vans_man alb_total sask_total</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 14.31298        11 14.68702 15.68702        20 17.31298        30         31</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   man_total cars_total vans_total</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        32         40         53</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Check the output cross-sectional constraints</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">out_raked2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cars_alb"</span>, <span class="st">"cars_sask"</span>, <span class="st">"cars_man"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, <span class="va">out_raked2</span><span class="op">$</span><span class="va">cars_total</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">out_raked2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"vans_alb"</span>, <span class="st">"vans_sask"</span>, <span class="st">"vans_man"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, <span class="va">out_raked2</span><span class="op">$</span><span class="va">vans_total</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">out_raked2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cars_alb"</span>, <span class="st">"vans_alb"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, <span class="va">out_raked2</span><span class="op">$</span><span class="va">alb_total</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">out_raked2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cars_sask"</span>, <span class="st">"vans_sask"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, <span class="va">out_raked2</span><span class="op">$</span><span class="va">sask_total</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">out_raked2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cars_man"</span>, <span class="st">"vans_man"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, <span class="va">out_raked2</span><span class="op">$</span><span class="va">man_total</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Check the control totals (fixed)</span></span></span>
<span class="r-in"><span><span class="va">tot_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">union</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">my_metadata2</span><span class="op">$</span><span class="va">total1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">my_metadata2</span><span class="op">$</span><span class="va">total2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">my_series2</span><span class="op">[</span><span class="va">tot_cols</span><span class="op">]</span>, <span class="va">out_raked2</span><span class="op">[</span><span class="va">tot_cols</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Check the value of vans in Saskatchewan (fixed at 20)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">my_series2</span><span class="op">$</span><span class="va">vans_sask</span>, <span class="va">out_raked2</span><span class="op">$</span><span class="va">vans_sask</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michel Ferland, Statistics Canada.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

