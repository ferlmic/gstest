<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>OSQP Settings Sequence Data Frame • gstest</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="OSQP Settings Sequence Data Frame">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gstest</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">3.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/gstest.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/benchmarking-cookbook.html">Benchmarking CookBook</a></li>
    <li><a class="dropdown-item" href="../articles/benchmarking-demo-script.html">A Beginner's Benchmarking Demo Script</a></li>
    <li><a class="dropdown-item" href="../articles/osqp-settings-sequence-dataframe.html">OSQP Settings Sequence Data Frame</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ferlmic/gstest/tree/main/">G-Series 3.0 (latest - R package gstest 3.0.0)</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ferlmic/gstest/releases/tag/v2.0/">G-Series 2.0 (SAS® version)</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ferlmic/gstest/releases/tag/v1.04/">G-Series 1.04 (SAS® version)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ferlmic/gstest/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>

    <ul class="navbar-nav"><li class="nav-item"><a class="nav-link" href="#" onclick="window.location = location.href.replace('/en/','/fr/');"><span class="fa fa-language fa-lg"></span> Français</a></li></ul>
</div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>OSQP Settings Sequence Data Frame</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ferlmic/gstest/tree/main/vignettes/osqp-settings-sequence-dataframe.Rmd" class="external-link"><code>vignettes/osqp-settings-sequence-dataframe.Rmd</code></a></small>
      <div class="d-none name"><code>osqp-settings-sequence-dataframe.Rmd</code></div>
    </div>

    
    
<!-- Display the link to the French web page only when rendering an HTML document
     (e.g., not when rendering the PDF version)
     
     => the Pandoc "fenced_div" below (::: {.pkgdown-devel} <...> :::) is used to avoid 
        having the link generated in the pkgdown website vignette page
     => the link would only show in the "development" version of the pkgdown website
        (`development: mode: devel` in `_pkdown.yml` or `development: mode: auto` with a 4-level 
        version number in the DESCRIPTION file), which we do not use for gstest (we set 
        `development: mode: release` in `_pkdown.yml`, resulting in a single "release" website 
        regardless of the version number -->

<p>Data frame containing a sequence of OSQP settings for
<code><a href="../reference/tsbalancing.html">tsbalancing()</a></code> specified with argument
<code>osqp_settings_df</code>. The package includes two predefined OSQP
settings sequence data frames that are presented below.</p>
<div class="section level2">
<h2 id="data-frame-default_osqp_sequence">
<strong>Data frame <code>default_osqp_sequence</code></strong><a class="anchor" aria-label="anchor" href="#data-frame-default_osqp_sequence"></a>
</h2>
<p>Fast and effective sequence of OSQP settings that should be suitable
for accurately solving most time series balancing problems. It is the
default value of <code><a href="../reference/tsbalancing.html">tsbalancing()</a></code> argument
<code>osqp_settings_df</code>.</p>
<pre><code><span><span class="co">#&gt;   max_iter    sigma  eps_abs  eps_rel eps_prim_inf eps_dual_inf polish scaling</span></span>
<span><span class="co">#&gt; 1    4,000 1.00e-09 1.00e-06 1.00e-06     1.00e-07     1.00e-07   TRUE       0</span></span>
<span><span class="co">#&gt; 2   10,000 1.00e-15 1.00e-12 1.00e-12     1.00e-13     1.00e-13   TRUE       0</span></span>
<span><span class="co">#&gt; 3   10,000 1.00e-15 1.00e-12 1.00e-12     1.00e-13     1.00e-13   TRUE       0</span></span>
<span><span class="co">#&gt; 4   10,000 2.22e-16 2.22e-16 2.22e-16     2.22e-16     2.22e-16   TRUE       0</span></span>
<span><span class="co">#&gt;   prior_scaling require_polished</span></span>
<span><span class="co">#&gt; 1          TRUE             TRUE</span></span>
<span><span class="co">#&gt; 2          TRUE             TRUE</span></span>
<span><span class="co">#&gt; 3         FALSE            FALSE</span></span>
<span><span class="co">#&gt; 4          TRUE            FALSE</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="data-frame-alternate_osqp_sequence">
<strong>Data frame
<code>alternate_osqp_sequence</code></strong><a class="anchor" aria-label="anchor" href="#data-frame-alternate_osqp_sequence"></a>
</h2>
<p>Alternative slower sequence of OSQP settings that could help achieve
more precision, when needed, especially when combined with argument
<code>full_sequence = TRUE</code>.</p>
<pre><code><span><span class="co">#&gt;    max_iter    sigma  eps_abs  eps_rel eps_prim_inf eps_dual_inf polish scaling</span></span>
<span><span class="co">#&gt; 1    10,000 1.00e-15 1.00e-12 1.00e-12     1.00e-13     1.00e-13   TRUE       0</span></span>
<span><span class="co">#&gt; 2    10,000 1.00e-15 1.00e-12 1.00e-12     1.00e-13     1.00e-13   TRUE      10</span></span>
<span><span class="co">#&gt; 3    10,000 1.00e-12 1.00e-09 1.00e-09     1.00e-10     1.00e-10   TRUE       0</span></span>
<span><span class="co">#&gt; 4    10,000 1.00e-12 1.00e-09 1.00e-09     1.00e-10     1.00e-10   TRUE      10</span></span>
<span><span class="co">#&gt; 5    10,000 1.00e-09 1.00e-06 1.00e-06     1.00e-07     1.00e-07   TRUE       0</span></span>
<span><span class="co">#&gt; 6    10,000 1.00e-09 1.00e-06 1.00e-06     1.00e-07     1.00e-07   TRUE      10</span></span>
<span><span class="co">#&gt; 7    10,000 1.00e-06 1.00e-03 1.00e-03     1.00e-04     1.00e-04   TRUE       0</span></span>
<span><span class="co">#&gt; 8    10,000 1.00e-06 1.00e-03 1.00e-03     1.00e-04     1.00e-04   TRUE      10</span></span>
<span><span class="co">#&gt; 9    10,000 2.22e-16 2.22e-16 2.22e-16     2.22e-16     2.22e-16   TRUE       0</span></span>
<span><span class="co">#&gt; 10   10,000 2.22e-16 2.22e-16 2.22e-16     2.22e-16     2.22e-16   TRUE      10</span></span>
<span><span class="co">#&gt; 11   10,000 1.00e-15 1.00e-12 1.00e-12     1.00e-13     1.00e-13   TRUE       0</span></span>
<span><span class="co">#&gt; 12   10,000 1.00e-12 1.00e-09 1.00e-09     1.00e-10     1.00e-10   TRUE       0</span></span>
<span><span class="co">#&gt; 13   10,000 1.00e-09 1.00e-06 1.00e-06     1.00e-07     1.00e-07   TRUE       0</span></span>
<span><span class="co">#&gt; 14   10,000 1.00e-06 1.00e-03 1.00e-03     1.00e-04     1.00e-04   TRUE       0</span></span>
<span><span class="co">#&gt; 15   10,000 2.22e-16 2.22e-16 2.22e-16     2.22e-16     2.22e-16   TRUE       0</span></span>
<span><span class="co">#&gt;    prior_scaling require_polished</span></span>
<span><span class="co">#&gt; 1          FALSE             TRUE</span></span>
<span><span class="co">#&gt; 2          FALSE             TRUE</span></span>
<span><span class="co">#&gt; 3          FALSE             TRUE</span></span>
<span><span class="co">#&gt; 4          FALSE             TRUE</span></span>
<span><span class="co">#&gt; 5          FALSE             TRUE</span></span>
<span><span class="co">#&gt; 6          FALSE             TRUE</span></span>
<span><span class="co">#&gt; 7          FALSE             TRUE</span></span>
<span><span class="co">#&gt; 8          FALSE             TRUE</span></span>
<span><span class="co">#&gt; 9          FALSE             TRUE</span></span>
<span><span class="co">#&gt; 10         FALSE             TRUE</span></span>
<span><span class="co">#&gt; 11          TRUE             TRUE</span></span>
<span><span class="co">#&gt; 12          TRUE             TRUE</span></span>
<span><span class="co">#&gt; 13          TRUE             TRUE</span></span>
<span><span class="co">#&gt; 14          TRUE             TRUE</span></span>
<span><span class="co">#&gt; 15          TRUE             TRUE</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a>
</h2>
<p>With the exception of <code>prior_scaling</code> and
<code>require_polished</code>, all columns of the data frame must
correspond to a OSQP setting. Default OSQP values are used for any
setting not specified in this data frame. Visit <a href="https://osqp.org/docs/interfaces/solver_settings.html" class="external-link uri">https://osqp.org/docs/interfaces/solver_settings.html</a>
for all available OSQP settings. Note that the OSQP <code>verbose</code>
setting is actually controlled through <code><a href="../reference/tsbalancing.html">tsbalancing()</a></code>
arguments <code>quiet</code> and <code>display_level</code> (i.e.,
column <code>verbose</code> in a <em>OSQP settings sequence data
frame</em> would be ignored).</p>
<p>Each row of a <em>OSQP settings sequence data frame</em> represents
one attempt at solving a balancing problem with the corresponding OSQP
settings. The solving sequence stops as soon as a valid solution is
obtained (a solution for which all constraint discrepancies are smaller
or equal to the tolerance specified with <code><a href="../reference/tsbalancing.html">tsbalancing()</a></code>
argument <code>validation_tol</code>) unless column
<code>require_polished = TRUE</code>, in which case a polished solution
from OSQP (<code>status_polish = 1</code>) would also be required to
stop the sequence. Constraint discrepancies correspond to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">x</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mi>l</mi><mo>−</mo><mi>A</mi><mi>x</mi><mo>,</mo><mi>A</mi><mi>x</mi><mo>−</mo><mi>u</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathrm{max}(0, l - Ax, Ax - u)</annotation></semantics></math>
with constraints defined as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mo>≤</mo><mi>A</mi><mi>x</mi><mo>≤</mo><mi>u</mi></mrow><annotation encoding="application/x-tex">l \le Ax \le u</annotation></semantics></math>.
In the event where a satisfactory solution cannot be obtained after
having gone through the entire sequence, <code><a href="../reference/tsbalancing.html">tsbalancing()</a></code>
returns the solution that generated the smallest total constraint
discrepancies among valid solutions, if any, or among all solutions,
otherwise. Note that running the entire solving sequence can be
<em>enforced</em> by specifying <code><a href="../reference/tsbalancing.html">tsbalancing()</a></code> argument
<code>full_sequence = TRUE</code>. Rows with column
<code>prior_scaling = TRUE</code> have the problem data scaled prior to
solving with OSQP, using the average of the free (nonbinding) problem
values as the scaling factor.</p>
<p>In addition to specifying a custom-made <em>OSQP settings sequence
data frame</em> with argument <code>osqp_settings_df</code>, one can
also specify <code>osqp_settings_df = NULL</code> which would result in
a single solving attempt with default OSQP values for all settings along
with <code>prior_scaling = FALSE</code> and
<code>require_polished = FALSE</code>. Note that it is recommended,
however, to first try data frames <code>default_osqp_sequence</code> and
<code>alternate_osqp_sequence</code>, along with
<code>full_sequence = TRUE</code> if necessary, before considering other
alternatives.</p>
</div>
<div class="section level2">
<h2 id="recommended-approach">Recommended Approach<a class="anchor" aria-label="anchor" href="#recommended-approach"></a>
</h2>
<p>Start with the default <code><a href="../reference/tsbalancing.html">tsbalancing()</a></code> solving sequence
(<code>osqp_settings_df = default_osqp_sequence</code> and
<code>full_sequence = FALSE</code>). Then, if more precision is needed,
try with:</p>
<ol style="list-style-type: decimal">
<li><code>full_sequence = TRUE</code></li>
<li><code>osqp_settings_df = alternate_osqp_sequence</code></li>
<li>
<code>osqp_settings_df = alternate_osqp_sequence</code> and
<code>full_sequence = TRUE</code>
</li>
</ol>
<p>In practice, specifying <code>full_sequence = TRUE</code> should be
enough when more precision is needed (at the expense of execution time,
obviously). Only in rare occasions should you need to use the
<code>alternate_osqp_sequence</code> data frame, which will often be
even more costly in terms of execution time especially when combined
with <code>full_sequence = TRUE</code>.</p>
</div>
<div class="section level2">
<h2 id="guiding-principles">Guiding Principles<a class="anchor" aria-label="anchor" href="#guiding-principles"></a>
</h2>
<p>The following is a summary of the lessons learned while developing
<code><a href="../reference/tsbalancing.html">tsbalancing()</a></code> and experimenting with the OSQP solver. They
are the guiding principles that lead to both <em>OSQP settings sequence
data frames</em> presented earlier. Note these observations apply to
<strong><em>time series balancing problems</em></strong> as solved by
<code><a href="../reference/tsbalancing.html">tsbalancing()</a></code> and may not directly apply to other types of
<em>quadratic problems</em>.</p>
<ul>
<li>Data preconditioning options available in OSQP (with the
<code>scaling</code> setting) are not sufficient for some (badly scaled)
problems. External (prior) data scaling
(<code>prior_scaling = TRUE</code>) is sometimes necessary for OSQP to
converge at a decent pace and generate <em>precise enough</em> solutions
in a reasonable number of iterations.</li>
<li>Prior data scaling often reduces execution time (the required number
of iterations to achieve the specified precision) and greatly increases
the likelihood of polished solutions.</li>
<li>Polished solutions are always very precise, even when prior data
scaling is performed (i.e., the solution in the original scale will
usually still be <em>precise enough</em>).</li>
<li>While polished solutions from prior-scaled data are usually more
precise than unpolished solutions from non prior-scaled data, the most
precise solutions correspond to polished solutions from non prior-scaled
data.</li>
<li>Smaller <code>sigma</code> and tolerance (<code>eps_*</code>)
settings result in more precise solutions but take longer to run
(require more iterations).</li>
<li>Enough precision is usually obtained after 10,000 iterations with
small values for the <code>sigma</code> and tolerance
(<code>eps_*</code>) settings.</li>
<li>The default OSQP values for <code>alpha</code> and the various
settings associated to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ρ</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math>
(<code>*rho*</code>) are sufficient (they work well). Reducing the
<code>sigma</code> and tolerance (<code>eps_*</code>) settings and
performing prior data scaling is sufficient to obtain precise solutions
in a reasonable number of iterations.</li>
<li>Keeping the same scale between the <code>sigma</code> and tolerance
(<code>eps_*</code>) settings as the default OSQP values works well and
is used in both <em>OSQP settings sequence data frames</em>, i.e.:
<ul>
<li><code>eps_abs = eps_rel = 1,000 * sigma</code></li>
<li><code>eps_prim_inf = eps_dual_inf = 100 * sigma</code></li>
<li>(and consequently)
<code>eps_abs = eps_rel = 10 * eps_prim_inf = 10 * eps_dual_inf</code>
</li>
</ul>
</li>
<li>The <em>machine epsilon</em> (<code>.Machine$double.eps</code>) for
the <code>sigma</code> and tolerance (<code>eps_*</code>) settings,
which basically forces the maximum number of iterations, is used as a
<em>last resort</em> in both <em>OSQP settings sequence data
frames</em>.</li>
</ul>
<p><strong>Summary - default sequence</strong> (data frame
<code>default_osqp_sequence</code>)</p>
<ul>
<li>Geared towards achieving both fast and precise solutions.</li>
<li>First try to get (fast) polished solutions on prior-scaled data
before attempting solving the original (non-scaled) problem data.</li>
<li>Make a final attempt on prior-scaled data with the <em>machine
epsilon</em> for the <code>sigma</code> and tolerance
(<code>eps_*</code>) settings.</li>
</ul>
<p><strong>Summary - alternative sequence</strong> (data frame
<code>alternate_osqp_sequence</code>)</p>
<ul>
<li>Geared towards achieving precise solutions at the expense of
execution time.</li>
<li>Somewhat similar to a <em>brute force</em> or <em>try all</em>
approach.</li>
<li>Small <code>sigma</code> and tolerance (<code>eps_*</code>) settings
that gradually increase, with the <em>machine epsilon</em> as a last
attempt.</li>
<li>Polished solutions are required for every step of the sequence (the
best unpolished solution is returned if no polished solution could be
obtained at the end of the entire sequence).</li>
<li>Maximum of 10,000 iterations for every step of the sequence</li>
<li>First try to get polished solutions from non prior-scaled data (the
most precise solutions), then try with prior-scaled data.</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michel Ferland, Statistics Canada.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
