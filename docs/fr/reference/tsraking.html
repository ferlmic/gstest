<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="fr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Rétablir les contraintes d'agrégation transversales (contemporaines) — tsraking • gstest</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Rétablir les contraintes d'agrégation transversales (contemporaines) — tsraking"><meta name="description" content="Réplication de la procédure TSRAKING de G-Séries 2.0 en SAS\(^\circledR\) (PROC TSRAKING).
Voir la documentation de G-Séries 2.0 pour plus de détails (Statistique Canada 2016).
Cette fonction rétablit les contraintes d'agrégation transversales dans un système de séries chronologiques.
Les contraintes d'agrégation peuvent provenir d'une table à 1 ou 2 dimensions. Optionnellement, des contraintes
temporelles peuvent également être préservées.
En pratique, tsraking() est généralement appelée à travers tsraking_driver() afin de réconcilier toutes
les périodes du système de séries chronologiques en un seul appel de fonction."><meta property="og:description" content="Réplication de la procédure TSRAKING de G-Séries 2.0 en SAS\(^\circledR\) (PROC TSRAKING).
Voir la documentation de G-Séries 2.0 pour plus de détails (Statistique Canada 2016).
Cette fonction rétablit les contraintes d'agrégation transversales dans un système de séries chronologiques.
Les contraintes d'agrégation peuvent provenir d'une table à 1 ou 2 dimensions. Optionnellement, des contraintes
temporelles peuvent également être préservées.
En pratique, tsraking() est généralement appelée à travers tsraking_driver() afin de réconcilier toutes
les périodes du système de séries chronologiques en un seul appel de fonction."><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script></head><body>
    <a href="#main" class="visually-hidden-focusable">Passer au contenu</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Navigation sur le site"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gstest</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Dernière version publiée">3.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Activer la navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/gstest.html">Prise en main</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Référence</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/benchmarking-cookbook.html">Livre de recette sur l'étalonnage</a></li>
    <li><a class="dropdown-item" href="../articles/benchmarking-demo-script.html">Un script d'étalonnage pour débutant</a></li>
    <li><a class="dropdown-item" href="../articles/osqp-settings-sequence-dataframe.html">« Data frame » pour la séquence de paramètres d'OSQP</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-nouveaut-s" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Nouveautés</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-nouveaut-s"><li><h6 class="dropdown-header" data-toc-skip>Versions</h6></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ferlmic/gstest/tree/main/">G-Séries 3.0 (version la plus récente - librairie R gstest 3.0.0)</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ferlmic/gstest/releases/tag/v2.0/">G-Séries 2.0 (version SAS®)</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ferlmic/gstest/releases/tag/v1.04/">G-Séries 1.04 (version SAS®)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changements</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Rechercher sur le site" placeholder="Rechercher" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ferlmic/gstest/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>

    <ul class="navbar-nav"><li class="nav-item"><a class="nav-link" href="#" onclick="window.location = location.href.replace('/fr/','/en/');"><span class="fa fa-language fa-lg"></span> English</a></li></ul></div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Rétablir les contraintes d'agrégation transversales (contemporaines)</h1>
      <small class="dont-index">Source : <a href="https://github.com/ferlmic/gstest/tree/main/fr/R/tsraking.R" class="external-link"><code>R/tsraking.R</code></a></small>
      <div class="d-none name"><code>tsraking.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><em>Réplication de la procédure TSRAKING de G-Séries 2.0 en SAS\(^\circledR\) (PROC TSRAKING).
Voir la documentation de G-Séries 2.0 pour plus de détails (Statistique Canada 2016).</em></p>
<p>Cette fonction rétablit les contraintes d'agrégation transversales dans un système de séries chronologiques.
Les contraintes d'agrégation peuvent provenir d'une table à 1 ou 2 dimensions. Optionnellement, des contraintes
temporelles peuvent également être préservées.</p>
<p>En pratique, <code>tsraking()</code> est généralement appelée à travers <code><a href="tsraking_driver.html">tsraking_driver()</a></code> afin de réconcilier toutes
les périodes du système de séries chronologiques en un seul appel de fonction.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Utilisation<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">tsraking</span><span class="op">(</span></span>
<span>  <span class="va">data_df</span>,</span>
<span>  <span class="va">metadata_df</span>,</span>
<span>  alterability_df <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  alterSeries <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  alterTotal1 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  alterTotal2 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  alterAnnual <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  tolV <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>  tolP <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  warnNegResult <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  tolN <span class="op">=</span> <span class="op">-</span><span class="fl">0.001</span>,</span>
<span>  id <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span></span>
<span>  <span class="co"># Nouveau dans G-Séries 3.0</span></span>
<span>  Vmat_option <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  warnNegInput <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data-df">data_df<a class="anchor" aria-label="anchor" href="#arg-data-df"></a></dt>
<dd><p>(obligatoire)</p>
<p><em>Data frame</em>, ou objet compatible, qui contient les données des séries chronologiques à réconcilier. Il doit au minimum
contenir des variables correspondant aux séries composantes et aux totaux de contrôle transversaux spécifiés dans le
<em>data frame</em> des métadonnées de ratissage (argument <code>metadata_df</code>). Si plus d'un enregistrement (plus d'une période) est
fournie, la somme des valeurs des séries composantes fournies sera également préservée à travers des contraintes
temporelles implicites.</p></dd>


<dt id="arg-metadata-df">metadata_df<a class="anchor" aria-label="anchor" href="#arg-metadata-df"></a></dt>
<dd><p>(obligatoire)</p>
<p><em>Data frame</em>, ou objet compatible, qui décrit les contraintes d'agrégation transversales (règles d'additivité) pour le
problème de ratissage (« <em>raking</em> »). Deux variables de type caractère doivent être incluses dans le <em>data frame</em> :
<code>series</code> et <code>total1</code>. Deux variables sont optionnelles : <code>total2</code> (caractère) et <code>alterAnnual</code> (numérique). Les valeurs
de la variable <code>series</code> représentent les noms des variables des séries composantes dans le <em>data frame</em> des données
d'entrée (argument <code>data_df</code>). De même, les valeurs des variables <code>total1</code> et <code>total2</code> représentent les noms des variables
des totaux de contrôle transversaux de 1<sup>ère</sup> et 2<sup>ème</sup> dimension dans le <em>data frame</em> des données
d'entrée. La variable <code>alterAnnual</code> contient le coefficient d'altérabilité pour la contrainte temporelle associée à
chaque série composante. Lorsqu'elle est spécifiée, cette dernière remplace le coefficient d'altérabilité par défaut
spécifié avec l'argument <code>alterAnnual</code>.</p></dd>


<dt id="arg-alterability-df">alterability_df<a class="anchor" aria-label="anchor" href="#arg-alterability-df"></a></dt>
<dd><p>(optionnel)</p>
<p><em>Data frame</em>, ou objet compatible, ou <code>NULL</code>, qui contient les variables de coefficients d'altérabilité. Elles
doivent correspondre à une série composante ou à un total de contrôle transversal, c'est-à-dire qu'une variable
portant le même nom doit exister dans le <em>data frame</em> des données d'entrée (argument <code>data_df</code>). Les valeurs de
ces coefficients d'altérabilité remplaceront les coefficients d'altérabilité par défaut spécifiés avec les arguments
<code>alterSeries</code>, <code>alterTotal1</code> et <code>alterTotal2</code>. Lorsque le <em>data frame</em> des données d'entrée contient plusieurs
enregistrements et que le <em>data frame</em> des coefficients d'altérabilité n'en contient qu'un seul, les coefficients
d'altérabilité sont utilisés (répétés) pour tous les enregistrements du <em>data frame</em> des données d'entrée. Le
<em>data frame</em> des coefficients d'altérabilité peut également contenir autant d'enregistrements que le <em>data frame</em>
des données d'entrée.</p>
<p><strong>La valeur par défaut</strong> est <code>alterability_df = NULL</code> (coefficients d'altérabilité par défaut).</p></dd>


<dt id="arg-alterseries">alterSeries<a class="anchor" aria-label="anchor" href="#arg-alterseries"></a></dt>
<dd><p>(optionnel)</p>
<p>Nombre réel non négatif spécifiant le coefficient d'altérabilité par défaut pour les valeurs des séries composantes.
Il s'appliquera aux séries composantes pour lesquelles des coefficients d'altérabilité n'ont pas déjà été spécifiés
dans le <em>data frame</em> des coefficients d'altérabilité (argument <code>alterability_df</code>).</p>
<p><strong>La valeur par défaut</strong> est <code>alterSeries = 1.0</code> (valeurs des séries composantes non contraignantes).</p></dd>


<dt id="arg-altertotal-">alterTotal1<a class="anchor" aria-label="anchor" href="#arg-altertotal-"></a></dt>
<dd><p>(optionnel)</p>
<p>Nombre réel non négatif spécifiant le coefficient d'altérabilité par défaut pour les totaux de contrôle transversaux
de la 1<sup>ère</sup> dimension. Il s'appliquera aux totaux de contrôle transversaux pour lesquels des coefficients
d'altérabilité n'ont pas déjà été spécifiés dans le <em>data frame</em> des coefficients d'altérabilité (argument
<code>alterability_df</code>).</p>
<p><strong>La valeur par défaut</strong> est <code>alterTotal1 = 0.0</code> (totaux de contrôle transversaux de 1<sup>ère</sup> dimension
contraignants).</p></dd>


<dt id="arg-altertotal-">alterTotal2<a class="anchor" aria-label="anchor" href="#arg-altertotal-"></a></dt>
<dd><p>(optionnel)</p>
<p>Nombre réel non négatif spécifiant le coefficient d'altérabilité par défaut pour les totaux de contrôle transversaux
de la 2<sup>ème</sup> dimension. Il s'appliquera aux totaux de contrôle transversaux pour lesquels des coefficients
d'altérabilité n'ont pas déjà été spécifiés dans le <em>data frame</em> des coefficients d'altérabilité (argument
<code>alterability_df</code>).</p>
<p><strong>La valeur par défaut</strong> est <code>alterTotal2 = 0.0</code> (totaux de contrôle transversaux de 2<sup>ème</sup> dimension
contraignants).</p></dd>


<dt id="arg-alterannual">alterAnnual<a class="anchor" aria-label="anchor" href="#arg-alterannual"></a></dt>
<dd><p>(optionnel)</p>
<p>Nombre réel non négatif spécifiant le coefficient d'altérabilité par défaut pour les contraintes temporelles
(ex., totaux annuels) des séries composantes. Il s'appliquera aux séries composantes pour lesquelles des
coefficients d'altérabilité n'ont pas déjà été spécifiés dans le <em>data frame</em> des métadonnées de ratissage
(argument <code>metadata_df</code>).</p>
<p><strong>La valeur par défaut</strong> est <code>alterAnnual = 0.0</code> (totaux de contrôle temporels contraignants).</p></dd>


<dt id="arg-tolv-tolp">tolV, tolP<a class="anchor" aria-label="anchor" href="#arg-tolv-tolp"></a></dt>
<dd><p>(optionnel)</p>
<p>Nombre réel non négatif, ou <code>NA</code>, spécifiant la tolérance, en valeur absolue ou en pourcentage, à utiliser
lors du test ultime pour les totaux de contrôle contraignants (coefficient d'altérabilité de \(0.0\) pour
les totaux de contrôle temporels ou transversaux). Le test compare les totaux de contrôle contraignants d'entrée
avec ceux calculés à partir des séries composantes réconciliées (en sortie). Les arguments <code>tolV</code> et <code>tolP</code> ne
peuvent pas être spécifiés tous les deux à la fois (l'un doit être spécifié tandis que l'autre doit être <code>NA</code>).</p>
<p><strong>Exemple :</strong> pour une tolérance de 10 <em>unités</em>, spécifiez <code>tolV = 10, tolP = NA</code>; pour une tolérance de 1%,
spécifiez <code>tolV = NA, tolP = 0.01</code>.</p>
<p><strong>Les valeurs par défaut</strong> sont <code>tolV = 0.001</code> et <code>tolP = NA</code>.</p></dd>


<dt id="arg-warnnegresult">warnNegResult<a class="anchor" aria-label="anchor" href="#arg-warnnegresult"></a></dt>
<dd><p>(optionnel)</p>
<p>Argument logique (<em>logical</em>) spécifiant si un message d'avertissement doit être affiché lorsqu'une valeur négative
créée par la fonction dans une série réconciliée (en sortie) est inférieure au seuil spécifié avec l'argument <code>tolN</code>.</p>
<p><strong>La valeur par défaut</strong> est <code>warnNegResult = TRUE</code>.</p></dd>


<dt id="arg-toln">tolN<a class="anchor" aria-label="anchor" href="#arg-toln"></a></dt>
<dd><p>(optionnel)</p>
<p>Nombre réel négatif spécifiant le seuil pour l'identification des valeurs négatives. Une valeur est considérée
négative lorsqu'elle est inférieure à ce seuil.</p>
<p><strong>La valeur par défaut</strong> est <code>tolN = -0.001</code>.</p></dd>


<dt id="arg-id">id<a class="anchor" aria-label="anchor" href="#arg-id"></a></dt>
<dd><p>(optionnel)</p>
<p>Vecteur de chaînes de caractère (longueur minimale de 1), ou <code>NULL</code>, spécifiant le nom des variables additionnelles
à transférer du <em>data frame</em> d'entrée (argument <code>data_df</code>) au <em>data frame</em> de sortie, c.-à-d., l'objet renvoyé par
la fonction (voir la section <strong>Valeur de retour</strong>). Par défaut, le <em>data frame</em> de sortie ne contient que les
variables énumérées dans le <em>data frame</em> des métadonnées de ratissage (argument <code>metadata_df</code>).</p>
<p><strong>La valeur par défaut</strong> est <code>id = NULL</code>.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>(optionnel)</p>
<p>Argument logique (<em>logical</em>) spécifiant si les informations sur les étapes intermédiaires avec le temps d'exécution
(temps réel et non le temps CPU) doivent être affichées. Notez que spécifier l'argument <code>quiet = TRUE</code> annulerait
l'argument <code>verbose</code>.</p>
<p><strong>La valeur par défaut</strong> est <code>verbose = FALSE</code>.</p></dd>


<dt id="arg-vmat-option">Vmat_option<a class="anchor" aria-label="anchor" href="#arg-vmat-option"></a></dt>
<dd><p>(optionnel)</p>
<p>Spécification de l'option pour les matrices de variance (\(V_e\) et \(V_\epsilon\); voir la section <strong>Détails</strong>) :</p><table class="table table"><tr><td><strong>Valeur</strong></td><td><strong>Description</strong></td></tr><tr><td><code>1</code></td><td>Utiliser les vecteurs \(x\) et \(g\) dans les matrices de variance.</td></tr><tr><td><code>2</code></td><td>Utiliser les vecteurs \(|x|\) et \(|g|\) dans les matrices de variance.</td></tr></table><p>Voir Ferland (2016) et la sous-section <strong>Arguments <code>Vmat_option</code> et <code>warnNegInput</code></strong> dans la section <strong>Détails</strong> pour
plus d'informations.</p>
<p><strong>La valeur par défaut</strong> est <code>Vmat_option = 1</code>.</p></dd>


<dt id="arg-warnneginput">warnNegInput<a class="anchor" aria-label="anchor" href="#arg-warnneginput"></a></dt>
<dd><p>(optionnel)</p>
<p>Argument logique (<em>logical</em>) spécifiant si un message d'avertissement doit être affiché lorsqu'une valeur négative
plus petite que le seuil spécifié par l'argument <code>tolN</code> est trouvée dans le <em>data frame</em> des données d'entrée
(argument <code>data_df</code>).</p>
<p><strong>La valeur par défaut</strong> est <code>warnNegInput = TRUE</code>.</p></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p>(optionnel)</p>
<p>Argument logique (<em>logical</em>) spécifiant s'il faut ou non afficher uniquement les informations essentielles telles
que les messages d'avertissements et d'erreurs. Spécifier <code>quiet = TRUE</code> annulera également l'argument <code>verbose</code> et
est équivalent à <em>envelopper</em> votre appel à <code>tsraking()</code> avec <code><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages()</a></code>.</p>
<p><strong>La valeur par défaut</strong> est <code>quiet = FALSE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="valeur-de-retour">Valeur de retour<a class="anchor" aria-label="anchor" href="#valeur-de-retour"></a></h2>
    <p>La fonction renvoie un <em>data frame</em> contenant les séries composantes réconciliées, les totaux de contrôle transversaux
réconciliés et les variables spécifiées avec l'argument <code>id</code>. Notez que l'objet « data.frame » peut être explicitement
converti en un autre type d'objet avec la fonction <code>as*()</code> appropriée (ex., <code><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">tibble::as_tibble()</a></code> le convertirait en
tibble).</p>
    </div>
    <div class="section level2">
    <h2 id="d-tails">Détails<a class="anchor" aria-label="anchor" href="#d-tails"></a></h2>
    <p>Cette fonction renvoie la solution des moindres carrés généralisés d'une variante spécifique, simple du modèle général
de ratissage (<em>raking</em>) basé sur la régression proposé par Dagum et Cholette (Dagum et Cholette 2006). Le modèle,
sous forme matricielle, est le suivant :
$$\displaystyle
\begin{bmatrix} x \\ g \end{bmatrix} =
\begin{bmatrix} I \\ G \end{bmatrix} \theta +
\begin{bmatrix} e \\ \varepsilon \end{bmatrix}
$$
où</p><ul><li><p>\(x\) est le vecteur des valeurs initiales des séries composantes.</p></li>
<li><p>\(\theta\) est le vecteur des valeurs finales (réconciliées) des séries composantes.</p></li>
<li><p>\(e \sim \left( 0, V_e \right)\) est le vecteur des erreurs de mesure de \(x\) avec la matrice de
covariance \(V_e = \mathrm{diag} \left( c_x x \right)\), ou \(V_e = \mathrm{diag} \left( \left|
c_x x \right| \right)\) quand l'argument <code>Vmat_option = 2</code>, où \(c_x\) est le vecteur des
coefficients d'alterabilité de \(x\).</p></li>
<li><p>\(g\) est le vecteur des totaux de contrôle initiaux, incluant les totaux temporels des séries composantes (le cas
échéant).</p></li>
<li><p>\(\varepsilon \sim (0, V_\varepsilon)\) est le vecteur des erreurs de mesure de \(g\)
avec la matrice de covariance \(V_\varepsilon = \mathrm{diag} \left( c_g g \right)\), ou
\(V_\varepsilon = \mathrm{diag} \left( \left| c_g g \right| \right)\) quand l'argument
<code>Vmat_option = 2</code>, où \(c_g\) est le vecteur des coefficients d'alterabilité de \(g\).</p></li>
<li><p>\(G\) est la matrice des contraintes d'agrégation, y compris les contraintes temporelles implicites (le cas échéant).</p></li>
</ul><p>La solution généralisée des moindres carrés est :
$$\displaystyle
\hat{\theta} = x + V_e G^{\mathrm{T}} \left( G V_e G^{\mathrm{T}} + V_\varepsilon \right)^+ \left( g - G x \right)
$$
où \(A^{+}\) désigne l'inverse de Moore-Penrose de la matrice \(A\).</p>
<p><code>tsraking()</code> résout un seul problème de ratissage à la fois, c'est-à-dire, soit une seule période du système de séries
chronologiques, ou un seul groupe temporel (ex., toutes les périodes d'une année donnée) lorsque la préservation des
totaux temporels est requise. Plusieurs appels à <code>tsraking()</code> sont donc nécessaires pour réconcilier toutes les
périodes du système de séries chronologiques. <code><a href="tsraking_driver.html">tsraking_driver()</a></code> peut réaliser cela en un seul appel : il détermine
commodément l'ensemble des problèmes à résoudre et génère à l'interne les appels individuels à <code>tsraking()</code>.</p><div class="section">
<h3 id="coefficients-d-alt-rabilit-">Coefficients d'altérabilité<a class="anchor" aria-label="anchor" href="#coefficients-d-alt-rabilit-"></a></h3>


<p>Les coefficients d'altérabilité \(c_x\) et \(c_g\) représentent conceptuellement les erreurs de mesure associées aux
valeurs d'entrée des séries composantes \(x\) et des totaux de contrôle \(g\) respectivement. Il s'agit de nombres réels
non négatifs qui, en pratique, spécifient l'ampleur de la modification permise d'une valeur initiale par rapport aux autres
valeurs. Un coefficients d'altérabilité de \(0.0\) définit une valeur fixe (contraignante), tandis qu'un coefficient
d'altérabilité supérieur à \(0.0\) définit une valeur libre (non contraignante). L'augmentation du coefficient
d'altérabilité d'une valeur initiale entraîne davantage de changements pour cette valeur dans les données réconciliées (en
sortie) et, inversement, moins de changements lorsque l'on diminue le coefficient d'altérabilité. Les coefficients
d'altérabilité par défaut sont \(1.0\) pour les valeurs des séries composantes et \(0.0\) pour les totaux de contrôle
transversaux et, le cas échéant, les totaux temporels des séries composantes. Ces coefficients d'altérabilité par défaut
entraînent une répartition proportionnelle des écarts entre les séries composantes. En fixant les coefficients d'altérabilité
des séries composantes à l'inverse des valeurs initiales des séries composantes, on obtiendrait une répartition uniforme des
écarts à la place. Des totaux <em>presque contraignants</em> peuvent être obtenus en pratique en spécifiant des coefficients
d'altérabilité très petits (presque \(0.0\)) par rapport à ceux des séries composantes (non contraignantes).</p>
<p><strong>La préservation des totaux temporels</strong> fait référence au fait que les totaux temporels, le cas échéant, sont
généralement conservés « aussi près que possible » de leur valeur initiale. Une <em>préservation pure</em> est obtenue par
défaut avec des totaux temporels contraignants, tandis que le changement est minimisé avec des totaux temporels non
contraignants (conformément à l'ensemble de coefficients d'altérabilité utilisés).</p>
</div>

<div class="section">
<h3 id="arguments-vmat-option-et-warnneginput">Arguments <code>Vmat_option</code> et <code>warnNegInput</code><a class="anchor" aria-label="anchor" href="#arguments-vmat-option-et-warnneginput"></a></h3>


<p>Ces arguments permettent une gestion alternative des valeurs négatives dans les données d'entrée, similaire à celle de
<code><a href="tsbalancing.html">tsbalancing()</a></code>. Leurs valeurs par défaut correspondent au comportement de G-Séries 2.0 (PROC TSRAKING en
SAS\(^\circledR\)) pour lequel des options équivalentes ne sont pas définies. Ce dernier a été développé en présumant
des « données d'entrée non négatives uniquement », à l'instar de PROC BENCHMARKING dans G-Séries 2.0 en
SAS\(^\circledR\) qui n'autorisait pas non plus les valeurs négatives avec l'étalonnage proportionnel, ce qui explique
l'avertissement « suspicious use of proportional raking » (<em>utilisation suspecte du ratissage proportionnel</em>) en présence
de valeurs négatives avec PROC TSRAKING dans G-Series 2.0 et lorsque <code>warnNegInput = TRUE</code> (par défault). Cependant, le
ratissage (proportionnel) en présence de valeurs négatives fonctionne généralement bien avec <code>Vmat_option = 2</code> et produit
des solutions raisonnables et intuitives. Par exemple, alors que l'option par défaut <code>Vmat_option = 1</code> échoue à résoudre
la contrainte <code>A + B = C</code> avec les données d'entrée <code>A = 2</code>, <code>B = -2</code>, <code>C = 1</code> et les coefficients d'altérabilité par défaut,
<code>Vmat_option = 2</code> renvoie la solution (intuitive) <code>A = 2.5</code>, <code>B = -1.5</code>, <code>C = 1</code> (augmentation de 25% pour <code>A</code> et <code>B</code>). Voir
Ferland (2016) pour plus de détails.</p>
</div>

<div class="section">
<h3 id="traitement-des-valeurs-manquantes-na-">Traitement des valeurs manquantes (<code>NA</code>)<a class="anchor" aria-label="anchor" href="#traitement-des-valeurs-manquantes-na-"></a></h3>


<p>Une valeur manquante dans le <em>data frame</em> des données d'entrée (argument <code>data_df</code>) ou dans le <em>data frame</em> des
coefficients d'altérabilité (argument <code>alterability_df</code>) pour n'importe quelle donnée du problème de ratissage (variables
énumérées dans le <em>data frame</em> des métadonnées avec l'argument <code>metadata_df</code>) générera un message d'erreur et arrêtera
l'exécution de la fonction.</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="comparaison-de-tsraking-et-tsbalancing-">Comparaison de <code>tsraking()</code> et <code><a href="tsbalancing.html">tsbalancing()</a></code><a class="anchor" aria-label="anchor" href="#comparaison-de-tsraking-et-tsbalancing-"></a></h2>

<ul><li><p><code>tsraking()</code> est limitée aux problèmes de ratissage (« <em>raking</em> ») de tables d'agrégation unidimensionnelles et
bidimensionnelles (avec préservation des totaux temporels si nécessaire) alors que <code><a href="tsbalancing.html">tsbalancing()</a></code> traite des problèmes
d'équilibrage plus généraux (ex., des problèmes de ratissage de plus grande dimension, solutions non négatives,
contraintes linéaires générales d'égalité et d'inégalité par opposition à des règles d'agrégation uniquement, etc.)</p></li>
<li><p><code>tsraking()</code> renvoie la solution des moindres carrés généralisés du modèle de ratissage basé sur la régression de
Dagum et Cholette (Dagum et Cholette 2006) tandis que <code><a href="tsbalancing.html">tsbalancing()</a></code> résout le problème de minimisation quadratique
correspondant à l'aide d'un solveur numérique. Dans la plupart des cas, la <em>convergence vers le minimum</em> est atteinte
et la solution de <code><a href="tsbalancing.html">tsbalancing()</a></code> correspond à la solution (exacte) des moindres carrés de <code>tsraking()</code>. Cela peut ne
pas être le cas, cependant, si la convergence n'a pas pu être atteinte après un nombre raisonnable d'itérations. Cela
dit, ce n'est qu'en de très rares occasions que la solution de <code><a href="tsbalancing.html">tsbalancing()</a></code> différera <em>significativement</em> de celle
de <code>tsraking()</code>.</p></li>
<li><p><code><a href="tsbalancing.html">tsbalancing()</a></code> est généralement plus rapide que <code>tsraking()</code>, en particulier pour les gros problèmes de ratissage,
mais est généralement plus sensible à la présence de (petites) incohérences dans les données d'entrée associées aux
contraintes redondantes des problèmes de ratissage <em>entièrement spécifiés</em> (ou surspécifiés). <code>tsraking()</code> gère ces
incohérences en utilisant l'inverse de Moore-Penrose (distribution uniforme à travers tous les totaux contraignants).</p></li>
<li><p><code><a href="tsbalancing.html">tsbalancing()</a></code> permet de spécifier des problèmes épars (clairsemés) sous leur forme réduite. Ce n'est pas le cas de
<code>tsraking()</code> où les règles d'agrégation doivent toujours être entièrement spécifiées étant donné qu'un <em>cube de données
complet</em>, sans données manquantes, est attendu en entrée (chaque série composante de l'<em>intérieur du cube</em> doit
contribuer à toutes les dimensions du cube, c.-à-d., à chaque série totale des <em>faces extérieures du cube</em>).</p></li>
<li><p>Les deux outils traitent différemment les valeurs négatives dans les données d'entrée par défaut. Alors que les
solutions des problèmes de ratissage obtenues avec <code><a href="tsbalancing.html">tsbalancing()</a></code> et <code>tsraking()</code> sont identiques lorsque tous les
points de données d'entrée sont positifs, elles seront différentes si certains points de données sont négatifs (à
moins que l'argument <code>Vmat_option = 2</code> ne soit spécifié avec <code>tsraking()</code>).</p></li>
<li><p>Alors que <code><a href="tsbalancing.html">tsbalancing()</a></code> et <code>tsraking()</code> permettent toutes les deux de préserver les totaux temporels, la gestion
du temps n'est pas incorporée dans <code>tsraking()</code>. Par exemple, la construction des groupes de traitement (ensembles de
périodes de chaque problème de ratissage) est laissée à l'utilisateur avec <code>tsraking()</code> et des appels séparés doivent
être soumis pour chaque groupe de traitement (chaque problème de ratissage). De là l'utilité de la fonction
d'assistance <code><a href="tsraking_driver.html">tsraking_driver()</a></code> pour <code>tsraking()</code>.</p></li>
<li><p><code><a href="tsbalancing.html">tsbalancing()</a></code> renvoie le même ensemble de séries que l'objet d'entrée de type série chronologique (argument
<code>in_ts</code>) alors que <code>tsraking()</code> renvoie l'ensemble des séries impliquées dans le problème de ratissage plus celles
spécifiées avec l'argument <code>id</code> (qui pourrait correspondre à un sous-ensemble des séries d'entrée).</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="r-f-rences">Références<a class="anchor" aria-label="anchor" href="#r-f-rences"></a></h2>
    <p>Bérubé, J. and S. Fortier (2009). « PROC TSRAKING: An in-house SAS\(^\circledR\) procedure for balancing
time series ». Dans <strong>JSM Proceedings, Business and Economic Statistics Section</strong>. Alexandria, VA: American Statistical
Association.</p>
<p>Dagum, E. B. and P. Cholette (2006). <strong>Benchmarking, Temporal Distribution and Reconciliation Methods
of Time Series</strong>. Springer-Verlag, New York, Lecture Notes in Statistics, Vol. 186.</p>
<p>Ferland, M. (2016). « Negative Values with PROC TSRAKING ». <strong>Document interne</strong>. Statistique Canada, Ottawa,
Canada.</p>
<p>Fortier, S. and B. Quenneville (2009). « Reconciliation and Balancing of Accounts and Time Series ».
Dans <strong>JSM Proceedings, Business and Economic Statistics Section</strong>. Alexandria, VA: American Statistical Association.</p>
<p>Quenneville, B. and S. Fortier (2012). « Restoring Accounting Constraints in Time Series – Methods and
Software for a Statistical Agency ». <strong>Economic Time Series: Modeling and Seasonality</strong>. Chapman &amp; Hall, New York.</p>
<p>Statistique Canada (2016). « La procédure TSRAKING ». <strong>Guide de l'utilisateur de G-Séries 2.0</strong>.
Statistique Canada, Ottawa, Canada.</p>
<p>Statistique Canada (2018). <strong>Théorie et application de la réconciliation (Code du cours 0437)</strong>.
Statistique Canada, Ottawa, Canada.</p>
    </div>
    <div class="section level2">
    <h2 id="voir-galement">Voir également<a class="anchor" aria-label="anchor" href="#voir-galement"></a></h2>
    <div class="dont-index"><p><code><a href="tsraking_driver.html">tsraking_driver()</a></code> <code><a href="tsbalancing.html">tsbalancing()</a></code> <code><a href="rkMeta_to_blSpecs.html">rkMeta_to_blSpecs()</a></code> <code><a href="gs.gInv_MP.html">gs.gInv_MP()</a></code> <code><a href="build_raking_problem.html">build_raking_problem()</a></code> <a href="aliases.html">aliases</a></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Exemples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">###########</span></span></span>
<span class="r-in"><span><span class="co"># Exemple 1 : Problème simple de ratissage à une dimension dans lequel les valeurs des </span></span></span>
<span class="r-in"><span><span class="co">#             `autos` et des `camions` doivent être égales à la valeur du `total`.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Métadonnées du problème</span></span></span>
<span class="r-in"><span><span class="va">mes_meta1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>series <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"autos"</span>, <span class="st">"camions"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                        total1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"total"</span>, <span class="st">"total"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mes_meta1</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    series total1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   autos  total</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 camions  total</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Données du problème</span></span></span>
<span class="r-in"><span><span class="va">mes_series1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>autos <span class="op">=</span> <span class="fl">25</span>, camions <span class="op">=</span> <span class="fl">5</span>, total <span class="op">=</span> <span class="fl">40</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Réconcilier les données</span></span></span>
<span class="r-in"><span><span class="va">res_ratis1</span> <span class="op">&lt;-</span> <span class="fu">tsraking</span><span class="op">(</span><span class="va">mes_series1</span>, <span class="va">mes_meta1</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> --- Package gstest 3.0.0 - (EN) 'G-Series' in 'R' | (FR) 'G-Séries' en 'R' ---</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Created on April 8, 2025, at 3:40:01 PM EDT</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> URL: https://ferlmic.github.io/gstest/en/</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>      https://ferlmic.github.io/gstest/fr/</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Email: g-series@statcan.gc.ca</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> tsraking() function:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     data_df         = mes_series1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     metadata_df     = mes_meta1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterability_df = NULL (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterSeries     = 1 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterTotal1     = 0 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterTotal2     = 0 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterAnnual     = 0 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     tolV            = 0.001 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     warnNegResult   = TRUE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     tolN            = -0.001 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     id              = NULL (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     verbose         = FALSE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)Vmat_option  = 1 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)warnNegInput = TRUE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)quiet        = FALSE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*) indicates new arguments in G-Series 3.0</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Données initiales</span></span></span>
<span class="r-in"><span><span class="va">mes_series1</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   autos camions total</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1    25       5    40</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Données réconciliées</span></span></span>
<span class="r-in"><span><span class="va">res_ratis1</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      autos  camions total</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 33.33333 6.666667    40</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Vérifier les contraintes transversales en sortie</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">res_ratis1</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"autos"</span>, <span class="st">"camions"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, <span class="va">res_ratis1</span><span class="op">$</span><span class="va">total</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Vérifier le total de contrôle (fixe)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">mes_series1</span><span class="op">$</span><span class="va">total</span>, <span class="va">res_ratis1</span><span class="op">$</span><span class="va">total</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">###########</span></span></span>
<span class="r-in"><span><span class="co"># Exemple 2 : problème de ratissage à 2 dimensions similaire au 1er exemple mais </span></span></span>
<span class="r-in"><span><span class="co">#             en ajoutant les ventes régionales pour les 3 provinces des prairies </span></span></span>
<span class="r-in"><span><span class="co">#             (Alb., Sask. et Man.) et où les ventes de camions en Sask. ne sont </span></span></span>
<span class="r-in"><span><span class="co">#             pas modifiables (coefficient d'altérabilité = 0), avec `quiet = TRUE` </span></span></span>
<span class="r-in"><span><span class="co">#             pour éviter l'affichage de l'en-tête de la fonction.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Métadonnées du problème</span></span></span>
<span class="r-in"><span><span class="va">mes_meta2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>series <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"autos_alb"</span>, <span class="st">"autos_sask"</span>, <span class="st">"autos_man"</span>,</span></span>
<span class="r-in"><span>                                   <span class="st">"camions_alb"</span>, <span class="st">"camions_sask"</span>, <span class="st">"camions_man"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                        total1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"total_autos"</span>, <span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                   <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"total_camions"</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                        total2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"total_alb"</span>, <span class="st">"total_sask"</span>, <span class="st">"total_man"</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Données du problème</span></span></span>
<span class="r-in"><span><span class="va">mes_series2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>autos_alb <span class="op">=</span> <span class="fl">12</span>, autos_sask <span class="op">=</span> <span class="fl">14</span>, autos_man <span class="op">=</span> <span class="fl">13</span>,</span></span>
<span class="r-in"><span>                          camions_alb <span class="op">=</span> <span class="fl">20</span>, camions_sask <span class="op">=</span> <span class="fl">20</span>, camions_man <span class="op">=</span> <span class="fl">24</span>,</span></span>
<span class="r-in"><span>                          total_alb <span class="op">=</span> <span class="fl">30</span>, total_sask <span class="op">=</span> <span class="fl">31</span>, total_man <span class="op">=</span> <span class="fl">32</span>,</span></span>
<span class="r-in"><span>                          total_autos <span class="op">=</span> <span class="fl">40</span>, total_camions <span class="op">=</span> <span class="fl">53</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Réconcilier les données</span></span></span>
<span class="r-in"><span><span class="va">res_ratis2</span> <span class="op">&lt;-</span> <span class="fu">tsraking</span><span class="op">(</span><span class="va">mes_series2</span>, <span class="va">mes_meta2</span>,</span></span>
<span class="r-in"><span>                       alterability_df <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>camions_sask <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                       quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Données initiales</span></span></span>
<span class="r-in"><span><span class="va">mes_series2</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   autos_alb autos_sask autos_man camions_alb camions_sask camions_man total_alb</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        12         14        13          20           20          24        30</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   total_sask total_man total_autos total_camions</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         31        32          40            53</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Données réconciliées</span></span></span>
<span class="r-in"><span><span class="va">res_ratis2</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   autos_alb autos_sask autos_man camions_alb camions_sask camions_man total_alb</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  14.31298         11  14.68702    15.68702           20    17.31298        30</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   total_sask total_man total_autos total_camions</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         31        32          40            53</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Vérifier les contraintes transversales en sortie</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">res_ratis2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"autos_alb"</span>, <span class="st">"autos_sask"</span>, <span class="st">"autos_man"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, <span class="va">res_ratis2</span><span class="op">$</span><span class="va">total_autos</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">res_ratis2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"camions_alb"</span>, <span class="st">"camions_sask"</span>, <span class="st">"camions_man"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, <span class="va">res_ratis2</span><span class="op">$</span><span class="va">total_camions</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">res_ratis2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"autos_alb"</span>, <span class="st">"camions_alb"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, <span class="va">res_ratis2</span><span class="op">$</span><span class="va">total_alb</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">res_ratis2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"autos_sask"</span>, <span class="st">"camions_sask"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, <span class="va">res_ratis2</span><span class="op">$</span><span class="va">total_sask</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">res_ratis2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"autos_man"</span>, <span class="st">"camions_man"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, <span class="va">res_ratis2</span><span class="op">$</span><span class="va">total_man</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Vérifier le total de contrôle (fixe)</span></span></span>
<span class="r-in"><span><span class="va">cols_tot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">union</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">mes_meta2</span><span class="op">$</span><span class="va">total1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">mes_meta2</span><span class="op">$</span><span class="va">total2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">mes_series2</span><span class="op">[</span><span class="va">cols_tot</span><span class="op">]</span>, <span class="va">res_ratis2</span><span class="op">[</span><span class="va">cols_tot</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Vérifier la valeur des camions en Saskatchewan (fixée à 20)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">mes_series2</span><span class="op">$</span><span class="va">camions_sask</span>, <span class="va">res_ratis2</span><span class="op">$</span><span class="va">camions_sask</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table des matières"><h2>Sur cette page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Développé par Michel Ferland, Statistics Canada.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site créé avec <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

