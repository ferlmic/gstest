<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Build the core elements (building blocks) for the balancing problems. — build_balancing_problem • gstest</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Build the core elements (building blocks) for the balancing problems. — build_balancing_problem"><meta name="description" content="
This function is used internally by tsbalancing() to build the core elements of the balancing problems.
It can also be useful to derive the indirect series associated to equality balancing constraints manually
(outside of the tsbalancing() context)."><meta property="og:description" content="
This function is used internally by tsbalancing() to build the core elements of the balancing problems.
It can also be useful to derive the indirect series associated to equality balancing constraints manually
(outside of the tsbalancing() context)."><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gstest</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">3.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/gstest.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/benchmarking-cookbook.html">Benchmarking CookBook</a></li>
    <li><a class="dropdown-item" href="../articles/benchmarking-demo-script.html">A Beginner's Benchmarking Demo Script</a></li>
    <li><a class="dropdown-item" href="../articles/osqp-settings-sequence-dataframe.html">OSQP Settings Sequence Data Frame</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news"><li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ferlmic/gstest/tree/main/">G-Series 3.0 (latest - R package gstest 3.0.0)</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ferlmic/gstest/releases/tag/v2.0/">G-Series 2.0 (SAS® version)</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ferlmic/gstest/releases/tag/v1.04/">G-Series 1.04 (SAS® version)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ferlmic/gstest/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>

    <ul class="navbar-nav"><li class="nav-item"><a class="nav-link" href="#" onclick="window.location = location.href.replace('/en/','/fr/');"><span class="fa fa-language fa-lg"></span> Français</a></li></ul></div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Build the core elements (building blocks) for the balancing problems.</h1>
      <small class="dont-index">Source: <a href="https://github.com/ferlmic/gstest/tree/main/R/tsbalancing.R" class="external-link"><code>R/tsbalancing.R</code></a></small>
      <div class="d-none name"><code>build_balancing_problem.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p></p>
<p>This function is used internally by <code><a href="tsbalancing.html">tsbalancing()</a></code> to build the core elements of the balancing problems.
It can also be useful to derive the indirect series associated to equality balancing constraints manually
(outside of the <code><a href="tsbalancing.html">tsbalancing()</a></code> context).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">build_balancing_problem</span><span class="op">(</span></span>
<span>  <span class="va">in_ts</span>,</span>
<span>  <span class="va">problem_specs_df</span>,</span>
<span>  in_ts_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/deparse.html" class="external-link">deparse1</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span><span class="va">in_ts</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  ts_freq <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/time.html" class="external-link">frequency</a></span><span class="op">(</span><span class="va">in_ts</span><span class="op">)</span>,</span>
<span>  periods <span class="op">=</span> <span class="fu"><a href="time_values_conv.html">gs.time2str</a></span><span class="op">(</span><span class="va">in_ts</span><span class="op">)</span>,</span>
<span>  n_per <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">in_ts</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  specs_df_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/deparse.html" class="external-link">deparse1</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span><span class="va">problem_specs_df</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  temporal_grp_periodicity <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  alter_pos <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  alter_neg <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  alter_mix <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  lower_bound <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>,</span>
<span>  upper_bound <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  validation_only <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-in-ts">in_ts<a class="anchor" aria-label="anchor" href="#arg-in-ts"></a></dt>
<dd><p>(mandatory)</p>
<p>Time series ("ts" or "mts"), or object to be coerced to one, that contains the time series data to be
reconciled. They are the balancing problems' input data (initial solutions).</p></dd>


<dt id="arg-problem-specs-df">problem_specs_df<a class="anchor" aria-label="anchor" href="#arg-problem-specs-df"></a></dt>
<dd><p>(mandatory)</p>
<p>Balancing problem specifications data frame. Using a sparse format inspired from the SAS/OR\(^\circledR\) LP procedure’s
<em>sparse data input format</em> (SAS Institute 2015), it contains only the relevant information such as the nonzero coefficients
of the balancing constraints as well as the non-default alterability coefficients and lower/upper bounds (i.e., values that
would take precedence over those defined with arguments <code>alter_pos</code>, <code>alter_neg</code>, <code>alter_mix</code>, <code>alter_temporal</code>,
<code>lower_bound</code> and <code>upper_bound</code>).</p>
<p>The information is provided using four mandatory variables (<code>type</code>, <code>col</code>, <code>row</code> and <code>coef</code>) and one optional variable
(<code>timeVal</code>). An observation (a row) in the problem specs data frame either defines a label for one of the seven types of the
balancing problem elements with columns <code>type</code> and <code>row</code> (see <em>Label definition records</em> below) or specifies coefficients
(numerical values) for those balancing problem elements with variables <code>col</code>, <code>row</code>, <code>coef</code> and <code>timeVal</code> (see <em>Information
specification records</em> below).</p><ul><li><p><strong>Label definition records</strong> (<code>type</code> is not missing (is not <code>NA</code>))</p><ul><li><p><code>type</code> (chr): reserved keyword identifying the type of problem element being defined:</p><ul><li><p><code>EQ</code>: equality (\(=\)) balancing constraint</p></li>
<li><p><code>LE</code>: lower or equal (\(\le\)) balancing constraint</p></li>
<li><p><code>GE</code>: greater or equal (\(\ge\)) balancing constraint</p></li>
<li><p><code>lowerBd</code>: period value lower bound</p></li>
<li><p><code>upperBd</code>: period value upper bound</p></li>
<li><p><code>alter</code>: period values alterability coefficient</p></li>
<li><p><code>alterTmp</code>: temporal total alterability coefficient</p></li>
</ul></li>
<li><p><code>row</code> (chr): label to be associated to the problem element (<em><code>type</code> keyword</em>)</p></li>
<li><p><em>all other variables are irrelevant and should contain missing data (<code>NA</code> values)</em> <br><br></p></li>
</ul></li>
<li><p><strong>Information specification records</strong> (<code>type</code> is missing (is <code>NA</code>))</p><ul><li><p><code>type</code> (chr): not applicable (<code>NA</code>)</p></li>
<li><p><code>col</code> (chr): series name or reserved word <code>_rhs_</code> to specify a balancing constraint right-hand side (RHS) value.</p></li>
<li><p><code>row</code> (chr): problem element label.</p></li>
<li><p><code>coef</code> (num): problem element value:</p><ul><li><p>balancing constraint series coefficient or RHS value</p></li>
<li><p>series period value lower or upper bound</p></li>
<li><p>series period value or temporal total alterability coefficient</p></li>
</ul></li>
<li><p><code>timeVal</code> (num): optional time value to restrict the application of series bounds or alterability coefficients
to a specific time period (or temporal group). It corresponds to the time value, as returned by <code><a href="https://rdrr.io/r/stats/time.html" class="external-link">stats::time()</a></code>, of a given
input time series (argument <code>in_ts</code>) period (observation) and is conceptually equivalent to \(year + (period - 1) /
  frequency\).</p></li>
</ul></li>
</ul><p>Note that empty strings (<code>""</code> or <code>''</code>) for character variables are interpreted as missing (<code>NA</code>) by the function. Variable
<code>row</code> identifies the elements of the balancing problem and is the key variable that makes the link between both types of
records. The same label (<code>row</code>) cannot be associated with more than one type of problem element (<code>type</code>) and multiple labels
(<code>row</code>) cannot be defined for the same given type of problem element (<code>type</code>), except for balancing constraints (values
<code>"EQ"</code>, <code>"LE"</code> and <code>"GE"</code> of column <code>type</code>). User-friendly features of the problem specs data frame include:</p><ul><li><p>The order of the observations (rows) is not important.</p></li>
<li><p>Character values (variables <code>type</code>, <code>row</code> and <code>col</code>) are not case sensitive (e.g., strings <code>"Constraint 1"</code> and
<code>"CONSTRAINT 1"</code> for <code>row</code> would be considered as the same problem element label), except when <code>col</code> is used to specify a
series name (a column of the input time series object) where <strong>case sensitivity is enforced</strong>.</p></li>
<li><p>The variable names of the problem specs data frame are also not case sensitive (e.g., <code>type</code>, <code>Type</code> or <code>TYPE</code> are all
valid) and <code>time_val</code> is an accepted variable name (instead of <code>timeVal</code>).</p></li>
</ul><p>Finally, the following table lists valid aliases for the <em><code>type</code> keywords</em> (type of problem element):</p><table class="table table"><tr><td><strong>Keyword</strong></td><td><strong>Aliases</strong></td></tr><tr><td><code>EQ</code></td><td><code>==</code>, <code>=</code></td></tr><tr><td><code>LE</code></td><td><code>&lt;=</code>, <code>&lt;</code></td></tr><tr><td><code>GE</code></td><td><code>&gt;=</code>, <code>&gt;</code></td></tr><tr><td><code>lowerBd</code></td><td><code>lowerBound</code>, <code>lowerBnd</code>, + <em>same terms with '_', '.' or ' ' between words</em></td></tr><tr><td><code>upperBd</code></td><td><code>upperBound</code>, <code>upperBnd</code>, + <em>same terms with '_', '.' or ' ' between words</em></td></tr><tr><td><code>alterTmp</code></td><td><code>alterTemporal</code>, <code>alterTemp</code>, + <em>same terms with '_', '.' or ' ' between words</em></td></tr></table><p>Reviewing the <strong>Examples</strong> should help conceptualize the balancing problem specifications data frame.</p></dd>


<dt id="arg-in-ts-name">in_ts_name<a class="anchor" aria-label="anchor" href="#arg-in-ts-name"></a></dt>
<dd><p>(optional)</p>
<p>String containing the value of argument <code>in_ts</code>.</p>
<p><strong>Default value</strong> is <code>in_ts_name = deparse1(substitute(in_ts))</code>.</p></dd>


<dt id="arg-ts-freq">ts_freq<a class="anchor" aria-label="anchor" href="#arg-ts-freq"></a></dt>
<dd><p>(optional)</p>
<p>Frequency of the time series object (argument <code>in_ts</code>).</p>
<p><strong>Default value</strong> is <code>ts_freq = stats::frequency(in_ts)</code>.</p></dd>


<dt id="arg-periods">periods<a class="anchor" aria-label="anchor" href="#arg-periods"></a></dt>
<dd><p>(optional)</p>
<p>Character vector describing the time series object (argument <code>in_ts</code>) periods.</p>
<p><strong>Default value</strong> is <code>periods = gs.time2str(in_ts)</code>.</p></dd>


<dt id="arg-n-per">n_per<a class="anchor" aria-label="anchor" href="#arg-n-per"></a></dt>
<dd><p>(optional)</p>
<p>Number of periods of the time series object (argument <code>in_ts</code>).</p>
<p><strong>Default value</strong> is <code>n_per = nrow(as.matrix(in_ts))</code>.</p></dd>


<dt id="arg-specs-df-name">specs_df_name<a class="anchor" aria-label="anchor" href="#arg-specs-df-name"></a></dt>
<dd><p>(optional)</p>
<p>String containing the value of argument <code>problem_specs_df</code>.</p>
<p><strong>Default value</strong> is <code>specs_df_name = deparse1(substitute(problem_specs_df))</code>.</p></dd>


<dt id="arg-temporal-grp-periodicity">temporal_grp_periodicity<a class="anchor" aria-label="anchor" href="#arg-temporal-grp-periodicity"></a></dt>
<dd><p>(optional)</p>
<p>Positive integer defining the number of periods in temporal groups for which the totals should be preserved.
E.g., specify <code>temporal_grp_periodicity = 3</code> with a monthly time series for quarterly total preservation and
<code>temporal_grp_periodicity = 12</code> (or <code>temporal_grp_periodicity = frequency(in_ts)</code>) for annual total preservation.
Specifying <code>temporal_grp_periodicity = 1</code> (<em>default</em>) corresponds to period-by-period processing without
temporal total preservation.</p>
<p><strong>Default value</strong> is <code>temporal_grp_periodicity = 1</code> (period-by-period processing without temporal total preservation).</p></dd>


<dt id="arg-alter-pos">alter_pos<a class="anchor" aria-label="anchor" href="#arg-alter-pos"></a></dt>
<dd><p>(optional)</p>
<p>Nonnegative real number specifying the default alterability coefficient associated to the values of time series with <strong>positive</strong>
coefficients in all balancing constraints in which they are involved (e.g., component series in aggregation table raking problems).
Alterability coefficients provided in the problem specification data frame (argument <code>problem_specs_df</code>) override this value.</p>
<p><strong>Default value</strong> is <code>alter_pos = 1.0</code> (nonbinding values).</p></dd>


<dt id="arg-alter-neg">alter_neg<a class="anchor" aria-label="anchor" href="#arg-alter-neg"></a></dt>
<dd><p>(optional)</p>
<p>Nonnegative real number specifying the default alterability coefficient associated to the values of time series with <strong>negative</strong>
coefficients in all balancing constraints in which they are involved (e.g., marginal totals in aggregation table raking problems).
Alterability coefficients provided in the problem specification data frame (argument <code>problem_specs_df</code>) override this value.</p>
<p><strong>Default value</strong> is <code>alter_neg = 1.0</code> (nonbinding values).</p></dd>


<dt id="arg-alter-mix">alter_mix<a class="anchor" aria-label="anchor" href="#arg-alter-mix"></a></dt>
<dd><p>(optional)</p>
<p>Nonnegative real number specifying the default alterability coefficient associated to the values of time series with a mix of
<strong>positive and negative</strong> coefficients in the balancing constraints in which they are involved. Alterability coefficients provided
in the problem specification data frame (argument <code>problem_specs_df</code>) override this value.</p>
<p><strong>Default value</strong> is <code>alter_mix = 1.0</code> (nonbinding values).</p></dd>


<dt id="arg-lower-bound">lower_bound<a class="anchor" aria-label="anchor" href="#arg-lower-bound"></a></dt>
<dd><p>(optional)</p>
<p>Real number specifying the default lower bound for the time series values. Lower bounds provided in the problem specification
data frame (argument <code>problem_specs_df</code>) override this value.</p>
<p><strong>Default value</strong> is <code>lower_bound = -Inf</code> (unbounded).</p></dd>


<dt id="arg-upper-bound">upper_bound<a class="anchor" aria-label="anchor" href="#arg-upper-bound"></a></dt>
<dd><p>(optional)</p>
<p>Real number specifying the default upper bound for the time series values. Upper bounds provided in the problem specification
data frame (argument <code>problem_specs_df</code>) override this value.</p>
<p><strong>Default value</strong> is <code>upper_bound = Inf</code> (unbounded).</p></dd>


<dt id="arg-validation-only">validation_only<a class="anchor" aria-label="anchor" href="#arg-validation-only"></a></dt>
<dd><p>(optional)</p>
<p>Logical argument specifying whether the function should only perform input data validation or not. When
<code>validation_only = TRUE</code>, the specified <em>balancing constraints</em> and <em>period value (lower and upper) bounds</em> constraints
are validated against the input time series data, allowing for discrepancies up to the value specified with argument
<code>validation_tol</code>. Otherwise, when <code>validation_only = FALSE</code> (default), the input data are first reconciled and the
resulting (output) data are then validated.</p>
<p><strong>Default value</strong> is <code>validation_only = FALSE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list with the elements of the balancing problems (excluding the temporal totals info):</p><ul><li><p><code>labels_df</code>: cleaned-up version of the <em>label definition records</em> from <code>problem_specs_df</code>
(<code>type</code> is not missing (is not <code>NA</code>)); extra columns:</p><ul><li><p><code>type.lc</code> : <code>tolower(type)</code></p></li>
<li><p><code>row.lc</code>  : <code>tolower(row)</code></p></li>
<li><p><code>con.flag</code>: <code>type.lc %in% c("eq", "le", "ge")</code></p></li>
</ul></li>
<li><p><code>coefs_df</code> : cleaned-up version of the information specification records from <code>problem_specs_df</code>
(<code>type</code> is missing (is <code>NA</code>); extra columns:</p><ul><li><p><code>row.lc</code>  : <code>tolower(row)</code></p></li>
<li><p><code>con.flag</code>: <code>labels_df$con.flag</code> allocated through <code>row.lc</code></p></li>
</ul></li>
<li><p><code>values_ts</code>: reduced version of 'in_ts' with only the relevant series (see vector <code>ser_names</code>)</p></li>
<li><p><code>lb</code>       : lower bound info (<code>type.lc  = "lowerbd"</code>) for the relevant series; list object with the
following elements:</p><ul><li><p><code>coefs_ts</code>       : lower bound values for series and period</p></li>
<li><p><code>nondated_coefs</code> : vector of nondated lower bounds from <code>problem_specs_df</code> (<code>timeVal</code> is <code>NA</code>)</p></li>
<li><p><code>nondated_id_vec</code>: vector of <code>ser_names</code> id's associated to vector <code>nondated_coefs</code></p></li>
<li><p><code>dated_id_vec</code>   : vector of <code>ser_names</code> id's associated to dated lower bounds from
<code>problem_specs_df</code> (<code>timeVal</code> is not <code>NA</code>)</p></li>
</ul></li>
<li><p><code>ub</code>       : <code>lb</code> equivalent for upper bounds (<code>type.lc = "upperbd"</code>)</p></li>
<li><p><code>alter</code>    : <code>lb</code> equivalent for period value alterability coefficients (<code>type.lc = "alter"</code>)</p></li>
<li><p><code>altertmp</code> : <code>lb</code> equivalent for temporal total alterability coefficients (<code>type.lc = "altertmp"</code>)</p></li>
<li><p><code>ser_names</code>: vector of the relevant series names (set of series involved in the balancing constraints)</p></li>
<li><p><code>pos_ser</code>  : vector of series names that have only positive nonzero coefficients across all balancing constraints</p></li>
<li><p><code>neg_ser</code>  : vector of series names that have only negative nonzero coefficients across all balancing constraints</p></li>
<li><p><code>mix_ser</code>  : vector of series names that have both positive and negative nonzero coefficients across all balancing
constraints</p></li>
<li><p><code>A1</code>,<code>op1</code>,<code>b1</code>: balancing constraint elements for problems involving a single period (e.g., each period of an
incomplete temporal group)</p></li>
<li><p><code>A2</code>,<code>op2</code>,<code>b2</code>: balancing constraint elements for problems involving <code>temporal_grp_periodicity</code> periods (e.g., the set
of periods of a complete temporal group)</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>See <code><a href="tsbalancing.html">tsbalancing()</a></code> for a detailed description of <em>time series balancing</em> problems.</p>
<p>Any missing (<code>NA</code>) value found in the input time series object (argument <code>in_ts</code>) would be replaced with 0 in <code>values_ts</code>
and trigger a warning message.</p>
<p>The returned elements of the balancing problems do not include the implicit temporal totals (i.e., elements <code>A2</code>, <code>op2</code>
and <code>b2</code> only contain the balancing constraints).</p>
<p>Multi-period balancing problem elements <code>A2</code>, <code>op2</code> and <code>b2</code> (when <code>temporal_grp_periodicity &gt; 1</code>) are constructed
<em>column by column</em> (in "column-major order"), corresponding to the default behaviour of R for converting objects of class
"matrix" into vectors. I.e., the balancing constraints conceptually correspond to:</p><ul><li><p><code>A1 %*% values_ts[t, ] op1 b1</code> for problems involving a single period (<code>t</code>)</p></li>
<li><p><code>A2 %*% as.vector(values_ts[t1:t2, ]) op2 b2</code> for problems involving <code>temporal_grp_periodicity</code> periods (<code>t1:t2</code>).</p></li>
</ul><p>Note that argument <code>alter_temporal</code> has not been applied yet at this point and <code>altertmp$coefs_ts</code> only contains the
coefficients specified in the problem specs data frame (argument <code>problem_specs_df</code>). I.e., <code>altertmp$coefs_ts</code> contains
missing (<code>NA</code>) values except for the temporal total alterability coefficients included in (specified with) <code>problem_specs_df</code>.
This is done in order to simplify the identification of the first non missing (non <code>NA</code>) temporal total alterability
coefficient of each complete temporal group (to occur later, when applicable, inside <code><a href="tsbalancing.html">tsbalancing()</a></code>).</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="tsbalancing.html">tsbalancing()</a></code> <code><a href="build_raking_problem.html">build_raking_problem()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">######################################################################################</span></span></span>
<span class="r-in"><span><span class="co">#        Indirect series derivation framework with `tsbalancing()` metadata</span></span></span>
<span class="r-in"><span><span class="co">######################################################################################</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># Is is assumed (agreed) that...</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># a) All balancing constraints are equality constraints (`type = EQ`).</span></span></span>
<span class="r-in"><span><span class="co"># b) All constraints have only one nonbinding (free) series: the series to be derived</span></span></span>
<span class="r-in"><span><span class="co">#    (i.e., all series have an alter. coef of 0 except the series to be derived).</span></span></span>
<span class="r-in"><span><span class="co"># c) Each constraint derives a different (new) series.</span></span></span>
<span class="r-in"><span><span class="co"># d) Constraints are the same for all periods (i.e., no "dated" alter. coefs </span></span></span>
<span class="r-in"><span><span class="co">#    specified with column `timeVal`).</span></span></span>
<span class="r-in"><span><span class="co">######################################################################################</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Derive the 5 marginal totals of a 2 x 3 two-dimensional data cube using `tsbalancing()` </span></span></span>
<span class="r-in"><span><span class="co"># metadata (data cube aggregation constraints respect the above assumptions).</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Build the balancing problem specs through the (simpler) raking metadata.</span></span></span>
<span class="r-in"><span><span class="va">my_specs</span> <span class="op">&lt;-</span> <span class="fu"><a href="rkMeta_to_blSpecs.html">rkMeta_to_blSpecs</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>series <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A1"</span>, <span class="st">"A2"</span>, <span class="st">"A3"</span>,</span></span>
<span class="r-in"><span>                        <span class="st">"B1"</span>, <span class="st">"B2"</span>, <span class="st">"B3"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             total1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"totA"</span>, <span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                        <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"totB"</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             total2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tot1"</span>, <span class="st">"tot2"</span>, <span class="st">"tot3"</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  alterSeries <span class="op">=</span> <span class="fl">0</span>,  <span class="co"># binding (fixed) component series</span></span></span>
<span class="r-in"><span>  alterTotal1 <span class="op">=</span> <span class="fl">1</span>,  <span class="co"># nonbinding (free) marginal totals (to be derived)</span></span></span>
<span class="r-in"><span>  alterTotal2 <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>  <span class="co"># nonbinding (free) marginal totals (to be derived)</span></span></span>
<span class="r-in"><span><span class="va">my_specs</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     type  col                       row coef timeVal</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     EQ &lt;NA&gt;   Marginal Total 1 (totA)   NA      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   &lt;NA&gt;   A1   Marginal Total 1 (totA)    1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3   &lt;NA&gt;   A2   Marginal Total 1 (totA)    1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4   &lt;NA&gt;   A3   Marginal Total 1 (totA)    1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   &lt;NA&gt; totA   Marginal Total 1 (totA)   -1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6     EQ &lt;NA&gt;   Marginal Total 2 (totB)   NA      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7   &lt;NA&gt;   B1   Marginal Total 2 (totB)    1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8   &lt;NA&gt;   B2   Marginal Total 2 (totB)    1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9   &lt;NA&gt;   B3   Marginal Total 2 (totB)    1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10  &lt;NA&gt; totB   Marginal Total 2 (totB)   -1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11    EQ &lt;NA&gt;   Marginal Total 3 (tot1)   NA      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12  &lt;NA&gt;   A1   Marginal Total 3 (tot1)    1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13  &lt;NA&gt;   B1   Marginal Total 3 (tot1)    1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14  &lt;NA&gt; tot1   Marginal Total 3 (tot1)   -1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15    EQ &lt;NA&gt;   Marginal Total 4 (tot2)   NA      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16  &lt;NA&gt;   A2   Marginal Total 4 (tot2)    1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17  &lt;NA&gt;   B2   Marginal Total 4 (tot2)    1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18  &lt;NA&gt; tot2   Marginal Total 4 (tot2)   -1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19    EQ &lt;NA&gt;   Marginal Total 5 (tot3)   NA      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20  &lt;NA&gt;   A3   Marginal Total 5 (tot3)    1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21  &lt;NA&gt;   B3   Marginal Total 5 (tot3)    1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22  &lt;NA&gt; tot3   Marginal Total 5 (tot3)   -1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23 alter &lt;NA&gt; Period Value Alterability   NA      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24  &lt;NA&gt;   A1 Period Value Alterability    0      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25  &lt;NA&gt;   A2 Period Value Alterability    0      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26  &lt;NA&gt;   A3 Period Value Alterability    0      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 27  &lt;NA&gt;   B1 Period Value Alterability    0      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28  &lt;NA&gt;   B2 Period Value Alterability    0      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 29  &lt;NA&gt;   B3 Period Value Alterability    0      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 30  &lt;NA&gt; totA Period Value Alterability    1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 31  &lt;NA&gt; totB Period Value Alterability    1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 32  &lt;NA&gt; tot1 Period Value Alterability    1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 33  &lt;NA&gt; tot2 Period Value Alterability    1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 34  &lt;NA&gt; tot3 Period Value Alterability    1      NA</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 6 periods (quarters) of data with marginal totals set to zero (0): they MUST exist</span></span></span>
<span class="r-in"><span><span class="co"># in the input data AND contain valid (non missing) data.</span></span></span>
<span class="r-in"><span><span class="va">my_ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ts.html" class="external-link">ts</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>A1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">10</span>, <span class="fl">12</span>,  <span class="fl">9</span>, <span class="fl">15</span>,  <span class="fl">7</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                       B1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">21</span>, <span class="fl">15</span>, <span class="fl">17</span>, <span class="fl">19</span>, <span class="fl">18</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                       A2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">14</span>,  <span class="fl">9</span>,  <span class="fl">8</span>,  <span class="fl">9</span>, <span class="fl">11</span>, <span class="fl">10</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                       B2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">29</span>, <span class="fl">20</span>, <span class="fl">24</span>, <span class="fl">21</span>, <span class="fl">17</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                       A3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">13</span>, <span class="fl">15</span>, <span class="fl">17</span>, <span class="fl">14</span>, <span class="fl">16</span>, <span class="fl">12</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                       B3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">24</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">23</span>, <span class="fl">21</span>, <span class="fl">19</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                       tot1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                       tot2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                       tot3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                       totA <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                       totB <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>            start <span class="op">=</span> <span class="fl">2019</span>, frequency <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get the balancing problem elements.</span></span></span>
<span class="r-in"><span><span class="va">n_per</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">my_ts</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">build_balancing_problem</span><span class="op">(</span><span class="va">my_ts</span>, <span class="va">my_specs</span>, </span></span>
<span class="r-in"><span>                             temporal_grp_periodicity <span class="op">=</span> <span class="va">n_per</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># `A2`, `op2` and `b2` define 30 constraints (5 marginal totals X 6 periods) </span></span></span>
<span class="r-in"><span><span class="co"># involving a total of 66 time series data points (11 series X 6 periods) of which </span></span></span>
<span class="r-in"><span><span class="co"># 36 belong to the 6 component series and 30 belong to the 5 marginal totals.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="va">A2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 30 66</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get the names of the marginal totals (series with a nonzero alter. coef), in the order </span></span></span>
<span class="r-in"><span><span class="co"># in which the corresponding constraints appear in the specs (constraints specification </span></span></span>
<span class="r-in"><span><span class="co"># order).</span></span></span>
<span class="r-in"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">$</span><span class="va">coefs_df</span><span class="op">$</span><span class="va">col</span><span class="op">[</span><span class="va">p</span><span class="op">$</span><span class="va">coefs_df</span><span class="op">$</span><span class="va">con.flag</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">tot_names</span> <span class="op">&lt;-</span> <span class="va">tmp</span><span class="op">[</span><span class="va">tmp</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">p</span><span class="op">$</span><span class="va">ser_names</span><span class="op">[</span><span class="va">p</span><span class="op">$</span><span class="va">alter</span><span class="op">$</span><span class="va">nondated_id_vec</span><span class="op">[</span><span class="va">p</span><span class="op">$</span><span class="va">alter</span><span class="op">$</span><span class="va">nondated_coefs</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">]</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define logical flags identifying the marginal total columns:</span></span></span>
<span class="r-in"><span><span class="co"># - `tot_col_logi1`: for single-period elements (of length 11 = number of series)</span></span></span>
<span class="r-in"><span><span class="co"># - `tot_col_logi2`: for multi-period elements (of length 66 = number of data points), </span></span></span>
<span class="r-in"><span><span class="co">#                    in "column-major order" (the `A2` matrix element construction order)</span></span></span>
<span class="r-in"><span><span class="va">tot_col_logi1</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">$</span><span class="va">ser_names</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">tot_names</span></span></span>
<span class="r-in"><span><span class="va">tot_col_logi2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">tot_col_logi1</span>, each <span class="op">=</span> <span class="va">n_per</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Order of the marginal totals to be derived based on</span></span></span>
<span class="r-in"><span><span class="co"># ... the input data columns ("mts" object `my_ts`)</span></span></span>
<span class="r-in"><span><span class="va">p</span><span class="op">$</span><span class="va">ser_names</span><span class="op">[</span><span class="va">tot_col_logi1</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "tot1" "tot2" "tot3" "totA" "totB"</span>
<span class="r-in"><span><span class="co"># ... the constraints specification (data frame `my_specs`)</span></span></span>
<span class="r-in"><span><span class="va">tot_names</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "totA" "totB" "tot1" "tot2" "tot3"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate the 5 marginal totals for all 6 periods</span></span></span>
<span class="r-in"><span><span class="co"># Note: the following calculation allows for general linear equality constraints, i.e.,</span></span></span>
<span class="r-in"><span><span class="co">#       a) nonzero right-hand side (RHS) constraint values (`b2`) and </span></span></span>
<span class="r-in"><span><span class="co">#       b) nonzero constraint coefs other than 1 for the component series and -1 for </span></span></span>
<span class="r-in"><span><span class="co">#          the derived series.</span></span></span>
<span class="r-in"><span><span class="va">my_ts</span><span class="op">[</span>, <span class="va">tot_names</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="co"># Constraints RHS.</span></span></span>
<span class="r-in"><span>    <span class="va">p</span><span class="op">$</span><span class="va">b2</span> <span class="op">-</span> </span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co"># Sums of the components ("weighted" by the constraint coefficients).</span></span></span>
<span class="r-in"><span>    <span class="va">p</span><span class="op">$</span><span class="va">A2</span><span class="op">[</span>, <span class="op">!</span><span class="va">tot_col_logi2</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="va">values_ts</span><span class="op">[</span>, <span class="op">!</span><span class="va">tot_col_logi1</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span> <span class="op">/</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Derived series constraint coefficients: `t()` allows for a "row-major order" search </span></span></span>
<span class="r-in"><span>  <span class="co"># in matrix `A2` (i.e., according to the constraints specification order).</span></span></span>
<span class="r-in"><span>  <span class="co"># Note: `diag(p$A2[, tot_col_logi2])` would work if `p$ser_names[tot_col_logi1]` and </span></span></span>
<span class="r-in"><span>  <span class="co">#       `tot_names` were identical (same totals order); however, the following search </span></span></span>
<span class="r-in"><span>  <span class="co">#       in "row-major order" will always work (and is necessary in the current case).</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="va">A2</span><span class="op">[</span>, <span class="va">tot_col_logi2</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="va">A2</span><span class="op">[</span>, <span class="va">tot_col_logi2</span><span class="op">]</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">my_ts</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         A1 B1 A2 B2 A3 B3 tot1 tot2 tot3 totA totB</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2019 Q1 12 20 14 20 13 24   32   34   37   39   64</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2019 Q2 10 21  9 29 15 20   31   38   35   34   70</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2019 Q3 12 15  8 20 17 30   27   28   47   37   65</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2019 Q4  9 17  9 24 14 23   26   33   37   32   64</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q1 15 19 11 21 16 21   34   32   37   42   61</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q2  7 18 10 17 12 19   25   27   31   29   54</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michel Ferland, Statistics Canada.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

