<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Restore cross-sectional (contemporaneous) linear constraints — tsbalancing • gstest</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Restore cross-sectional (contemporaneous) linear constraints — tsbalancing"><meta name="description" content="
Replication of the G-Series 2.0 SAS\(^\circledR\) GSeriesTSBalancing macro. See the
G-Series 2.0 documentation for details (Statistics Canada 2016).
This function balances (reconciles) a system of time series according to a set of linear constraints. The balancing
solution is obtained by solving one or several quadratic minimization problems (see section Details) with the OSQP
solver (Stellato et al. 2020). Given the feasibility of the balancing problem(s), the resulting time series data respect
the specified constraints for every time period. Linear equality and inequality constraints are allowed. Optionally, the
preservation of temporal totals may also be specified."><meta property="og:description" content="
Replication of the G-Series 2.0 SAS\(^\circledR\) GSeriesTSBalancing macro. See the
G-Series 2.0 documentation for details (Statistics Canada 2016).
This function balances (reconciles) a system of time series according to a set of linear constraints. The balancing
solution is obtained by solving one or several quadratic minimization problems (see section Details) with the OSQP
solver (Stellato et al. 2020). Given the feasibility of the balancing problem(s), the resulting time series data respect
the specified constraints for every time period. Linear equality and inequality constraints are allowed. Optionally, the
preservation of temporal totals may also be specified."><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gstest</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">3.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/gstest.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/benchmarking-cookbook.html">Benchmarking CookBook</a></li>
    <li><a class="dropdown-item" href="../articles/benchmarking-demo-script.html">A Beginner's Benchmarking Demo Script</a></li>
    <li><a class="dropdown-item" href="../articles/osqp-settings-sequence-dataframe.html">OSQP Settings Sequence Data Frame</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news"><li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ferlmic/gstest/tree/main/">G-Series 3.0 (latest - R package gstest 3.0.0)</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ferlmic/gstest/releases/tag/v2.0/">G-Series 2.0 (SAS® version)</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ferlmic/gstest/releases/tag/v1.04/">G-Series 1.04 (SAS® version)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ferlmic/gstest/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>

    <ul class="navbar-nav"><li class="nav-item"><a class="nav-link" href="#" onclick="window.location = location.href.replace('/en/','/fr/');"><span class="fa fa-language fa-lg"></span> Français</a></li></ul></div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Restore cross-sectional (contemporaneous) linear constraints</h1>
      <small class="dont-index">Source: <a href="https://github.com/ferlmic/gstest/tree/main/R/tsbalancing.R" class="external-link"><code>R/tsbalancing.R</code></a></small>
      <div class="d-none name"><code>tsbalancing.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p></p>
<p><em>Replication of the G-Series 2.0 SAS\(^\circledR\) <em><strong>GSeriesTSBalancing</strong></em> macro. See the
G-Series 2.0 documentation for details (Statistics Canada 2016).</em></p>
<p>This function balances (reconciles) a system of time series according to a set of linear constraints. The balancing
solution is obtained by solving one or several quadratic minimization problems (see section <strong>Details</strong>) with the OSQP
solver (Stellato et al. 2020). Given the feasibility of the balancing problem(s), the resulting time series data respect
the specified constraints for every time period. Linear equality and inequality constraints are allowed. Optionally, the
preservation of temporal totals may also be specified.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">tsbalancing</span><span class="op">(</span></span>
<span>  <span class="va">in_ts</span>,</span>
<span>  <span class="va">problem_specs_df</span>,</span>
<span>  temporal_grp_periodicity <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  temporal_grp_start <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  osqp_settings_df <span class="op">=</span> <span class="va">default_osqp_sequence</span>,</span>
<span>  display_level <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  alter_pos <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  alter_neg <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  alter_mix <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  alter_temporal <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  lower_bound <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>,</span>
<span>  upper_bound <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  tolV <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  tolV_temporal <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  tolP_temporal <span class="op">=</span> <span class="cn">NA</span>,</span>
<span></span>
<span>  <span class="co"># New in G-Series 3.0</span></span>
<span>  validation_tol <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>  trunc_to_zero_tol <span class="op">=</span> <span class="va">validation_tol</span>,</span>
<span>  full_sequence <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  validation_only <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-in-ts">in_ts<a class="anchor" aria-label="anchor" href="#arg-in-ts"></a></dt>
<dd><p>(mandatory)</p>
<p>Time series ("ts" or "mts"), or object to be coerced to one, that contains the time series data to be
reconciled. They are the balancing problems' input data (initial solutions).</p></dd>


<dt id="arg-problem-specs-df">problem_specs_df<a class="anchor" aria-label="anchor" href="#arg-problem-specs-df"></a></dt>
<dd><p>(mandatory)</p>
<p>Balancing problem specifications data frame. Using a sparse format inspired from the SAS/OR\(^\circledR\) LP procedure’s
<em>sparse data input format</em> (SAS Institute 2015), it contains only the relevant information such as the nonzero coefficients
of the balancing constraints as well as the non-default alterability coefficients and lower/upper bounds (i.e., values that
would take precedence over those defined with arguments <code>alter_pos</code>, <code>alter_neg</code>, <code>alter_mix</code>, <code>alter_temporal</code>,
<code>lower_bound</code> and <code>upper_bound</code>).</p>
<p>The information is provided using four mandatory variables (<code>type</code>, <code>col</code>, <code>row</code> and <code>coef</code>) and one optional variable
(<code>timeVal</code>). An observation (a row) in the problem specs data frame either defines a label for one of the seven types of the
balancing problem elements with columns <code>type</code> and <code>row</code> (see <em>Label definition records</em> below) or specifies coefficients
(numerical values) for those balancing problem elements with variables <code>col</code>, <code>row</code>, <code>coef</code> and <code>timeVal</code> (see <em>Information
specification records</em> below).</p><ul><li><p><strong>Label definition records</strong> (<code>type</code> is not missing (is not <code>NA</code>))</p><ul><li><p><code>type</code> (chr): reserved keyword identifying the type of problem element being defined:</p><ul><li><p><code>EQ</code>: equality (\(=\)) balancing constraint</p></li>
<li><p><code>LE</code>: lower or equal (\(\le\)) balancing constraint</p></li>
<li><p><code>GE</code>: greater or equal (\(\ge\)) balancing constraint</p></li>
<li><p><code>lowerBd</code>: period value lower bound</p></li>
<li><p><code>upperBd</code>: period value upper bound</p></li>
<li><p><code>alter</code>: period values alterability coefficient</p></li>
<li><p><code>alterTmp</code>: temporal total alterability coefficient</p></li>
</ul></li>
<li><p><code>row</code> (chr): label to be associated to the problem element (<em><code>type</code> keyword</em>)</p></li>
<li><p><em>all other variables are irrelevant and should contain missing data (<code>NA</code> values)</em> <br><br></p></li>
</ul></li>
<li><p><strong>Information specification records</strong> (<code>type</code> is missing (is <code>NA</code>))</p><ul><li><p><code>type</code> (chr): not applicable (<code>NA</code>)</p></li>
<li><p><code>col</code> (chr): series name or reserved word <code>_rhs_</code> to specify a balancing constraint right-hand side (RHS) value.</p></li>
<li><p><code>row</code> (chr): problem element label.</p></li>
<li><p><code>coef</code> (num): problem element value:</p><ul><li><p>balancing constraint series coefficient or RHS value</p></li>
<li><p>series period value lower or upper bound</p></li>
<li><p>series period value or temporal total alterability coefficient</p></li>
</ul></li>
<li><p><code>timeVal</code> (num): optional time value to restrict the application of series bounds or alterability coefficients
to a specific time period (or temporal group). It corresponds to the time value, as returned by <code><a href="https://rdrr.io/r/stats/time.html" class="external-link">stats::time()</a></code>, of a given
input time series (argument <code>in_ts</code>) period (observation) and is conceptually equivalent to \(year + (period - 1) /
  frequency\).</p></li>
</ul></li>
</ul><p>Note that empty strings (<code>""</code> or <code>''</code>) for character variables are interpreted as missing (<code>NA</code>) by the function. Variable
<code>row</code> identifies the elements of the balancing problem and is the key variable that makes the link between both types of
records. The same label (<code>row</code>) cannot be associated with more than one type of problem element (<code>type</code>) and multiple labels
(<code>row</code>) cannot be defined for the same given type of problem element (<code>type</code>), except for balancing constraints (values
<code>"EQ"</code>, <code>"LE"</code> and <code>"GE"</code> of column <code>type</code>). User-friendly features of the problem specs data frame include:</p><ul><li><p>The order of the observations (rows) is not important.</p></li>
<li><p>Character values (variables <code>type</code>, <code>row</code> and <code>col</code>) are not case sensitive (e.g., strings <code>"Constraint 1"</code> and
<code>"CONSTRAINT 1"</code> for <code>row</code> would be considered as the same problem element label), except when <code>col</code> is used to specify a
series name (a column of the input time series object) where <strong>case sensitivity is enforced</strong>.</p></li>
<li><p>The variable names of the problem specs data frame are also not case sensitive (e.g., <code>type</code>, <code>Type</code> or <code>TYPE</code> are all
valid) and <code>time_val</code> is an accepted variable name (instead of <code>timeVal</code>).</p></li>
</ul><p>Finally, the following table lists valid aliases for the <em><code>type</code> keywords</em> (type of problem element):</p><table class="table table"><tr><td><strong>Keyword</strong></td><td><strong>Aliases</strong></td></tr><tr><td><code>EQ</code></td><td><code>==</code>, <code>=</code></td></tr><tr><td><code>LE</code></td><td><code>&lt;=</code>, <code>&lt;</code></td></tr><tr><td><code>GE</code></td><td><code>&gt;=</code>, <code>&gt;</code></td></tr><tr><td><code>lowerBd</code></td><td><code>lowerBound</code>, <code>lowerBnd</code>, + <em>same terms with '_', '.' or ' ' between words</em></td></tr><tr><td><code>upperBd</code></td><td><code>upperBound</code>, <code>upperBnd</code>, + <em>same terms with '_', '.' or ' ' between words</em></td></tr><tr><td><code>alterTmp</code></td><td><code>alterTemporal</code>, <code>alterTemp</code>, + <em>same terms with '_', '.' or ' ' between words</em></td></tr></table><p>Reviewing the <strong>Examples</strong> should help conceptualize the balancing problem specifications data frame.</p></dd>


<dt id="arg-temporal-grp-periodicity">temporal_grp_periodicity<a class="anchor" aria-label="anchor" href="#arg-temporal-grp-periodicity"></a></dt>
<dd><p>(optional)</p>
<p>Positive integer defining the number of periods in temporal groups for which the totals should be preserved.
E.g., specify <code>temporal_grp_periodicity = 3</code> with a monthly time series for quarterly total preservation and
<code>temporal_grp_periodicity = 12</code> (or <code>temporal_grp_periodicity = frequency(in_ts)</code>) for annual total preservation.
Specifying <code>temporal_grp_periodicity = 1</code> (<em>default</em>) corresponds to period-by-period processing without
temporal total preservation.</p>
<p><strong>Default value</strong> is <code>temporal_grp_periodicity = 1</code> (period-by-period processing without temporal total preservation).</p></dd>


<dt id="arg-temporal-grp-start">temporal_grp_start<a class="anchor" aria-label="anchor" href="#arg-temporal-grp-start"></a></dt>
<dd><p>(optional)</p>
<p>Integer in the [1 .. <code>temporal_grp_periodicity</code>] interval specifying the starting period (cycle) for temporal
total preservation. E.g., annual totals corresponding to fiscal years defined from April to March of the
following year would be specified with <code>temporal_grp_start = 4</code> for a monthly time series (<code>frequency(in_ts) = 12</code>)
and <code>temporal_grp_start = 2</code> for a quarterly time series (<code>frequency(in_ts) = 4</code>). This argument has no effect
for period-by-period processing without temporal total preservation (<code>temporal_grp_periodicity = 1</code>).</p>
<p><strong>Default value</strong> is <code>temporal_grp_start = 1</code>.</p></dd>


<dt id="arg-osqp-settings-df">osqp_settings_df<a class="anchor" aria-label="anchor" href="#arg-osqp-settings-df"></a></dt>
<dd><p>(optional)</p>
<p>Data frame containing a sequence of OSQP settings for solving the balancing problems. The package includes two
predefined OSQP settings sequence data frames:</p><ul><li><p><a href="osqp_settings_sequence.html">default_osqp_sequence</a>: fast and effective (default);</p></li>
<li><p><a href="osqp_settings_sequence.html">alternate_osqp_sequence</a>: geared towards precision at the expense of execution time.</p></li>
</ul><p>See <code><a href="../articles/osqp-settings-sequence-dataframe.html">vignette("osqp-settings-sequence-dataframe")</a></code> for more details on this topic and to see the actual contents
of these two data frames. Note that the concept of a <em>solving sequence</em> with different sets of solver settings is
new in G-Series 3.0 (a single solving attempt was made in G-Series 2.0).</p>
<p><strong>Default value</strong> is <code>osqp_settings_df = default_osqp_sequence</code>.</p></dd>


<dt id="arg-display-level">display_level<a class="anchor" aria-label="anchor" href="#arg-display-level"></a></dt>
<dd><p>(optional)</p>
<p>Integer in the [0 .. 3] interval specifying the level of information to display in the console (<code><a href="https://rdrr.io/r/base/showConnections.html" class="external-link">stdout()</a></code>).
Note that specifying argument <code>quiet = TRUE</code> would <em>nullify</em> argument <code>display_level</code> (none of the following information
would be displayed).</p><table class="table table"><tr><td><strong>Displayed information</strong></td><td><strong><code>0</code></strong></td><td><strong><code>1</code></strong></td><td><strong><code>2</code></strong></td><td><strong><code>3</code></strong></td></tr><tr><td>Function header</td><td>\(\checkmark\)</td><td>\(\checkmark\)</td><td>\(\checkmark\)</td><td>\(\checkmark\)</td></tr><tr><td>Balancing problem elements</td><td></td><td>\(\checkmark\)</td><td>\(\checkmark\)</td><td>\(\checkmark\)</td></tr><tr><td>Individual problem solving details</td><td></td><td></td><td>\(\checkmark\)</td><td>\(\checkmark\)</td></tr><tr><td>Individual problem results (values and constraints)</td><td></td><td></td><td></td><td>\(\checkmark\)</td></tr></table><p><strong>Default value</strong> is <code>display_level = 1</code>.</p></dd>


<dt id="arg-alter-pos">alter_pos<a class="anchor" aria-label="anchor" href="#arg-alter-pos"></a></dt>
<dd><p>(optional)</p>
<p>Nonnegative real number specifying the default alterability coefficient associated to the values of time series with <strong>positive</strong>
coefficients in all balancing constraints in which they are involved (e.g., component series in aggregation table raking problems).
Alterability coefficients provided in the problem specification data frame (argument <code>problem_specs_df</code>) override this value.</p>
<p><strong>Default value</strong> is <code>alter_pos = 1.0</code> (nonbinding values).</p></dd>


<dt id="arg-alter-neg">alter_neg<a class="anchor" aria-label="anchor" href="#arg-alter-neg"></a></dt>
<dd><p>(optional)</p>
<p>Nonnegative real number specifying the default alterability coefficient associated to the values of time series with <strong>negative</strong>
coefficients in all balancing constraints in which they are involved (e.g., marginal totals in aggregation table raking problems).
Alterability coefficients provided in the problem specification data frame (argument <code>problem_specs_df</code>) override this value.</p>
<p><strong>Default value</strong> is <code>alter_neg = 1.0</code> (nonbinding values).</p></dd>


<dt id="arg-alter-mix">alter_mix<a class="anchor" aria-label="anchor" href="#arg-alter-mix"></a></dt>
<dd><p>(optional)</p>
<p>Nonnegative real number specifying the default alterability coefficient associated to the values of time series with a mix of
<strong>positive and negative</strong> coefficients in the balancing constraints in which they are involved. Alterability coefficients provided
in the problem specification data frame (argument <code>problem_specs_df</code>) override this value.</p>
<p><strong>Default value</strong> is <code>alter_mix = 1.0</code> (nonbinding values).</p></dd>


<dt id="arg-alter-temporal">alter_temporal<a class="anchor" aria-label="anchor" href="#arg-alter-temporal"></a></dt>
<dd><p>(optional)</p>
<p>Nonnegative real number specifying the default alterability coefficient associated to the time series temporal totals.
Alterability coefficients provided in the problem specification data frame (argument <code>problem_specs_df</code>) override this value.</p>
<p><strong>Default value</strong> is <code>alter_temporal = 0.0</code> (binding values).</p></dd>


<dt id="arg-lower-bound">lower_bound<a class="anchor" aria-label="anchor" href="#arg-lower-bound"></a></dt>
<dd><p>(optional)</p>
<p>Real number specifying the default lower bound for the time series values. Lower bounds provided in the problem specification
data frame (argument <code>problem_specs_df</code>) override this value.</p>
<p><strong>Default value</strong> is <code>lower_bound = -Inf</code> (unbounded).</p></dd>


<dt id="arg-upper-bound">upper_bound<a class="anchor" aria-label="anchor" href="#arg-upper-bound"></a></dt>
<dd><p>(optional)</p>
<p>Real number specifying the default upper bound for the time series values. Upper bounds provided in the problem specification
data frame (argument <code>problem_specs_df</code>) override this value.</p>
<p><strong>Default value</strong> is <code>upper_bound = Inf</code> (unbounded).</p></dd>


<dt id="arg-tolv">tolV<a class="anchor" aria-label="anchor" href="#arg-tolv"></a></dt>
<dd><p>(optional)</p>
<p>Nonnegative real number specifying the tolerance, in absolute value, for the balancing constraints right-hand side (RHS)
values:</p><ul><li><p><code>EQ</code> constraints: \(\quad A\mathbf{x} = \mathbf{b} \quad\) become \(\quad \mathbf{b} - \epsilon \le A\mathbf{x}
\le \mathbf{b} + \epsilon\)</p></li>
<li><p><code>LE</code> constraints: \(\quad A\mathbf{x} \le \mathbf{b} \quad\) become \(\quad A\mathbf{x} \le \mathbf{b} +
\epsilon\)</p></li>
<li><p><code>GE</code> constraints: \(\quad A\mathbf{x} \ge \mathbf{b} \quad\) become \(\quad A\mathbf{x} \ge \mathbf{b} -
\epsilon\)</p></li>
</ul><p>where \(\epsilon\) is the tolerance specified with <code>tolV</code>. This argument does not apply to the <em>period value (lower
and upper) bounds</em> specified with arguments <code>lower_bound</code> and <code>upper_bound</code> or in the problem specs data frame (argument
<code>prob_specs_df</code>). I.e., <code>tolV</code> does not affect the time series values lower and upper bounds, unless they are specified as
<em>balancing constraints</em> instead (with <code>GE</code> and <code>LE</code> constraints in the problem specs data frame).</p>
<p><strong>Default value</strong> is <code>tolV = 0.0</code> (no tolerance).</p></dd>


<dt id="arg-tolv-temporal-tolp-temporal">tolV_temporal, tolP_temporal<a class="anchor" aria-label="anchor" href="#arg-tolv-temporal-tolp-temporal"></a></dt>
<dd><p>(optional)</p>
<p>Nonnegative real number, or <code>NA</code>, specifying the tolerance, in percentage (<code>tolP_temporal</code>) or absolute value
(<code>tolV_temporal</code>), for the implicit temporal aggregation constraints associated to <strong>binding temporal totals</strong>
\(\left( \sum_t{x_{i,t}} = \sum_t{y_{i,t}} \right)\), which become:
$$\sum_t{y_{i,t}} - \epsilon_\text{abs} \le \sum_t{x_{i,t}} \le \sum_t{y_{i,t}} + \epsilon_\text{abs}$$
or
$$\sum_t{y_{i,t}} \left( 1 - \epsilon_\text{rel} \right) \le \sum_t{x_{i,t}} \le \sum_t{y_{i,t}} \left( 1 +
\epsilon_\text{rel} \right)$$</p>
<p>where \(\epsilon_\text{abs}\) and \(\epsilon_\text{rel}\) are the absolute and percentage tolerances
specified respectively with <code>tolV_temporal</code> and  <code>tolP_temporal</code>. Both arguments cannot be specified together (one must be
specified while the other must be <code>NA</code>).</p>
<p><strong>Example:</strong> to set a tolerance of 10 <em>units</em>, specify
<code>tolV_temporal = 10, tolP_temporal = NA</code>; to set a tolerance of 1%, specify<code>tolV_temporal = NA, tolP_temporal = 0.01</code>.</p>
<p><strong>Default values</strong> are <code>tolV_temporal = 0.0</code> and <code>tolP_temporal = NA</code> (no tolerance).</p></dd>


<dt id="arg-validation-tol">validation_tol<a class="anchor" aria-label="anchor" href="#arg-validation-tol"></a></dt>
<dd><p>(optional)</p>
<p>Nonnegative real number specifying the tolerance for the validation of the balancing results. The function verifies if
the final (reconciled) time series values meet the constraints, allowing for discrepancies up to the value specified with
this argument. A warning is issued as soon as one constraint is not met (discrepancy greater than <code>validation_tol</code>).</p>
<p>With constraints defined as \(\mathbf{l} \le A\mathbf{x} \le \mathbf{u}\), where \(\mathbf{l = u}\)
for <code>EQ</code> constraints, \(\mathbf{l} = -\infty\) for <code>LE</code> constraints and \(\mathbf{u} = \infty\) for
<code>GE</code> constraints, <strong>constraint discrepancies</strong> correspond to \(\max \left( 0, \mathbf{l} - A\mathbf{x}, A\mathbf{x} -
\mathbf{u} \right)\), where constraint bounds \(\mathbf{l}\) and \(\mathbf{u}\) include
the tolerances, when applicable, specified with arguments <code>tolV</code>, <code>tolV_temporal</code> and <code>tolP_temporal</code>.</p>
<p><strong>Default value</strong> is <code>validation_tol = 0.001</code>.</p></dd>


<dt id="arg-trunc-to-zero-tol">trunc_to_zero_tol<a class="anchor" aria-label="anchor" href="#arg-trunc-to-zero-tol"></a></dt>
<dd><p>(optional)</p>
<p>Nonnegative real number specifying the tolerance, in absolute value, for replacing by zero (small) values in the output
(reconciled) time series data (output object <code>out_ts</code>). Specify <code>trunc_to_zero_tol = 0</code> to disable this <em>truncation to zero</em>
process on the reconciled data. Otherwise, specify <code>trunc_to_zero_tol &gt; 0</code> to replace with \(0.0\) any value in the
\(\left[ -\epsilon, \epsilon \right]\) interval, where \(\epsilon\) is the tolerance specified with
<code>trunc_to_zero_tol</code>.</p>
<p>Note that the final constraint discrepancies (see argument <code>validation_tol</code>) are calculated on the <em>zero truncated</em>
reconciled time series values, therefore ensuring accurate validation of the actual reconciled data returned by the
function.</p>
<p><strong>Default value</strong> is <code>trunc_to_zero_tol = validation_tol</code>.</p></dd>


<dt id="arg-full-sequence">full_sequence<a class="anchor" aria-label="anchor" href="#arg-full-sequence"></a></dt>
<dd><p>(optional)</p>
<p>Logical argument specifying whether all the steps of the <em>OSQP settings sequence data frame</em> should be performed or not.
See argument <code>osqp_settings_df</code> and <code><a href="../articles/osqp-settings-sequence-dataframe.html">vignette("osqp-settings-sequence-dataframe")</a></code> for more details on this topic.</p>
<p><strong>Default value</strong> is <code>full_sequence = FALSE</code>.</p></dd>


<dt id="arg-validation-only">validation_only<a class="anchor" aria-label="anchor" href="#arg-validation-only"></a></dt>
<dd><p>(optional)</p>
<p>Logical argument specifying whether the function should only perform input data validation or not. When
<code>validation_only = TRUE</code>, the specified <em>balancing constraints</em> and <em>period value (lower and upper) bounds</em> constraints
are validated against the input time series data, allowing for discrepancies up to the value specified with argument
<code>validation_tol</code>. Otherwise, when <code>validation_only = FALSE</code> (default), the input data are first reconciled and the
resulting (output) data are then validated.</p>
<p><strong>Default value</strong> is <code>validation_only = FALSE</code>.</p></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p>(optional)</p>
<p>Logical argument specifying whether or not to display only essential information such as warnings, errors and the period
(or set of periods) being reconciled. You could further suppress, if desired, the display of the <em>balancing period(s)</em>
information by <em>wrapping</em> your <code>tsbalancing()</code> call with <code><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages()</a></code>. In that case, the <strong>proc_grp_df</strong> output
data frame can be used to identify (unsuccessful) balancing problems associated with warning messages (if any). Note that
specifying <code>quiet = TRUE</code> would also <em>nullify</em> argument <code>display_level</code>.</p>
<p><strong>Default value</strong> is <code>quiet = FALSE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The function returns is a list of seven objects:</p><ul><li><p><strong>out_ts</strong>: modified version of the input time series object ("ts" or "mts"; see argument <code>in_ts</code>) with the resulting
reconciled time series values (primary function output). It can be explicitly coerced to another type of object with the
appropriate <code>as*()</code> function (e.g., <code><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html" class="external-link">tsibble::as_tsibble()</a></code> would coerce it to a tsibble).</p></li>
<li><p><strong>proc_grp_df</strong>: processing group summary data frame, useful to identify problems that have succeeded or failed.
It contains one observation (row) for each balancing problem with the following columns:</p><ul><li><p><code>proc_grp</code> (num): processing group id.</p></li>
<li><p><code>proc_grp_type</code> (chr): processing group type. Possible values are:</p><ul><li><p><code>"period"</code>;</p></li>
<li><p><code>"temporal group"</code>.</p></li>
</ul></li>
<li><p><code>proc_grp_label</code> (chr): string describing the processing group in the following format:</p><ul><li><p><code>"&lt;year&gt;-&lt;period&gt;"</code> (single periods)</p></li>
<li><p><code>"&lt;start year&gt;-&lt;start period&gt; - &lt;end year&gt;-&lt;end period&gt;"</code> (temporal groups)</p></li>
</ul></li>
<li><p><code>sol_status_val</code>, <code>sol_status</code> (num, chr): solution status numerical (integer) value and description string:</p><ul><li><p><code> 1</code>: <code>"valid initial solution"</code>;</p></li>
<li><p><code>-1</code>: <code>"invalid initial solution"</code>;</p></li>
<li><p><code> 2</code>: <code>"valid polished osqp solution"</code>;</p></li>
<li><p><code>-2</code>: <code>"invalid polished osqp solution"</code>;</p></li>
<li><p><code> 3</code>: <code>"valid unpolished osqp solution"</code>;</p></li>
<li><p><code>-3</code>: <code>"invalid unpolished osqp solution"</code>;</p></li>
<li><p><code>-4</code>: <code>"unsolvable fixed problem"</code> (invalid initial solution).</p></li>
</ul></li>
<li><p><code>n_unmet_con</code> (num): number of unmet constraints (<code>sum(prob_conf_df$unmet_flag)</code>).</p></li>
<li><p><code>max_discr</code> (num): maximum constraint discrepancy (<code>max(prob_conf_df$discr_out)</code>).</p></li>
<li><p><code>validation_tol</code> (num): specified tolerance for validation purposes (argument <code>validation_tol</code>).</p></li>
<li><p><code>sol_type</code> (chr): returned solution type. Possible values are:</p><ul><li><p><code>"initial"</code> (initial solution, i.e., input data values);</p></li>
<li><p><code>"osqp"</code> (OSQP solution).</p></li>
</ul></li>
<li><p><code>osqp_attempts</code> (num): number of attempts made with OSQP (depth achieved in the solving sequence).</p></li>
<li><p><code>osqp_seqno</code> (num): step # of the solving sequence corresponding to the returned solution. <code>NA</code> when
<code>sol_type = "initial"</code>.</p></li>
<li><p><code>osqp_status</code> (chr): OSQP status description string (<code>osqp_sol_info_df$status</code>). <code>NA</code> when <code>sol_type = "initial"</code>.</p></li>
<li><p><code>osqp_polished</code> (logi): <code>TRUE</code> if the returned OSQP solution is polished (<code>osqp_sol_info_df$status_polish = 1</code>), <code>FALSE</code> otherwise. <code>NA</code> when <code>sol_type = "initial"</code>.</p></li>
<li><p><code>total_solve_time</code> (num): total time, in seconds, of the solving sequence.</p></li>
</ul><p>Column <code>proc_grp</code> constitutes a <em>unique key</em> (distinct rows) for the data frame. Successful balancing problems
(problems with a valid solution) correspond to rows with <code>sol_status_val &gt; 0</code> or, equivalently, to <code>n_unmet_con = 0</code>
or to <code>max_discr &lt;= validation_tol</code>. The <em>initial solution</em> (<code>sol_type = "initial"</code>) is returned only if <strong>a)</strong>
there are no initial constraint discrepancies, <strong>b)</strong> the problem is fixed (all values are binding) or <strong>c)</strong> it beats
the OSQP solution (smaller total constraint discrepancies). The OSQP solving sequence is described in <code><a href="../articles/osqp-settings-sequence-dataframe.html">vignette("osqp-settings-sequence-dataframe")</a></code>.</p></li>
<li><p><strong>periods_df</strong>: time periods data frame, useful to match periods to processing groups. It contains one observation
(row) for each period of the input time series object (argument <code>in_ts</code>) with the following columns:</p><ul><li><p><code>proc_grp</code> (num): processing group id.</p></li>
<li><p><code>t</code> (num): time id (<code>1:nrow(in_ts)</code>).</p></li>
<li><p><code>time_val</code> (num): time value (<code>stats::time(in_ts)</code>). It conceptually corresponds to \(year + (period - 1) / frequency\).</p></li>
</ul><p>Columns <code>t</code> and <code>time_val</code> both constitute a <em>unique key</em> (distinct rows) for the data frame.</p></li>
<li><p><strong>prob_val_df</strong>: problem values data frame, useful to analyze change diagnostics, i.e., initial vs final (reconciled)
values. It contains one observation (row) for each value involved in each balancing problem, with the following columns:</p><ul><li><p><code>proc_grp</code> (num): processing group id.</p></li>
<li><p><code>val_type</code> (chr): problem value type. Possible values are:</p><ul><li><p><code>"period value"</code>;</p></li>
<li><p><code>"temporal total"</code>.</p></li>
</ul></li>
<li><p><code>name</code> (chr): time series (variable) name.</p></li>
<li><p><code>t</code> (num): time id (<code>1:nrow(in_ts)</code>); id of the first period of the temporal group for a <em>temporal total</em>.</p></li>
<li><p><code>time_val</code> (num): time value (<code>stats::time(in_ts)</code>); value of the first period of the temporal group for a
<em>temporal total</em>. It conceptually corresponds to \(year + (period - 1) / frequency\).</p></li>
<li><p><code>lower_bd</code>, <code>upper_bd</code> (num): period value bounds; always <code>-Inf</code> and <code>Inf</code> for a <em>temporal total</em>.</p></li>
<li><p><code>alter</code> (num): alterability coefficient.</p></li>
<li><p><code>value_in</code>, <code>value_out</code> (num): initial and final (reconciled) values.</p></li>
<li><p><code>dif</code> (num): <code>value_out - value_in</code>.</p></li>
<li><p><code>rdif</code> (num): <code>dif / value_in</code>; <code>NA</code> if <code>value_in = 0</code>.</p></li>
</ul><p>Columns <code>val_type + name + t</code> and <code>val_type + name + time_val</code> both constitute a <em>unique key</em> (distinct rows) for the
data frame. Binding (fixed) problem values correspond to rows with <code>alter = 0</code> or <code>value_in = 0</code>. Conversely, nonbinding
(free) problem values correspond to rows with <code>alter != 0</code> and <code>value_in != 0</code>.</p></li>
<li><p><strong>prob_con_df</strong>: problem constraints data frame, useful for troubleshooting problems that failed (identify unmet
constraints). It contains one observation (row) for each constraint involved in each balancing problem, with the following
columns:</p><ul><li><p><code>proc_grp</code> (num): processing group id.</p></li>
<li><p><code>con_type</code> (chr): problem constraint type. Possible values are:</p><ul><li><p><code>"balancing constraint"</code>;</p></li>
<li><p><code>"temporal aggregation constraint"</code>;</p></li>
<li><p><code>"period value bounds"</code>.</p></li>
</ul><p>While <em>balancing constraints</em> are specicied by the user, the other two types of constraints (<em>temporal aggregation
constraints</em> and <em>period value bounds</em>) are automatically added to the problem by the function (when applicable).</p></li>
<li><p><code>name</code> (chr): constraint label or time series (variable) name.</p></li>
<li><p><code>t</code> (num): time id (<code>1:nrow(in_ts)</code>); id of the first period of the temporal group for a <em>temporal aggregation constraint</em>.</p></li>
<li><p><code>time_val</code> (num): time value (<code>stats::time(in_ts)</code>); value of the first period of the temporal group for a <em>temporal
aggregation constraint</em>. It conceptually corresponds to \(year + (period - 1) / frequency\).</p></li>
<li><p><code>l</code>, <code>u</code>, <code>Ax_in</code>, <code>Ax_out</code> (num): initial and final constraint elements \(\left( \mathbf{l} \le A \mathbf{x} \le
  \mathbf{u} \right)\).</p></li>
<li><p><code>discr_in</code>, <code>discr_out</code> (num): initial and final constraint discrepancies \(\left( \max \left( 0, \mathbf{l} - A
  \mathbf{x}, A \mathbf{x} - \mathbf{u} \right) \right)\).</p></li>
<li><p><code>validation_tol</code> (num): specified tolerance for validation purposes (argument <code>validation_tol</code>).</p></li>
<li><p><code>unmet_flag</code> (logi): <code>TRUE</code> if the constraint is not met (<code>discr_out &gt; validation_tol</code>), <code>FALSE</code> otherwise.</p></li>
</ul><p>Columns <code>con_type + name + t</code> and <code>con_type + name + time_val</code> both constitute a <em>unique key</em> (distinct rows) for the
data frame. Constraint bounds \(\mathbf{l = u}\) for <code>EQ</code> constraints, \(\mathbf{l} = -\infty\) for
<code>LE</code> constraints, \(\mathbf{u} = \infty\) for <code>GE</code> constraints, and include the tolerances, when applicable,
specified with arguments <code>tolV</code>, <code>tolV_temporal</code> and <code>tolP_temporal</code>.</p></li>
<li><p><strong>osqp_settings_df</strong>: OSQP settings data frame. It contains one observation (row) for each problem (processing group)
solved with OSQP (<code>proc_grp_df$sol_type = "osqp"</code>), with the following columns:</p><ul><li><p><code>proc_grp</code> (num): processing group id.</p></li>
<li><p>one column corresponding to each element of the list returned by the <code>osqp::GetParams()</code> method applied to a
<em>OSQP solver object</em> (class "osqp_model" object as returned by <code><a href="https://rdrr.io/pkg/osqp/man/osqp.html" class="external-link">osqp::osqp()</a></code>), e.g.:</p><ul><li><p>Maximum iterations (<code>max_iter</code>);</p></li>
<li><p>Primal and dual infeasibility tolerances (<code>eps_prim_inf</code> and <code>eps_dual_inf</code>);</p></li>
<li><p>Solution polishing flag (<code>polish</code>);</p></li>
<li><p>Number of scaling iterations (<code>scaling</code>);</p></li>
<li><p>etc.</p></li>
</ul></li>
<li><p>extra settings specific to <code>tsbalancing()</code>:</p><ul><li><p><code>prior_scaling</code> (logi): <code>TRUE</code> if the problem data were scaled (using the average of the free (nonbinding) problem
values as the scaling factor) prior to solving with OSQP, <code>FALSE</code> otherwise.</p></li>
<li><p><code>require_polished</code> (logi): <code>TRUE</code> if a polished solution from OSQP (<code>osqp_sol_info_df$status_polish = 1</code>) was required for this step in order to end the solving
sequence, <code>FALSE</code> otherwise. See <code><a href="../articles/osqp-settings-sequence-dataframe.html">vignette("osqp-settings-sequence-dataframe")</a></code> for more details on the solving sequence
used by <code>tsbalancing()</code>.</p></li>
</ul></li>
</ul><p>Column <code>proc_grp</code> constitutes a <em>unique key</em> (distinct rows) for the data frame. Visit
<a href="https://osqp.org/docs/interfaces/solver_settings.html" class="external-link">https://osqp.org/docs/interfaces/solver_settings.html</a> for all available OSQP settings. Problems (processing groups) for
which the initial solution was returned (<code>proc_grp_df$sol_type = "initial"</code>) are not included in this data frame.</p></li>
<li><p><strong>osqp_sol_info_df</strong>: OSQP solution information data frame. It contains one observation (row) for each problem
(processing group) solved with OSQP (<code>proc_grp_df$sol_type = "osqp"</code>), with the following columns:</p><ul><li><p><code>proc_grp</code> (num): processing group id.</p></li>
<li><p>one column corresponding to each element of the <code>info</code> list of a <em>OSQP solver object</em> (class "osqp_model" object
as returned by <code><a href="https://rdrr.io/pkg/osqp/man/osqp.html" class="external-link">osqp::osqp()</a></code>) after having been solved with the <code>osqp::Solve()</code> method, e.g.:</p><ul><li><p>Solution status (<code>status</code> and <code>status_val</code>);</p></li>
<li><p>Polishing status (<code>status_polish</code>);</p></li>
<li><p>Number of iterations (<code>iter</code>);</p></li>
<li><p>Objective function value (<code>obj_val</code>);</p></li>
<li><p>Primal and dual residuals (<code>pri_res</code> and <code>dua_res</code>);</p></li>
<li><p>Solve time (<code>solve_time</code>);</p></li>
<li><p>etc.</p></li>
</ul></li>
<li><p>extra information specific to <code>tsbalancing()</code>:</p><ul><li><p><code>prior_scaling_factor</code> (num): value of the scaling factor when <code>osqp_settings_df$prior_scaling = TRUE</code> (<code>prior_scaling_factor = 1.0</code> otherwise).</p></li>
<li><p><code>obj_val_ori_prob</code> (num): original balancing problem's objective function value, which is the OSQP objective function
value (<code>obj_val</code>) on the original scale (when <code>osqp_settings_df$prior_scaling = TRUE</code>) plus the constant term of
the original balancing problem's objective function, i.e., <code>obj_val_ori_prob = obj_val * prior_scaling_factor + &lt;constant term&gt;</code>,
where <code>&lt;constant term&gt;</code> corresponds to
\(\mathbf{y}^{\mathrm{T}} W \mathbf{y}\). See section <strong>Details</strong> for the definition of vector
\(\mathbf{y}\), matrix \(W\) and, more generally speaking, the complete expression of the balancing problem's
objective function.</p></li>
</ul></li>
</ul><p>Column <code>proc_grp</code> constitutes a <em>unique key</em> (distinct rows) for the data frame. Visit <a href="https://osqp.org" class="external-link">https://osqp.org</a> for more information on
OSQP. Problems (processing groups) for which the initial solution was returned (<code>proc_grp_df$sol_type = "initial"</code>) are not
included in this data frame.</p></li>
</ul><p>Note that the "data.frame" objects returned by the function can be explicitly coerced to other types of objects with
the appropriate <code>as*()</code> function (e.g., <code><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">tibble::as_tibble()</a></code> would coerce any of them to a tibble).</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function solves one balancing problem per processing group (see section <strong>Processing groups</strong> for details). Each of these balancing
problems is a quadratic minimization problem of the following form:
$$\displaystyle
\begin{aligned}
&amp; \underset{\mathbf{x}}{\text{minimize}}
&amp; &amp; \mathbf{\left( y - x \right)}^{\mathrm{T}} W \mathbf{\left( y - x \right)} \\
&amp; \text{subject to}
&amp; &amp; \mathbf{l} \le A \mathbf{x} \le \mathbf{u}
\end{aligned}
$$
where</p><ul><li><p>\(\mathbf{y}\) is the vector of the initial problem values, i.e., the initial time series period values and, when applicable,
temporal totals;</p></li>
<li><p>\(\mathbf{x}\) is the final (reconciled) version of vector \(\mathbf{y}\);</p></li>
<li><p>matrix \(W = \mathrm{diag} \left( \mathbf{w} \right)\) with vector \(\mathbf{w}\) elements \(w_i = \left\{
    \begin{array}{cl}
      0 &amp; \text{if } |c_i y_i| = 0 \\
      \frac{1}{|c_i y_i|} &amp; \text{otherwise}
    \end{array} \right.
    \),
where \(c_i\) is the alterability coefficient of problem value \(y_i\) and cases corresponding to \(|c_i y_i|
    = 0\) are fixed problem values (binding period values or temporal totals);</p></li>
<li><p>matrix \(A\) and vectors \(\mathbf{l}\) and \(\mathbf{u}\) specify the <em>balancing constraints</em>, the <em>implicit
temporal total aggregation constraints</em> (when applicable), the <em>period value (upper and lower) bounds</em> as well as <em>\(x_i
= y_i\) constraints for fixed \(y_i\) values</em> \(\left( \left| c_i y_i \right| = 0 \right)\).</p></li>
</ul><p>In practice, the objective function of the problem solved by OSQP excludes constant term \(\mathbf{y}^{\mathrm{T}} W
\mathbf{y}\), therefore corresponding to \(\mathbf{x}^{\mathrm{T}} W \mathbf{x} - 2 \left( \mathbf{w} \mathbf{y}
\right)^{\mathrm{T}} \mathbf{x}\), and the fixed \(y_i\) values \(\left( \left| c_i y_i \right| = 0
\right)\) are removed from the problem, adjusting the constraints accordingly, i.e.:</p><ul><li><p>rows corresponding to the <em>\(x_i = y_i\) constraints for fixed \(y_i\) values</em> are removed from \(A\), \(
\mathbf{l}\) and \(\mathbf{u}\);</p></li>
<li><p>columns corresponding to fixed \(y_i\) values are removed from \(A\) while appropriately adjusting \(
\mathbf{l}\) and \(\mathbf{u}\).</p></li>
</ul><div class="section">
<h3 id="alterability-coefficients">Alterability Coefficients<a class="anchor" aria-label="anchor" href="#alterability-coefficients"></a></h3>


<p>Alterability coefficients are nonnegative numbers that change the relative cost of modifying an initial problem value.
By changing the actual objective function to minimize, they allow the generation of a wide range of solutions. Since they
appear in the denominator of the objective function (matrix \(W\)), the larger the alterability coefficient the less costly
it is to modify a problem value (period value or temporal total) and, conversely, the smaller the alterability coefficient
the more costly it becomes. This results in problem values with larger alterability coefficients proportionally changing more
than the ones with smaller alterability coefficients. Alterability coefficients of \(0.0\) define fixed (binding) problem
values while alterability coefficients greater than \(0.0\) define free (nonbinding) values. The default alterability
coefficients are \(0.0\) for temporal totals (argument <code>alter_temporal</code>) and \(1.0\) for period values (arguments
<code>alter_pos</code>, <code>alter_neg</code>, <code>alter_mix</code>). In the common case of aggregation table raking problems, the period values of the
marginal totals (time series with a coefficient of \(-1\) in the balancing constraints) are usually binding (specified
with <code>alter_neg = 0</code>) while the period values of the component series (time series with a coefficient of \(1\) in the
balancing constraints) are usually nonbinding (specified with <code>alter_pos &gt; 0</code>, e.g., <code>alter_pos = 1</code>). <em>Almost binding</em>
problem values (e.g., marginal totals or temporal totals) can be obtained in practice by specifying very small (almost
\(0.0\)) alterability coefficients relative to those of the other (nonbinding) problem values.</p>
<p><strong>Temporal total preservation</strong> refers to the fact that temporal totals, when applicable, are usually kept “as close as
possible” to their initial value. <em>Pure preservation</em> is achieved by default with binding temporal totals while the change
is minimized with nonbinding temporal totals (in accordance with the set of alterability coefficients).</p>
</div>

<div class="section">
<h3 id="validation-and-troubleshooting">Validation and troubleshooting<a class="anchor" aria-label="anchor" href="#validation-and-troubleshooting"></a></h3>


<p>Successful balancing problems (problems with a valid solution) have <code>sol_status_val &gt; 0</code> or, equivalently,
<code>n_unmet_con = 0</code> or <code>max_discr &lt;= validation_tol</code> in the output <strong>proc_grp_df</strong> data frame. Troubleshooting
unsuccessful balancing problems is not necessarily straightforward. Following are some suggestions:</p><ul><li><p>Investigate the failed constraints (<code>unmet_flag = TRUE</code> or, equivalently, <code>discr_out &gt; validation_tol</code> in the
output <strong>prob_con_df</strong> data frame) to make sure that they do not cause an empty solution space (infeasible problem).</p></li>
<li><p>Change the OSQP solving sequence. E.g., try:</p><ol><li><p>argument <code>full_sequence = TRUE</code></p></li>
<li><p>argument <code>osqp_settings_df = alternate_osqp_sequence</code></p></li>
<li><p>arguments <code>osqp_settings_df = alternate_osqp_sequence</code> and <code>full_sequence = TRUE</code></p></li>
</ol><p>See <code><a href="../articles/osqp-settings-sequence-dataframe.html">vignette("osqp-settings-sequence-dataframe")</a></code> for more details on this topic.</p></li>
<li><p>Increase (review) the <code>validation_tol</code> value. Although this may sound like <em>cheating</em>, the default <code>validation_tol</code>
value (\(1 \times 10^{-3}\)) may actually be too small for balancing problems that involve very large values (e.g.,
in billions) or, conversely, too large with very small problem values (e.g, \(&lt; 1.0\)). Multiplying the average scale
of the problem data by the <em>machine tolerance</em> (<code>.Machine$double.eps</code>) gives an approximation of the average size of the
discrepancies that <code>tsbalancing()</code> should be able to handle (distinguish from \(0\)) and should probably constitute an
<strong>absolute lower bound</strong> for argument <code>validation_tol</code>. In practice, a reasonable <code>validation_tol</code> value would likely be
\(1 \times 10^3\) to \(1 \times 10^6\) times larger than this <em>lower bound</em>.</p></li>
<li><p>Address constraints redundancy. Multi-dimensional aggregation table raking problems are over-specified (involve
redundant constraints) when all totals of all dimensions of the <em>data cube</em> are binding (fixed) and a constraint is
defined for all of them. Redundancy also occurs for the implicit temporal aggregation constraints in single- or
multi-dimensional aggregation table raking problems with binding (fixed) temporal totals. Over-specification is generally
not an issue for <code>tsbalancing()</code> if the input data are not contradictory with regards to the redundant constraints, i.e.,
if there are no inconsistencies (discrepancies) associated to the redundant constraints in the input data or if they are
<em>negligible</em> (reasonably small relative to the scale of the problem data). Otherwise, this may lead to unsuccessful
balancing problems with <code>tsbalancing()</code>. Possible solutions would then include:</p><ol><li><p>Resolve (or reduce) the discrepancies associated to the redundant constraints in the input data.</p></li>
<li><p>Select one marginal total in every dimension, but one, of the data cube and remove the corresponding balancing
constraints from the problem. <em>This cannot be done for the implicit temporal aggregation constraints</em>.</p></li>
<li><p>Select one marginal total in every dimension, but one, of the data cube and make them nonbinding (alterability
coefficient of, say, \(1.0\)).</p></li>
<li><p>Do the same as (3) for the temporal totals of one of the inner-cube component series (make them nonbinding).</p></li>
<li><p>Make all marginal totals of every dimension, but one, of the data cube <em>amlost binding</em>, i.e., specify very small
alterability coefficients (say \(1 \times 10^{-6}\)) compared to those of the inner-cube component series.</p></li>
<li><p>Do the same as (5) for the temporal totals of all inner-cube component series (very small alterability
coefficients, e.g., with argument <code>alter_temporal</code>).</p></li>
<li><p>Use <code><a href="tsraking.html">tsraking()</a></code> (if applicable), which handles these inconsistencies by using the Moore-Penrose inverse
(uniform distribution among all binding totals).</p></li>
</ol><p>Solutions (2) to (7) above should only be considered if the discrepancies associated to the redundant constraints
in the input data are <em>reasonably small</em> as they would be distributed among the omitted or nonbinding totals with
<code>tsbalancing()</code> and all binding totals with <code><a href="tsraking.html">tsraking()</a></code>. Otherwise, one should first investigate solution (1) above.</p></li>
<li><p>Relax the bounds of the problem constraints, e.g.:</p><ul><li><p>argument <code>tolV</code> for the balancing constraints;</p></li>
<li><p>arguments <code>tolV_temporal</code> and <code>tolP_temporal</code> for the implicit temporal aggregation constraints;</p></li>
<li><p>arguments <code>lower_bound</code> and <code>upper_bound</code>.</p></li>
</ul></li>
</ul></div>

    </div>
    <div class="section level2">
    <h2 id="processing-groups">Processing groups<a class="anchor" aria-label="anchor" href="#processing-groups"></a></h2>
    <p>The set of periods of a given reconciliation (raking or balancing) problem is called a <em>processing group</em>
and either corresponds to:</p><ul><li><p>a <strong>single period</strong> with period-by-period processing or, when preserving temporal totals, for the individual
periods of an incomplete temporal group (e.g., an incomplete year)</p></li>
<li><p>or the <strong>set of periods of a complete temporal group</strong> (e.g., a complete year) when preserving temporal
totals.</p></li>
</ul><p>The total number of processing groups (total number of reconciliation problems) depends on the set of
periods in the input time series object (argument <code>in_ts</code>) and on the value of arguments
<code>temporal_grp_periodicity</code> and <code>temporal_grp_start</code>.</p>
<p>Common scenarios include <code>temporal_grp_periodicity = 1</code> (default) for period-by period processing without
temporal total preservation and <code>temporal_grp_periodicity = frequency(in_ts)</code> for the preservation of annual
totals (calendar years by default). Argument <code>temporal_grp_start</code> allows the specification of other types of
(<em>non-calendar</em>) years. E.g., fiscal years starting on April correspond to <code>temporal_grp_start = 4</code> with monthly
data and <code>temporal_grp_start = 2</code> with quarterly data. Preserving quarterly totals with monthly data would
correspond to <code>temporal_grp_periodicity = 3</code>.</p>
<p>By default, temporal groups covering more than a year (i.e., corresponding to <code>temporal_grp_periodicity &gt; frequency(in_ts)</code> start on a
year that is a multiple of <code>
ceiling(temporal_grp_periodicity / frequency(in_ts))</code>. E.g., biennial groups corresponding to <code>temporal_grp_periodicity = 2 * frequency(in_ts)</code>
start on an <em>even year</em> by default. This behaviour can be changed with argument <code>temporal_grp_start</code>. E.g., the
preservation of biennial totals starting on an <em>odd year</em> instead of an <em>even year</em> (default) corresponds to
<code>temporal_grp_start = frequency(in_ts) + 1</code> (along with <code>temporal_grp_periodicity = 2 * frequency(in_ts)</code>).</p>
<p>See the <code><a href="gs.build_proc_grps.html">gs.build_proc_grps()</a></code> <strong>Examples</strong> for common processing group scenarios.</p>
    </div>
    <div class="section level2">
    <h2 id="comparing-tsraking-and-tsbalancing-">Comparing <code><a href="tsraking.html">tsraking()</a></code> and <code>tsbalancing()</code><a class="anchor" aria-label="anchor" href="#comparing-tsraking-and-tsbalancing-"></a></h2>

<ul><li><p><code><a href="tsraking.html">tsraking()</a></code> is limited to one- and two-dimensional aggregation table raking problems (with temporal total
preservation if required) while <code>tsbalancing()</code> handles more general balancing problems (e.g., higher dimensional
raking problems, nonnegative solutions, general linear equality and inequality constraints as opposed to aggregation
rules only, etc.).</p></li>
<li><p><code><a href="tsraking.html">tsraking()</a></code> returns the generalized least squared solution of the Dagum and Cholette regression-based raking
model (Dagum and Cholette 2006) while <code>tsbalancing()</code> solves the corresponding quadratic minimization problem using
a numerical solver. In most cases, <em>convergence to the minimum</em> is achieved and the <code>tsbalancing()</code> solution matches
the (exact) <code><a href="tsraking.html">tsraking()</a></code> least square solution. It may not be the case, however, if convergence could not be achieved
after a reasonable number of iterations. Having said that, only in very rare occasions will the <code>tsbalancing()</code>
solution <em>significantly</em> differ from the <code><a href="tsraking.html">tsraking()</a></code> solution.</p></li>
<li><p><code>tsbalancing()</code> is usually faster than <code><a href="tsraking.html">tsraking()</a></code>, especially for large raking problems, but is generally more
sensitive to the presence of (small) inconsistencies in the input data associated to the redundant constraints of
fully specified (over-specified) raking problems. <code><a href="tsraking.html">tsraking()</a></code> handles these inconsistencies by using the
Moore-Penrose inverse (uniform distribution among all binding totals).</p></li>
<li><p><code>tsbalancing()</code> accommodates the specification of sparse problems in their reduced form. This is not true in the
case of <code><a href="tsraking.html">tsraking()</a></code> where aggregation rules must always be fully specified since a <em>complete data cube</em> without
missing data is expected as input (every single <em>inner-cube</em> component series must contribute to all dimensions of
the cube, i.e., to every single <em>outer-cube</em> marginal total series).</p></li>
<li><p>Both tools handle negative values in the input data differently by default. While the solutions of raking problems
obtained from <code>tsbalancing()</code> and <code><a href="tsraking.html">tsraking()</a></code> are identical when all input data points are positive, they will
differ if some data points are negative (unless argument <code>Vmat_option = 2</code> is specified with <code><a href="tsraking.html">tsraking()</a></code>).</p></li>
<li><p>While both <code>tsbalancing()</code> and <code><a href="tsraking.html">tsraking()</a></code> allow the preservation of temporal totals, time management is not
incorporated in <code><a href="tsraking.html">tsraking()</a></code>. For example, the construction of the processing groups (sets of periods of each raking
problem) is left to the user with <code><a href="tsraking.html">tsraking()</a></code> and separate calls must be submitted for each processing group (each
raking problem). That's where helper function <code><a href="tsraking_driver.html">tsraking_driver()</a></code> comes in handy with <code><a href="tsraking.html">tsraking()</a></code>.</p></li>
<li><p><code>tsbalancing()</code> returns the same set of series as the input time series object while <code><a href="tsraking.html">tsraking()</a></code> returns the set
of series involved in the raking problem plus those specified with argument <code>id</code> (which could correspond to a subset
of the input series).</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Dagum, E. B. and P. Cholette (2006). <strong>Benchmarking, Temporal Distribution and Reconciliation Methods
of Time Series</strong>. Springer-Verlag, New York, Lecture Notes in Statistics, Vol. 186.</p>
<p>Ferland, M., S. Fortier and J. Bérubé (2016). "A Mathematical Optimization Approach to Balancing Time Series:
Statistics Canada’s GSeriesTSBalancing". In <strong>JSM Proceedings, Business and Economic Statistics Section</strong>. Alexandria,
VA: American Statistical Association. 2292-2306.</p>
<p>Ferland, M. (2018). "Time Series Balancing Quadratic Problem — Hessian matrix and vector of linear objective
function coefficients". <strong>Internal document</strong>. Statistics Canada, Ottawa, Canada.</p>
<p>Quenneville, B. and S. Fortier (2012). "Restoring Accounting Constraints in Time Series – Methods and
Software for a Statistical Agency". <strong>Economic Time Series: Modeling and Seasonality</strong>. Chapman &amp; Hall, New York.</p>
<p>SAS Institute Inc. (2015). "The LP Procedure Sparse Data Input Format". <strong>SAS/OR\(^\circledR\) 14.1
User's Guide: Mathematical Programming Legacy Procedures</strong>.
<a href="https://support.sas.com/documentation/cdl/en/ormplpug/68158/HTML/default/viewer.htm#ormplpug_lp_details03.htm" class="external-link">https://support.sas.com/documentation/cdl/en/ormplpug/68158/HTML/default/viewer.htm#ormplpug_lp_details03.htm</a></p>
<p>Statistics Canada (2016). "The <em><strong>GSeriesTSBalancing</strong></em> Macro". <strong>G-Series 2.0 User Guide</strong>.
Statistics Canada, Ottawa, Canada.</p>
<p>Statistics Canada (2018). <strong>Theory and Application of Reconciliation (Course code 0437)</strong>.
Statistics Canada, Ottawa, Canada.</p>
<p>Stellato, B., G. Banjac, P. Goulart et al. (2020). "OSQP: an operator splitting solver for quadratic programs".
<strong>Math. Prog. Comp. 12</strong>, 637–672 (2020). <a href="https://doi.org/10.1007/s12532-020-00179-2" class="external-link">https://doi.org/10.1007/s12532-020-00179-2</a></p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="tsraking.html">tsraking()</a></code> <code><a href="tsraking_driver.html">tsraking_driver()</a></code> <code><a href="rkMeta_to_blSpecs.html">rkMeta_to_blSpecs()</a></code> <code><a href="gs.build_proc_grps.html">gs.build_proc_grps()</a></code> <code><a href="build_balancing_problem.html">build_balancing_problem()</a></code> <a href="aliases.html">aliases</a></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">###########</span></span></span>
<span class="r-in"><span><span class="co"># Example 1: In this first example, the objective is to balance a following simple </span></span></span>
<span class="r-in"><span><span class="co">#            accounting table (`Profits = Revenues – Expenses`) for 5 quarters </span></span></span>
<span class="r-in"><span><span class="co">#            without modifying `Profits` where `Revenues &gt;= 0` and `Expenses &gt;= 0`.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Problem specifications</span></span></span>
<span class="r-in"><span><span class="va">my_specs1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"EQ"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">3</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>                                 <span class="st">"alter"</span>, <span class="cn">NA</span>, </span></span>
<span class="r-in"><span>                                 <span class="st">"lowerBd"</span>, <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                        col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="st">"Revenues"</span>, <span class="st">"Expenses"</span>, <span class="st">"Profits"</span>, </span></span>
<span class="r-in"><span>                                <span class="cn">NA</span>, <span class="st">"Profits"</span>, </span></span>
<span class="r-in"><span>                                <span class="cn">NA</span>, <span class="st">"Revenues"</span>, <span class="st">"Expenses"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                        row <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Accounting Rule"</span>, <span class="fl">4</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>                                <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Alterability Coefficient"</span>, <span class="fl">2</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>                                <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Lower Bound"</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                        coef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span>                                 <span class="cn">NA</span>, <span class="fl">0</span>,</span></span>
<span class="r-in"><span>                                 <span class="cn">NA</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">my_specs1</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      type      col                      row coef</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1      EQ     &lt;NA&gt;          Accounting Rule   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2    &lt;NA&gt; Revenues          Accounting Rule    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3    &lt;NA&gt; Expenses          Accounting Rule   -1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4    &lt;NA&gt;  Profits          Accounting Rule   -1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   alter     &lt;NA&gt; Alterability Coefficient   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6    &lt;NA&gt;  Profits Alterability Coefficient    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7 lowerBd     &lt;NA&gt;              Lower Bound   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8    &lt;NA&gt; Revenues              Lower Bound    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9    &lt;NA&gt; Expenses              Lower Bound    0</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Problem data</span></span></span>
<span class="r-in"><span><span class="va">my_series1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ts.html" class="external-link">ts</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fl">15</span>,  <span class="fl">10</span>,  <span class="fl">10</span>,</span></span>
<span class="r-in"><span>                            <span class="fl">4</span>,   <span class="fl">8</span>,  <span class="op">-</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span>                          <span class="fl">250</span>, <span class="fl">250</span>,   <span class="fl">5</span>,</span></span>
<span class="r-in"><span>                            <span class="fl">8</span>,  <span class="fl">12</span>,   <span class="fl">0</span>,</span></span>
<span class="r-in"><span>                            <span class="fl">0</span>,  <span class="fl">45</span>, <span class="op">-</span><span class="fl">55</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                        ncol <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>                        byrow <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                        dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Revenues"</span>, <span class="st">"Expenses"</span>, <span class="st">"Profits"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2022</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 frequency <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Reconcile the data</span></span></span>
<span class="r-in"><span><span class="va">out_balanced1</span> <span class="op">&lt;-</span> <span class="fu">tsbalancing</span><span class="op">(</span>in_ts <span class="op">=</span> <span class="va">my_series1</span>,</span></span>
<span class="r-in"><span>                             problem_specs_df <span class="op">=</span> <span class="va">my_specs1</span>,</span></span>
<span class="r-in"><span>                             display_level <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> --- Package gstest 3.0.0 - (EN) 'G-Series' in 'R' | (FR) 'G-Séries' en 'R' ---</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Created on April 8, 2025, at 3:40:01 PM EDT</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> URL: https://ferlmic.github.io/gstest/en/</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>      https://ferlmic.github.io/gstest/fr/</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Email: g-series@statcan.gc.ca</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> tsbalancing() function:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     in_ts                    = my_series1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     problem_specs_df         = my_specs1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     temporal_grp_periodicity = 1 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     temporal_grp_start       (ignored)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     osqp_settings_df         = default_osqp_sequence (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     display_level            = 3</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alter_pos                = 1 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alter_neg                = 1 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alter_mix                = 1 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alter_temporal           (ignored)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     lower_bound              = -Inf (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     upper_bound              = Inf (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     tolV                     = 0 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     tolV_temporal            (ignored)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)validation_tol        = 0.001 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)trunc_to_zero_tol     = validation_tol (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)validation_only       = FALSE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)quiet                 = FALSE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*) indicates new arguments in G-Series 3.0</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Balancing Problem Elements</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ==========================</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Balancing Constraints (1)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   -------------------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Accounting Rule:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     Revenues - Expenses - Profits == 0</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Time Series Info</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   ----------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>         name lowerBd                 upperBd           alter                </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   1 Revenues       0 (problem specs)     Inf (default)     1 (default)      </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   2 Expenses       0 (problem specs)     Inf (default)     1 (default)      </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   3  Profits    -Inf (default)           Inf (default)     0 (problem specs)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Balancing period [2022-1]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> =========================</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Initial solution:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     - Maximum discrepancy = 5</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     - Total discrepancy   = 5</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Try to find a better solution with OSQP.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   -----------------------------------------------------------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>              OSQP v0.6.3  -  Operator Splitting QP Solver</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>                 (c) Bartolomeo Stellato,  Goran Banjac</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>           University of Oxford  -  Stanford University 2021</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   -----------------------------------------------------------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   problem:  variables n = 2, constraints m = 3</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             nnz(P) + nnz(A) = 6</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   settings: linear system solver = qdldl,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             eps_abs = 1.0e-06, eps_rel = 1.0e-06,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             eps_prim_inf = 1.0e-07, eps_dual_inf = 1.0e-07,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             rho = 1.00e-01 (adaptive),</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             sigma = 1.00e-09, alpha = 1.60, max_iter = 4000</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             check_termination: on (interval 25),</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             scaling: off, scaled_termination: off</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             warm start: on, polish: on, time_limit: off</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   iter  objective    pri res    dua res    rho        time</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>      1  -1.3898e+00   7.94e-01   8.11e+01   1.00e-01   6.86e-05s</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     50  -1.9200e+00   9.38e-11   5.19e-10   1.00e-01   1.31e-04s</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   plsh  -1.9200e+00   1.11e-16   2.22e-16  ---------   2.07e-04s</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   status:               solved</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   solution polish:      successful</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   number of iterations: 50</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   optimal objective:    -1.9200</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   run time:             2.07e-04s</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   optimal rho estimate: 5.49e-02</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   OSQP iteration 1:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     - Maximum discrepancy = 0</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     - Total discrepancy   = 0</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Valid solution (maximum discrepancy &lt;= 0.001 = `validation_tol`).</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Required polished solution achieved.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   --------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Problem Values</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   --------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>        name t time_val lower_bd upper_bd alter value_in value_out dif rdif</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    Revenues 1     2022        0      Inf     1       15        18   3  0.2</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    Expenses 1     2022        0      Inf     1       10         8  -2 -0.2</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     Profits 1     2022     -Inf      Inf     0       10        10   0  0.0</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   ----------------------------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Problem Constraints (l &lt;= Ax &lt;= u)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   ----------------------------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Balancing Constraints</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   ---------------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>               name t time_val  l  u Ax_in Ax_out discr_in discr_out validation_tol unmet_flag</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    Accounting Rule 1     2022 10 10     5     10        5         0          0.001      FALSE</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Period Value Bounds</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   -------------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>        name t time_val l   u Ax_in Ax_out discr_in discr_out validation_tol unmet_flag</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    Revenues 1     2022 0 Inf    15     18        0         0          0.001      FALSE</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    Expenses 1     2022 0 Inf    10      8        0         0          0.001      FALSE</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Balancing period [2022-2]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> =========================</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Initial solution:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     - Maximum discrepancy = 3</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     - Total discrepancy   = 3</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Try to find a better solution with OSQP.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   -----------------------------------------------------------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>              OSQP v0.6.3  -  Operator Splitting QP Solver</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>                 (c) Bartolomeo Stellato,  Goran Banjac</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>           University of Oxford  -  Stanford University 2021</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   -----------------------------------------------------------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   problem:  variables n = 2, constraints m = 3</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             nnz(P) + nnz(A) = 6</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   settings: linear system solver = qdldl,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             eps_abs = 1.0e-06, eps_rel = 1.0e-06,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             eps_prim_inf = 1.0e-07, eps_dual_inf = 1.0e-07,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             rho = 1.00e-01 (adaptive),</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             sigma = 1.00e-09, alpha = 1.60, max_iter = 4000</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             check_termination: on (interval 25),</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             scaling: off, scaled_termination: off</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             warm start: on, polish: on, time_limit: off</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   iter  objective    pri res    dua res    rho        time</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>      1  -1.2816e+00   1.57e-01   1.77e+01   1.00e-01   5.64e-05s</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     50  -1.8750e+00   1.33e-11   1.11e-10   1.00e-01   1.31e-04s</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   plsh  -1.8750e+00   2.78e-17   0.00e+00  ---------   2.08e-04s</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   status:               solved</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   solution polish:      successful</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   number of iterations: 50</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   optimal objective:    -1.8750</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   run time:             2.08e-04s</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   optimal rho estimate: 5.47e-02</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   OSQP iteration 1:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     - Maximum discrepancy = 0</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     - Total discrepancy   = 0</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Valid solution (maximum discrepancy &lt;= 0.001 = `validation_tol`).</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Required polished solution achieved.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   --------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Problem Values</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   --------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>        name t time_val lower_bd upper_bd alter value_in value_out dif  rdif</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    Revenues 2  2022.25        0      Inf     1        4         5   1  0.25</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    Expenses 2  2022.25        0      Inf     1        8         6  -2 -0.25</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     Profits 2  2022.25     -Inf      Inf     0       -1        -1   0  0.00</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   ----------------------------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Problem Constraints (l &lt;= Ax &lt;= u)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   ----------------------------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Balancing Constraints</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   ---------------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>               name t time_val  l  u Ax_in Ax_out discr_in discr_out validation_tol unmet_flag</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    Accounting Rule 2  2022.25 -1 -1    -4     -1        3         0          0.001      FALSE</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Period Value Bounds</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   -------------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>        name t time_val l   u Ax_in Ax_out discr_in discr_out validation_tol unmet_flag</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    Revenues 2  2022.25 0 Inf     4      5        0         0          0.001      FALSE</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    Expenses 2  2022.25 0 Inf     8      6        0         0          0.001      FALSE</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Balancing period [2022-3]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> =========================</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Initial solution:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     - Maximum discrepancy = 5</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     - Total discrepancy   = 5</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Try to find a better solution with OSQP.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   -----------------------------------------------------------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>              OSQP v0.6.3  -  Operator Splitting QP Solver</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>                 (c) Bartolomeo Stellato,  Goran Banjac</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>           University of Oxford  -  Stanford University 2021</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   -----------------------------------------------------------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   problem:  variables n = 2, constraints m = 3</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             nnz(P) + nnz(A) = 6</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   settings: linear system solver = qdldl,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             eps_abs = 1.0e-06, eps_rel = 1.0e-06,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             eps_prim_inf = 1.0e-07, eps_dual_inf = 1.0e-07,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             rho = 1.00e-01 (adaptive),</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             sigma = 1.00e-09, alpha = 1.60, max_iter = 4000</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             check_termination: on (interval 25),</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             scaling: off, scaled_termination: off</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             warm start: on, polish: on, time_limit: off</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   iter  objective    pri res    dua res    rho        time</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>      1  -1.4512e+00   2.00e-02   3.05e+00   1.00e-01   6.81e-05s</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     50  -1.9998e+00   1.70e-12   1.29e-11   1.00e-01   1.31e-04s</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   plsh  -1.9998e+00   1.73e-17   1.73e-17  ---------   1.97e-04s</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   status:               solved</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   solution polish:      successful</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   number of iterations: 50</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   optimal objective:    -1.9998</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   run time:             1.97e-04s</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   optimal rho estimate: 5.13e-02</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   OSQP iteration 1:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     - Maximum discrepancy = 0</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     - Total discrepancy   = 0</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Valid solution (maximum discrepancy &lt;= 0.001 = `validation_tol`).</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Required polished solution achieved.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   --------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Problem Values</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   --------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>        name t time_val lower_bd upper_bd alter value_in value_out  dif  rdif</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    Revenues 3   2022.5        0      Inf     1      250     252.5  2.5  0.01</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    Expenses 3   2022.5        0      Inf     1      250     247.5 -2.5 -0.01</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     Profits 3   2022.5     -Inf      Inf     0        5       5.0  0.0  0.00</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   ----------------------------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Problem Constraints (l &lt;= Ax &lt;= u)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   ----------------------------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Balancing Constraints</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   ---------------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>               name t time_val l u Ax_in Ax_out discr_in discr_out validation_tol unmet_flag</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    Accounting Rule 3   2022.5 5 5     0      5        5         0          0.001      FALSE</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Period Value Bounds</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   -------------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>        name t time_val l   u Ax_in Ax_out discr_in discr_out validation_tol unmet_flag</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    Revenues 3   2022.5 0 Inf   250  252.5        0         0          0.001      FALSE</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    Expenses 3   2022.5 0 Inf   250  247.5        0         0          0.001      FALSE</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Balancing period [2022-4]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> =========================</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Initial solution:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     - Maximum discrepancy = 4</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     - Total discrepancy   = 4</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Try to find a better solution with OSQP.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   -----------------------------------------------------------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>              OSQP v0.6.3  -  Operator Splitting QP Solver</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>                 (c) Bartolomeo Stellato,  Goran Banjac</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>           University of Oxford  -  Stanford University 2021</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   -----------------------------------------------------------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   problem:  variables n = 2, constraints m = 3</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             nnz(P) + nnz(A) = 6</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   settings: linear system solver = qdldl,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             eps_abs = 1.0e-06, eps_rel = 1.0e-06,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             eps_prim_inf = 1.0e-07, eps_dual_inf = 1.0e-07,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             rho = 1.00e-01 (adaptive),</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             sigma = 1.00e-09, alpha = 1.60, max_iter = 4000</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             check_termination: on (interval 25),</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             scaling: off, scaled_termination: off</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             warm start: on, polish: on, time_limit: off</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   iter  objective    pri res    dua res    rho        time</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>      1  -1.3898e+00   6.04e-03   1.05e+00   1.00e-01   5.36e-05s</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     25  -1.9200e+00   5.09e-08   5.35e-07   1.00e-01   1.12e-04s</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   plsh  -1.9200e+00   0.00e+00   1.11e-16  ---------   1.76e-04s</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   status:               solved</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   solution polish:      successful</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   number of iterations: 25</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   optimal objective:    -1.9200</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   run time:             1.76e-04s</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   optimal rho estimate: 4.88e-02</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   OSQP iteration 1:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     - Maximum discrepancy = 0</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     - Total discrepancy   = 0</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Valid solution (maximum discrepancy &lt;= 0.001 = `validation_tol`).</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Required polished solution achieved.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   --------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Problem Values</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   --------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>        name t time_val lower_bd upper_bd alter value_in value_out  dif rdif</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    Revenues 4  2022.75        0      Inf     1        8       9.6  1.6  0.2</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    Expenses 4  2022.75        0      Inf     1       12       9.6 -2.4 -0.2</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     Profits 4  2022.75     -Inf      Inf     0        0       0.0  0.0   NA</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   ----------------------------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Problem Constraints (l &lt;= Ax &lt;= u)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   ----------------------------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Balancing Constraints</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   ---------------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>               name t time_val l u Ax_in Ax_out discr_in discr_out validation_tol unmet_flag</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    Accounting Rule 4  2022.75 0 0    -4      0        4         0          0.001      FALSE</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Period Value Bounds</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   -------------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>        name t time_val l   u Ax_in Ax_out discr_in discr_out validation_tol unmet_flag</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    Revenues 4  2022.75 0 Inf     8    9.6        0         0          0.001      FALSE</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    Expenses 4  2022.75 0 Inf    12    9.6        0         0          0.001      FALSE</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Balancing period [2023-1]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> =========================</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Initial solution:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     - Maximum discrepancy = 10</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     - Total discrepancy   = 10</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Try to find a better solution with OSQP.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   -----------------------------------------------------------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>              OSQP v0.6.3  -  Operator Splitting QP Solver</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>                 (c) Bartolomeo Stellato,  Goran Banjac</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>           University of Oxford  -  Stanford University 2021</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   -----------------------------------------------------------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   problem:  variables n = 1, constraints m = 2</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             nnz(P) + nnz(A) = 3</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   settings: linear system solver = qdldl,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             eps_abs = 1.0e-06, eps_rel = 1.0e-06,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             eps_prim_inf = 1.0e-07, eps_dual_inf = 1.0e-07,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             rho = 1.00e-01 (adaptive),</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             sigma = 1.00e-09, alpha = 1.60, max_iter = 4000</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             check_termination: on (interval 25),</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             scaling: off, scaled_termination: off</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             warm start: on, polish: on, time_limit: off</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   iter  objective    pri res    dua res    rho        time</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>      1  -6.1701e-02   1.19e+00   1.21e+02   1.00e-01   6.38e-05s</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     50  -9.5062e-01   1.37e-10   1.41e-10   1.00e-01   1.28e-04s</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   plsh  -9.5062e-01   0.00e+00   0.00e+00  ---------   1.94e-04s</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   status:               solved</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   solution polish:      successful</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   number of iterations: 50</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   optimal objective:    -0.9506</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   run time:             1.94e-04s</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   optimal rho estimate: 1.39e-01</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   OSQP iteration 1:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     - Maximum discrepancy = 7.105427e-15</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     - Total discrepancy   = 7.105427e-15</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Valid solution (maximum discrepancy &lt;= 0.001 = `validation_tol`).</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Required polished solution achieved.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   --------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Problem Values</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   --------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>        name t time_val lower_bd upper_bd alter value_in value_out dif      rdif</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    Revenues 5     2023        0      Inf     1        0         0   0        NA</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    Expenses 5     2023        0      Inf     1       45        55  10 0.2222222</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     Profits 5     2023     -Inf      Inf     0      -55       -55   0 0.0000000</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   ----------------------------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Problem Constraints (l &lt;= Ax &lt;= u)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   ----------------------------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Balancing Constraints</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   ---------------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>               name t time_val   l   u Ax_in Ax_out discr_in    discr_out validation_tol unmet_flag</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    Accounting Rule 5     2023 -55 -55   -45    -55       10 7.105427e-15          0.001      FALSE</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Period Value Bounds</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   -------------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>        name t time_val l   u Ax_in Ax_out discr_in discr_out validation_tol unmet_flag</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>    Expenses 5     2023 0 Inf    45     55        0         0          0.001      FALSE</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Initial data</span></span></span>
<span class="r-in"><span><span class="va">my_series1</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Revenues Expenses Profits</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2022 Q1       15       10      10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2022 Q2        4        8      -1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2022 Q3      250      250       5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2022 Q4        8       12       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2023 Q1        0       45     -55</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Reconciled data</span></span></span>
<span class="r-in"><span><span class="va">out_balanced1</span><span class="op">$</span><span class="va">out_ts</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Revenues Expenses Profits</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2022 Q1     18.0      8.0      10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2022 Q2      5.0      6.0      -1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2022 Q3    252.5    247.5       5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2022 Q4      9.6      9.6       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2023 Q1      0.0     55.0     -55</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Check for invalid solutions</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">out_balanced1</span><span class="op">$</span><span class="va">proc_grp_df</span><span class="op">$</span><span class="va">sol_status_val</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Display the maximum output constraint discrepancies</span></span></span>
<span class="r-in"><span><span class="va">out_balanced1</span><span class="op">$</span><span class="va">proc_grp_df</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"proc_grp_label"</span>, <span class="st">"max_discr"</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   proc_grp_label    max_discr</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         2022-1 0.000000e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         2022-2 0.000000e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3         2022-3 0.000000e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4         2022-4 0.000000e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5         2023-1 7.105427e-15</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The solution returned by `tsbalancing()` corresponds to equal proportional changes </span></span></span>
<span class="r-in"><span><span class="co"># (pro-rating) and is related to the default alterability coefficients of 1. Equal </span></span></span>
<span class="r-in"><span><span class="co"># absolute changes could be obtained instead by specifying alterability coefficients </span></span></span>
<span class="r-in"><span><span class="co"># equal to the inverse of the initial values. </span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># Let’s do this for the processing group 2022Q2 (`timeVal = 2022.25`), with the default </span></span></span>
<span class="r-in"><span><span class="co"># displayed level of information (`display_level = 1`). </span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">my_specs1b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">my_specs1</span>, </span></span>
<span class="r-in"><span>                          <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>timeVal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA_real_</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">my_specs1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                               col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Revenues"</span>, <span class="st">"Expenses"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                               row <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Alterability Coefficient"</span>, <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                               coef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.125</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                               timeVal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2022.25</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">my_specs1b</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       type      col                      row   coef timeVal</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1       EQ     &lt;NA&gt;          Accounting Rule     NA      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     &lt;NA&gt; Revenues          Accounting Rule  1.000      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3     &lt;NA&gt; Expenses          Accounting Rule -1.000      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4     &lt;NA&gt;  Profits          Accounting Rule -1.000      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5    alter     &lt;NA&gt; Alterability Coefficient     NA      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6     &lt;NA&gt;  Profits Alterability Coefficient  0.000      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7  lowerBd     &lt;NA&gt;              Lower Bound     NA      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8     &lt;NA&gt; Revenues              Lower Bound  0.000      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9     &lt;NA&gt; Expenses              Lower Bound  0.000      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10    &lt;NA&gt; Revenues Alterability Coefficient  0.250 2022.25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11    &lt;NA&gt; Expenses Alterability Coefficient  0.125 2022.25</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">out_balanced1b</span> <span class="op">&lt;-</span> <span class="fu">tsbalancing</span><span class="op">(</span>in_ts <span class="op">=</span> <span class="va">my_series1</span>,</span></span>
<span class="r-in"><span>                              problem_specs_df <span class="op">=</span> <span class="va">my_specs1b</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> --- Package gstest 3.0.0 - (EN) 'G-Series' in 'R' | (FR) 'G-Séries' en 'R' ---</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Created on April 8, 2025, at 3:40:01 PM EDT</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> URL: https://ferlmic.github.io/gstest/en/</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>      https://ferlmic.github.io/gstest/fr/</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Email: g-series@statcan.gc.ca</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> tsbalancing() function:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     in_ts                    = my_series1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     problem_specs_df         = my_specs1b</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     temporal_grp_periodicity = 1 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     temporal_grp_start       (ignored)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     osqp_settings_df         = default_osqp_sequence (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     display_level            = 1 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alter_pos                = 1 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alter_neg                = 1 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alter_mix                = 1 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alter_temporal           (ignored)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     lower_bound              = -Inf (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     upper_bound              = Inf (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     tolV                     = 0 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     tolV_temporal            (ignored)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)validation_tol        = 0.001 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)trunc_to_zero_tol     = validation_tol (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)validation_only       = FALSE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)quiet                 = FALSE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*) indicates new arguments in G-Series 3.0</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Balancing Problem Elements</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ==========================</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Balancing Constraints (1)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   -------------------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Accounting Rule:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     Revenues - Expenses - Profits == 0</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   Time Series Info</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   ----------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>         name lowerBd                 upperBd           alter                  </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   1 Revenues       0 (problem specs)     Inf (default)     1 * (default)      </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   2 Expenses       0 (problem specs)     Inf (default)     1 * (default)      </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   3  Profits    -Inf (default)           Inf (default)     0   (problem specs)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   * indicates cases where period-specific values (`timeVal` is not `NA`) are specified in the problem specs data frame.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Balancing period [2022-1]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> =========================</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Balancing period [2022-2]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> =========================</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Balancing period [2022-3]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> =========================</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Balancing period [2022-4]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> =========================</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Balancing period [2023-1]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> =========================</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Display the initial 2022Q2 values and both solutions</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Status <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"initial"</span>, <span class="st">"pro-rating"</span>, <span class="st">"equal change"</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">my_series1</span><span class="op">[</span><span class="fl">2</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>            <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">out_balanced1</span><span class="op">$</span><span class="va">out_ts</span><span class="op">[</span><span class="fl">2</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>            <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">out_balanced1b</span><span class="op">$</span><span class="va">out_ts</span><span class="op">[</span><span class="fl">2</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Accounting_discr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">my_series1</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">my_series1</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">-</span> </span></span>
<span class="r-in"><span>                                        <span class="va">my_series1</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                                      <span class="va">out_balanced1</span><span class="op">$</span><span class="va">out_ts</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> </span></span>
<span class="r-in"><span>                                        <span class="va">out_balanced1</span><span class="op">$</span><span class="va">out_ts</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">-</span> </span></span>
<span class="r-in"><span>                                        <span class="va">out_balanced1</span><span class="op">$</span><span class="va">out_ts</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                                      <span class="va">out_balanced1b</span><span class="op">$</span><span class="va">out_ts</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> </span></span>
<span class="r-in"><span>                                        <span class="va">out_balanced1b</span><span class="op">$</span><span class="va">out_ts</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">-</span> </span></span>
<span class="r-in"><span>                                        <span class="va">out_balanced1b</span><span class="op">$</span><span class="va">out_ts</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 RelChg_Rev <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, </span></span>
<span class="r-in"><span>                                <span class="va">out_balanced1</span><span class="op">$</span><span class="va">out_ts</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="va">my_series1</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>                                <span class="va">out_balanced1b</span><span class="op">$</span><span class="va">out_ts</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="va">my_series1</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 RelChg_Exp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, </span></span>
<span class="r-in"><span>                                <span class="va">out_balanced1</span><span class="op">$</span><span class="va">out_ts</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">/</span> <span class="va">my_series1</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>                                <span class="va">out_balanced1b</span><span class="op">$</span><span class="va">out_ts</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">/</span> <span class="va">my_series1</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 AbsChg_Rev <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, </span></span>
<span class="r-in"><span>                                <span class="va">out_balanced1</span><span class="op">$</span><span class="va">out_ts</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">my_series1</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                                <span class="va">out_balanced1b</span><span class="op">$</span><span class="va">out_ts</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">my_series1</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 AbsChg_Exp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, </span></span>
<span class="r-in"><span>                                <span class="va">out_balanced1</span><span class="op">$</span><span class="va">out_ts</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">my_series1</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                                <span class="va">out_balanced1b</span><span class="op">$</span><span class="va">out_ts</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">my_series1</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Status Revenues Expenses Profits Accounting_discr RelChg_Rev RelChg_Exp</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1      initial      4.0      8.0      -1               -3         NA         NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   pro-rating      5.0      6.0      -1                0      0.250    -0.2500</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 equal change      5.5      6.5      -1                0      0.375    -0.1875</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   AbsChg_Rev AbsChg_Exp</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         NA         NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2        1.0       -2.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3        1.5       -1.5</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">###########</span></span></span>
<span class="r-in"><span><span class="co"># Example 2: In this second example, consider the simulated data on quarterly </span></span></span>
<span class="r-in"><span><span class="co">#            vehicle sales by region (West, Centre and East), along with a national </span></span></span>
<span class="r-in"><span><span class="co">#            total for the three regions, and by type of vehicles (cars, trucks and </span></span></span>
<span class="r-in"><span><span class="co">#            a total that may include other types of vehicles). The input data correspond </span></span></span>
<span class="r-in"><span><span class="co">#            to directly seasonally adjusted data that have been benchmarked to the </span></span></span>
<span class="r-in"><span><span class="co">#            annual totals of the corresponding unadjusted time series data as part </span></span></span>
<span class="r-in"><span><span class="co">#            of the seasonal adjustment process (e.g., with the FORCE spec in the </span></span></span>
<span class="r-in"><span><span class="co">#            X-13ARIMA-SEATS software). </span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">#            The objective is to reconcile the regional sales to the national sales </span></span></span>
<span class="r-in"><span><span class="co">#            without modifying the latter while ensuring that the sum of the sales of </span></span></span>
<span class="r-in"><span><span class="co">#            cars and trucks do not exceed 95% of the sales for all types of vehicles </span></span></span>
<span class="r-in"><span><span class="co">#            in any quarter. For illustrative purposes, we assume that the sales of </span></span></span>
<span class="r-in"><span><span class="co">#            trucks in the Centre region for the 2nd quarter of 2022 cannot be modified.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Problem specifications</span></span></span>
<span class="r-in"><span><span class="va">my_specs2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"EQ"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">4</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           <span class="st">"EQ"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">4</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           <span class="st">"EQ"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">4</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           <span class="st">"LE"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           <span class="st">"LE"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           <span class="st">"LE"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           <span class="st">"alter"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="st">"West_AllTypes"</span>, <span class="st">"Centre_AllTypes"</span>, <span class="st">"East_AllTypes"</span>, <span class="st">"National_AllTypes"</span>, </span></span>
<span class="r-in"><span>          <span class="cn">NA</span>, <span class="st">"West_Cars"</span>, <span class="st">"Centre_Cars"</span>, <span class="st">"East_Cars"</span>, <span class="st">"National_Cars"</span>, </span></span>
<span class="r-in"><span>          <span class="cn">NA</span>, <span class="st">"West_Trucks"</span>, <span class="st">"Centre_Trucks"</span>, <span class="st">"East_Trucks"</span>, <span class="st">"National_Trucks"</span>, </span></span>
<span class="r-in"><span>          <span class="cn">NA</span>, <span class="st">"West_Cars"</span>, <span class="st">"West_Trucks"</span>, <span class="st">"West_AllTypes"</span>, </span></span>
<span class="r-in"><span>          <span class="cn">NA</span>, <span class="st">"Centre_Cars"</span>, <span class="st">"Centre_Trucks"</span>, <span class="st">"Centre_AllTypes"</span>, </span></span>
<span class="r-in"><span>          <span class="cn">NA</span>, <span class="st">"East_Cars"</span>, <span class="st">"East_Trucks"</span>, <span class="st">"East_AllTypes"</span>,</span></span>
<span class="r-in"><span>          <span class="cn">NA</span>, <span class="st">"National_AllTypes"</span>, <span class="st">"National_Cars"</span>, <span class="st">"National_Trucks"</span>, <span class="st">"Centre_Trucks"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  row <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"National Total - All Types"</span>, <span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>          <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"National Total - Cars"</span>, <span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>          <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"National Total - Trucks"</span>, <span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>          <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"West Region Sum"</span>, <span class="fl">4</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>          <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Center Region Sum"</span>, <span class="fl">4</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>          <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"East Region Sum"</span>, <span class="fl">4</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>          <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Alterability Coefficient"</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  coef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span>           <span class="cn">NA</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span>           <span class="cn">NA</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span>           <span class="cn">NA</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="op">-</span><span class="fl">.95</span>,</span></span>
<span class="r-in"><span>           <span class="cn">NA</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="op">-</span><span class="fl">.95</span>,</span></span>
<span class="r-in"><span>           <span class="cn">NA</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="op">-</span><span class="fl">.95</span>,</span></span>
<span class="r-in"><span>           <span class="cn">NA</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  time_val <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">31</span><span class="op">)</span>, <span class="fl">2022.25</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Beginning and end of the specifications data frame</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">my_specs2</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    type               col                        row coef time_val</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1    EQ              &lt;NA&gt; National Total - All Types   NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  &lt;NA&gt;     West_AllTypes National Total - All Types    1       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  &lt;NA&gt;   Centre_AllTypes National Total - All Types    1       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  &lt;NA&gt;     East_AllTypes National Total - All Types    1       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  &lt;NA&gt; National_AllTypes National Total - All Types   -1       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6    EQ              &lt;NA&gt;      National Total - Cars   NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7  &lt;NA&gt;         West_Cars      National Total - Cars    1       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8  &lt;NA&gt;       Centre_Cars      National Total - Cars    1       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9  &lt;NA&gt;         East_Cars      National Total - Cars    1       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10 &lt;NA&gt;     National_Cars      National Total - Cars   -1       NA</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">my_specs2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     type               col                      row  coef time_val</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 27  &lt;NA&gt;     East_AllTypes          East Region Sum -0.95       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28 alter              &lt;NA&gt; Alterability Coefficient    NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 29  &lt;NA&gt; National_AllTypes Alterability Coefficient  0.00       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 30  &lt;NA&gt;     National_Cars Alterability Coefficient  0.00       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 31  &lt;NA&gt;   National_Trucks Alterability Coefficient  0.00       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 32  &lt;NA&gt;     Centre_Trucks Alterability Coefficient  0.00  2022.25</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Problem data</span></span></span>
<span class="r-in"><span><span class="va">my_series2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ts.html" class="external-link">ts</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">43</span>, <span class="fl">49</span>, <span class="fl">47</span>, <span class="fl">136</span>, <span class="fl">20</span>, <span class="fl">18</span>, <span class="fl">12</span>, <span class="fl">53</span>, <span class="fl">20</span>, <span class="fl">22</span>, <span class="fl">26</span>, <span class="fl">61</span>,</span></span>
<span class="r-in"><span>           <span class="fl">40</span>, <span class="fl">45</span>, <span class="fl">42</span>, <span class="fl">114</span>, <span class="fl">16</span>, <span class="fl">16</span>, <span class="fl">19</span>, <span class="fl">44</span>, <span class="fl">21</span>, <span class="fl">26</span>, <span class="fl">21</span>, <span class="fl">59</span>,</span></span>
<span class="r-in"><span>           <span class="fl">35</span>, <span class="fl">47</span>, <span class="fl">40</span>, <span class="fl">133</span>, <span class="fl">14</span>, <span class="fl">15</span>, <span class="fl">16</span>, <span class="fl">50</span>, <span class="fl">19</span>, <span class="fl">25</span>, <span class="fl">19</span>, <span class="fl">71</span>,</span></span>
<span class="r-in"><span>           <span class="fl">44</span>, <span class="fl">44</span>, <span class="fl">45</span>, <span class="fl">138</span>, <span class="fl">19</span>, <span class="fl">20</span>, <span class="fl">14</span>, <span class="fl">52</span>, <span class="fl">21</span>, <span class="fl">18</span>, <span class="fl">27</span>, <span class="fl">74</span>,</span></span>
<span class="r-in"><span>           <span class="fl">46</span>, <span class="fl">48</span>, <span class="fl">55</span>, <span class="fl">135</span>, <span class="fl">16</span>, <span class="fl">15</span>, <span class="fl">19</span>, <span class="fl">51</span>, <span class="fl">27</span>, <span class="fl">25</span>, <span class="fl">28</span>, <span class="fl">54</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>         ncol <span class="op">=</span> <span class="fl">12</span>,</span></span>
<span class="r-in"><span>         byrow <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>         dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="cn">NULL</span>, </span></span>
<span class="r-in"><span>                         <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"West_AllTypes"</span>, <span class="st">"Centre_AllTypes"</span>, <span class="st">"East_AllTypes"</span>, </span></span>
<span class="r-in"><span>                           <span class="st">"National_AllTypes"</span>, <span class="st">"West_Cars"</span>, <span class="st">"Centre_Cars"</span>, </span></span>
<span class="r-in"><span>                           <span class="st">"East_Cars"</span>, <span class="st">"National_Cars"</span>, <span class="st">"West_Trucks"</span>, </span></span>
<span class="r-in"><span>                           <span class="st">"Centre_Trucks"</span>, <span class="st">"East_Trucks"</span>, <span class="st">"National_Trucks"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2022</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  frequency <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Reconcile without displaying the function header and enforce nonnegative data</span></span></span>
<span class="r-in"><span><span class="va">out_balanced2</span> <span class="op">&lt;-</span> <span class="fu">tsbalancing</span><span class="op">(</span></span></span>
<span class="r-in"><span>  in_ts                    <span class="op">=</span> <span class="va">my_series2</span>,</span></span>
<span class="r-in"><span>  problem_specs_df         <span class="op">=</span> <span class="va">my_specs2</span>,</span></span>
<span class="r-in"><span>  temporal_grp_periodicity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/time.html" class="external-link">frequency</a></span><span class="op">(</span><span class="va">my_series2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  lower_bound              <span class="op">=</span> <span class="fl">0</span>,</span></span>
<span class="r-in"><span>  quiet                    <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Balancing periods [2022-1 - 2022-4]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ===================================</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Balancing period [2023-1]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> =========================</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Initial data</span></span></span>
<span class="r-in"><span><span class="va">my_series2</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         West_AllTypes Centre_AllTypes East_AllTypes National_AllTypes West_Cars</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2022 Q1            43              49            47               136        20</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2022 Q2            40              45            42               114        16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2022 Q3            35              47            40               133        14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2022 Q4            44              44            45               138        19</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2023 Q1            46              48            55               135        16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Centre_Cars East_Cars National_Cars West_Trucks Centre_Trucks</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2022 Q1          18        12            53          20            22</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2022 Q2          16        19            44          21            26</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2022 Q3          15        16            50          19            25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2022 Q4          20        14            52          21            18</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2023 Q1          15        19            51          27            25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         East_Trucks National_Trucks</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2022 Q1          26              61</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2022 Q2          21              59</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2022 Q3          19              71</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2022 Q4          27              74</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2023 Q1          28              54</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Reconciled data</span></span></span>
<span class="r-in"><span><span class="va">out_balanced2</span><span class="op">$</span><span class="va">out_ts</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         West_AllTypes Centre_AllTypes East_AllTypes National_AllTypes West_Cars</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2022 Q1      42.10895        47.63734      46.25371               136  21.15646</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2022 Q2      35.31121        41.40859      37.28019               114  14.00517</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2022 Q3      38.89464        50.58071      43.52465               133  15.24054</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2022 Q4      45.68520        45.37335      46.94145               138  18.59783</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2023 Q1      41.67785        43.48993      49.83221               135  16.32000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Centre_Cars East_Cars National_Cars West_Trucks Centre_Trucks</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2022 Q1    19.13355  12.70999            53    18.56134      18.59359</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2022 Q2    13.33816  16.65666            44    16.61497      26.00000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2022 Q3    16.84858  17.91088            50    21.70936      27.22926</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2022 Q4    19.67970  13.72247            52    24.11433      19.17715</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2023 Q1    15.30000  19.38000            51    18.22500      16.87500</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         East_Trucks National_Trucks</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2022 Q1    23.84507              61</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2022 Q2    16.38503              59</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2022 Q3    22.06138              71</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2022 Q4    30.70852              74</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2023 Q1    18.90000              54</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Check for invalid solutions</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">out_balanced2</span><span class="op">$</span><span class="va">proc_grp_df</span><span class="op">$</span><span class="va">sol_status_val</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Display the maximum output constraint discrepancies</span></span></span>
<span class="r-in"><span><span class="va">out_balanced2</span><span class="op">$</span><span class="va">proc_grp_df</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"proc_grp_label"</span>, <span class="st">"max_discr"</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    proc_grp_label    max_discr</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 2022-1 - 2022-4 2.842171e-14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2          2023-1 0.000000e+00</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">###########</span></span></span>
<span class="r-in"><span><span class="co"># Example 3: Reproduce the `tsraking_driver()` 2nd example with `tsbalancing()` </span></span></span>
<span class="r-in"><span><span class="co">#            (1-dimensional raking problem with annual total preservation).</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># `tsraking()` metadata</span></span></span>
<span class="r-in"><span><span class="va">my_metadata3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>series <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cars_alb"</span>, <span class="st">"cars_sask"</span>, <span class="st">"cars_man"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           total1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"cars_tot"</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">my_metadata3</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      series   total1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  cars_alb cars_tot</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 cars_sask cars_tot</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  cars_man cars_tot</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># `tsbalancing()` problem specifications</span></span></span>
<span class="r-in"><span><span class="va">my_specs3</span> <span class="op">&lt;-</span> <span class="fu"><a href="rkMeta_to_blSpecs.html">rkMeta_to_blSpecs</a></span><span class="op">(</span><span class="va">my_metadata3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">my_specs3</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     type       col                         row coef timeVal</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     EQ      &lt;NA&gt; Marginal Total 1 (cars_tot)   NA      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   &lt;NA&gt;  cars_alb Marginal Total 1 (cars_tot)    1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3   &lt;NA&gt; cars_sask Marginal Total 1 (cars_tot)    1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4   &lt;NA&gt;  cars_man Marginal Total 1 (cars_tot)    1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   &lt;NA&gt;  cars_tot Marginal Total 1 (cars_tot)   -1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  alter      &lt;NA&gt;   Period Value Alterability   NA      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7   &lt;NA&gt;  cars_alb   Period Value Alterability    1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8   &lt;NA&gt; cars_sask   Period Value Alterability    1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9   &lt;NA&gt;  cars_man   Period Value Alterability    1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10  &lt;NA&gt;  cars_tot   Period Value Alterability    0      NA</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Problem data</span></span></span>
<span class="r-in"><span><span class="va">my_series3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ts.html" class="external-link">ts</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">14</span>, <span class="fl">18</span>, <span class="fl">14</span>, <span class="fl">58</span>,</span></span>
<span class="r-in"><span>                          <span class="fl">17</span>, <span class="fl">14</span>, <span class="fl">16</span>, <span class="fl">44</span>,</span></span>
<span class="r-in"><span>                          <span class="fl">14</span>, <span class="fl">19</span>, <span class="fl">18</span>, <span class="fl">58</span>,</span></span>
<span class="r-in"><span>                          <span class="fl">20</span>, <span class="fl">18</span>, <span class="fl">12</span>, <span class="fl">53</span>,</span></span>
<span class="r-in"><span>                          <span class="fl">16</span>, <span class="fl">16</span>, <span class="fl">19</span>, <span class="fl">44</span>,</span></span>
<span class="r-in"><span>                          <span class="fl">14</span>, <span class="fl">15</span>, <span class="fl">16</span>, <span class="fl">50</span>,</span></span>
<span class="r-in"><span>                          <span class="fl">19</span>, <span class="fl">20</span>, <span class="fl">14</span>, <span class="fl">52</span>,</span></span>
<span class="r-in"><span>                          <span class="fl">16</span>, <span class="fl">15</span>, <span class="fl">19</span>, <span class="fl">51</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                        ncol <span class="op">=</span> <span class="fl">4</span>,</span></span>
<span class="r-in"><span>                        byrow <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                        dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cars_alb"</span>, <span class="st">"cars_sask"</span>,</span></span>
<span class="r-in"><span>                                                <span class="st">"cars_man"</span>, <span class="st">"cars_tot"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2019</span>, <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 frequency <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Reconcile the data with `tsraking()` (through `tsraking_driver()`)</span></span></span>
<span class="r-in"><span><span class="va">out_raked3</span> <span class="op">&lt;-</span> <span class="fu"><a href="tsraking_driver.html">tsraking_driver</a></span><span class="op">(</span>in_ts <span class="op">=</span> <span class="va">my_series3</span>,</span></span>
<span class="r-in"><span>                              metadata_df <span class="op">=</span> <span class="va">my_metadata3</span>,</span></span>
<span class="r-in"><span>                              temporal_grp_periodicity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/time.html" class="external-link">frequency</a></span><span class="op">(</span><span class="va">my_series3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                              quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Raking period [2019-2]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ======================</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Raking period [2019-3]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ======================</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Raking period [2019-4]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ======================</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Raking periods [2020-1 - 2020-4]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ================================</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Raking period [2021-1]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ======================</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Reconcile the data with `tsbalancing()`</span></span></span>
<span class="r-in"><span><span class="va">out_balanced3</span> <span class="op">&lt;-</span> <span class="fu">tsbalancing</span><span class="op">(</span>in_ts <span class="op">=</span> <span class="va">my_series3</span>,</span></span>
<span class="r-in"><span>                             problem_specs_df <span class="op">=</span> <span class="va">my_specs3</span>,</span></span>
<span class="r-in"><span>                             temporal_grp_periodicity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/time.html" class="external-link">frequency</a></span><span class="op">(</span><span class="va">my_series3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                             quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Balancing period [2019-2]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> =========================</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Balancing period [2019-3]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> =========================</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Balancing period [2019-4]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> =========================</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Balancing periods [2020-1 - 2020-4]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ===================================</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Balancing period [2021-1]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> =========================</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Initial data</span></span></span>
<span class="r-in"><span><span class="va">my_series3</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         cars_alb cars_sask cars_man cars_tot</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2019 Q2       14        18       14       58</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2019 Q3       17        14       16       44</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2019 Q4       14        19       18       58</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q1       20        18       12       53</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q2       16        16       19       44</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q3       14        15       16       50</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q4       19        20       14       52</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2021 Q1       16        15       19       51</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Both sets of reconciled data</span></span></span>
<span class="r-in"><span><span class="va">out_raked3</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         cars_alb cars_sask cars_man cars_tot</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2019 Q2 17.65217  22.69565 17.65217       58</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2019 Q3 15.91489  13.10638 14.97872       44</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2019 Q4 15.92157  21.60784 20.47059       58</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q1 21.15283  19.04513 12.80204       53</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q2 13.74700  13.75373 16.49927       44</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q3 15.50782  16.62184 17.87034       50</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q4 18.59234  19.57931 13.82835       52</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2021 Q1 16.32000  15.30000 19.38000       51</span>
<span class="r-in"><span><span class="va">out_balanced3</span><span class="op">$</span><span class="va">out_ts</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         cars_alb cars_sask cars_man cars_tot</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2019 Q2 17.65217  22.69565 17.65217       58</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2019 Q3 15.91489  13.10638 14.97872       44</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2019 Q4 15.92157  21.60784 20.47059       58</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q1 21.15283  19.04513 12.80204       53</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q2 13.74700  13.75373 16.49927       44</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q3 15.50782  16.62184 17.87034       50</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q4 18.59234  19.57931 13.82835       52</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2021 Q1 16.32000  15.30000 19.38000       51</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Check for invalid `tsbalancing()` solutions</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">out_balanced3</span><span class="op">$</span><span class="va">proc_grp_df</span><span class="op">$</span><span class="va">sol_status_val</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Display the maximum output constraint discrepancies from the `tsbalancing()` solutions</span></span></span>
<span class="r-in"><span><span class="va">out_balanced3</span><span class="op">$</span><span class="va">proc_grp_df</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"proc_grp_label"</span>, <span class="st">"max_discr"</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    proc_grp_label    max_discr</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1          2019-2 0.000000e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2          2019-3 0.000000e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3          2019-4 0.000000e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 2020-1 - 2020-4 7.105427e-15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5          2021-1 0.000000e+00</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Confirm that both solutions (`tsraking() and `tsbalancing()`) are the same</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">out_raked3</span>, <span class="va">out_balanced3</span><span class="op">$</span><span class="va">out_ts</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michel Ferland, Statistics Canada.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

