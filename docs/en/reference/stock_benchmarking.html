<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Restore temporal constraints for stock series — stock_benchmarking • gstest</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Restore temporal constraints for stock series — stock_benchmarking"><meta name="description" content="
Function specifically aimed at benchmarking stock series where the benchmarks are anchor points covering a
single period of the indicator series. Benchmarks covering more than one period of the indicator series
cannot be used with this function. Function benchmarking() should be used instead to benchmark
non-stock series (flows).
Several stock series can be benchmarked in a single function call.
Note that functions stock_benchmarking() and benchmarking() mainly share the same arguments and
return the same type of object. Differences are listed below:
Argument verbose is not defined for stock_benchmarking().
Extra arguments defined for stock_benchmarking():
low_freq_periodicity
n_low_freq_proj
proj_knots_rho_bd

The list returned by stock_benchmarking() contains an extra (fourth) data frame:
splineKnots



See section Details for more information on the similarities and differences of functions
stock_benchmarking() and benchmarking().
A direct equivalent of stock_benchmarking() does not exist in SAS\(^\circledR\) G-Series 2.0."><meta property="og:description" content="
Function specifically aimed at benchmarking stock series where the benchmarks are anchor points covering a
single period of the indicator series. Benchmarks covering more than one period of the indicator series
cannot be used with this function. Function benchmarking() should be used instead to benchmark
non-stock series (flows).
Several stock series can be benchmarked in a single function call.
Note that functions stock_benchmarking() and benchmarking() mainly share the same arguments and
return the same type of object. Differences are listed below:
Argument verbose is not defined for stock_benchmarking().
Extra arguments defined for stock_benchmarking():
low_freq_periodicity
n_low_freq_proj
proj_knots_rho_bd

The list returned by stock_benchmarking() contains an extra (fourth) data frame:
splineKnots



See section Details for more information on the similarities and differences of functions
stock_benchmarking() and benchmarking().
A direct equivalent of stock_benchmarking() does not exist in SAS\(^\circledR\) G-Series 2.0."><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gstest</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">3.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/gstest.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/benchmarking-cookbook.html">Benchmarking CookBook</a></li>
    <li><a class="dropdown-item" href="../articles/benchmarking-demo-script.html">A Beginner's Benchmarking Demo Script</a></li>
    <li><a class="dropdown-item" href="../articles/osqp-settings-sequence-dataframe.html">OSQP Settings Sequence Data Frame</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news"><li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ferlmic/gstest/tree/main/">G-Series 3.0 (latest - R package gstest 3.0.0)</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ferlmic/gstest/releases/tag/v2.0/">G-Series 2.0 (SAS® version)</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ferlmic/gstest/releases/tag/v1.04/">G-Series 1.04 (SAS® version)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ferlmic/gstest/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>

    <ul class="navbar-nav"><li class="nav-item"><a class="nav-link" href="#" onclick="window.location = location.href.replace('/en/','/fr/');"><span class="fa fa-language fa-lg"></span> Français</a></li></ul></div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Restore temporal constraints for stock series</h1>
      <small class="dont-index">Source: <a href="https://github.com/ferlmic/gstest/tree/main/R/stock_benchmarking.R" class="external-link"><code>R/stock_benchmarking.R</code></a></small>
      <div class="d-none name"><code>stock_benchmarking.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p></p>
<p>Function specifically aimed at benchmarking stock series where the benchmarks are anchor points covering a
single period of the indicator series. Benchmarks covering more than one period of the indicator series
cannot be used with this function. Function <code><a href="benchmarking.html">benchmarking()</a></code> should be used instead to benchmark
non-stock series (flows).</p>
<p>Several stock series can be benchmarked in a single function call.</p>
<p>Note that functions <code>stock_benchmarking()</code> and <code><a href="benchmarking.html">benchmarking()</a></code> mainly share the same arguments and
return the same type of object. Differences are listed below:</p><ul><li><p>Argument <code>verbose</code> is not defined for <code>stock_benchmarking()</code>.</p></li>
<li><p>Extra arguments defined for <code>stock_benchmarking()</code>:</p><ul><li><p><code>low_freq_periodicity</code></p></li>
<li><p><code>n_low_freq_proj</code></p></li>
<li><p><code>proj_knots_rho_bd</code></p></li>
</ul></li>
<li><p>The list returned by <code>stock_benchmarking()</code> contains an extra (fourth) data frame:</p><ul><li><p><code>splineKnots</code></p></li>
</ul></li>
</ul><p>See section <strong>Details</strong> for more information on the similarities and differences of functions
<code>stock_benchmarking()</code> and <code><a href="benchmarking.html">benchmarking()</a></code>.</p>
<p><em>A direct equivalent of <code>stock_benchmarking()</code> does not exist in SAS\(^\circledR\) G-Series 2.0.</em></p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">stock_benchmarking</span><span class="op">(</span></span>
<span>  <span class="va">series_df</span>,</span>
<span>  <span class="va">benchmarks_df</span>,</span>
<span>  <span class="va">rho</span>,</span>
<span>  <span class="va">lambda</span>,</span>
<span>  <span class="va">biasOption</span>,</span>
<span>  bias <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  low_freq_periodicity <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  n_low_freq_proj <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  proj_knots_rho_bd <span class="op">=</span> <span class="fl">0.995</span>,</span>
<span>  tolV <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>  tolP <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  warnNegResult <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  tolN <span class="op">=</span> <span class="op">-</span><span class="fl">0.001</span>,</span>
<span>  var <span class="op">=</span> <span class="st">"value"</span>,</span>
<span>  with <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  by <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  constant <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  negInput_option <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  allCols <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-series-df">series_df<a class="anchor" aria-label="anchor" href="#arg-series-df"></a></dt>
<dd><p>(mandatory)</p>
<p>Data frame, or object to be coerced to one, that contains the indicator time series data to be benchmarked.
In addition to the series data variable(s), specified with argument <code>var</code>, the data frame must also contain
two numeric variables, <code>year</code> and <code>period</code>, identifying the periods of the indicator time series.</p></dd>


<dt id="arg-benchmarks-df">benchmarks_df<a class="anchor" aria-label="anchor" href="#arg-benchmarks-df"></a></dt>
<dd><p>(mandatory)</p>
<p>Data frame, or object to be coerced to one, that contains the benchmarks. In addition to the benchmarks
data variable(s), specified with argument <code>with</code>, the data frame must also contain four numeric variables,
<code>startYear</code>, <code>startPeriod</code>, <code>endYear</code> and <code>endPeriod</code>, identifying the indicator time series periods covered
by each benchmark.</p></dd>


<dt id="arg-rho">rho<a class="anchor" aria-label="anchor" href="#arg-rho"></a></dt>
<dd><p>(mandatory)</p>
<p>Real number in the \([0,1]\) interval that specifies the value of the autoregressive parameter
\(\rho\). See section <strong>Details</strong> for more information on the effect of parameter \(\rho\).</p></dd>


<dt id="arg-lambda">lambda<a class="anchor" aria-label="anchor" href="#arg-lambda"></a></dt>
<dd><p>(mandatory)</p>
<p>Real number, with suggested values in the \([-3,3]\) interval, that specifies the value of the
adjustment model parameter \(\lambda\). Typical values are <code>lambda = 0.0</code> for an additive model
and <code>lambda = 1.0</code> for a proportional model.</p></dd>


<dt id="arg-biasoption">biasOption<a class="anchor" aria-label="anchor" href="#arg-biasoption"></a></dt>
<dd><p>(mandatory)</p>
<p>Specification of the bias estimation option:</p><ul><li><p><code>1</code>: Do not estimate the bias. The bias used to correct the indicator series will be the value
specified with argument <code>bias</code>.</p></li>
<li><p><code>2</code>: Estimate the bias, display the result, but do not use it. The bias used to correct the indicator
series will be the value specified with argument <code>bias</code>.</p></li>
<li><p><code>3</code>: Estimate the bias, display the result and use the estimated bias to correct the indicator series.
Any value specified with argument <code>bias</code> will be ignored.</p></li>
</ul><p>Argument <code>biasOption</code> is ignored when <code>rho = 1.0</code>. See section <strong>Details</strong> for more information on the bias.</p></dd>


<dt id="arg-bias">bias<a class="anchor" aria-label="anchor" href="#arg-bias"></a></dt>
<dd><p>(optional)</p>
<p>Real number, or <code>NA</code>, specifying the value of the user-defined bias to be used for the correction of the
indicator series prior to benchmarking. The bias is added to the indicator series with an additive model
(argument  <code>lambda = 0.0</code>) while it is multiplied otherwise (argument <code>lambda != 0.0</code>). No bias
correction is applied when <code>bias = NA</code>, which is equivalent to specifying <code>bias = 0.0</code> when <code>lambda = 0.0</code>
and <code>bias = 1.0</code> otherwise. Argument <code>bias</code> is ignored when <code>biasOption = 3</code> or <code>rho = 1.0</code>. See section
<strong>Details</strong> for more information on the bias.</p>
<p><strong>Default value</strong> is <code>bias = NA</code> (no user-defined bias).</p></dd>


<dt id="arg-low-freq-periodicity">low_freq_periodicity<a class="anchor" aria-label="anchor" href="#arg-low-freq-periodicity"></a></dt>
<dd><p>(optional)</p>
<p>Positive integer representing the number of periods defining the <em>low</em> (e.g., benchmarks) frequency for adding
the extra spline knots (before the first benchmark and after the last benchmark). For example, <code>low_freq_periodicity = 3</code>
with monthly indicators would define quarterly knots. Annual knots are added when <code>low_freq_periodicity = NA</code>.</p>
<p><strong>Default value</strong> is <code>low_freq_periodicity = NA</code> (annual knots).</p></dd>


<dt id="arg-n-low-freq-proj">n_low_freq_proj<a class="anchor" aria-label="anchor" href="#arg-n-low-freq-proj"></a></dt>
<dd><p>(optional)</p>
<p>Nonnegative integer representing the number of low frequency knots (as defined with argument
<code>low_freq_periodicity</code>) to add at both ends (before the first benchmark and after the last benchmark)
before starting to add <em>high</em> (indicator series) frequency knots.</p>
<p><strong>Default value</strong> is <code>n_low_freq_proj = 1</code>.</p></dd>


<dt id="arg-proj-knots-rho-bd">proj_knots_rho_bd<a class="anchor" aria-label="anchor" href="#arg-proj-knots-rho-bd"></a></dt>
<dd><p>(optional)</p>
<p>Bound that applies to the value specified with argument <code>rho</code> and determines the type of extra knots to be added at
both ends (before the first benchmark and after the last benchmark). When <code>rho &gt; proj_knots_rho_bd</code>, <em>high</em> (indicator
series) frequency knots are used right away. Otherwise, when <code>rho &lt;= proj_knots_rho_bd</code>, <em>low</em> frequency knots (see
arguments <code>low_freq_periodicity</code> and <code>n_low_freq_proj</code>) are first projected on either side. Note that for quarterly
stocks, the cube of the specified <code>proj_knots_rho_bd</code> value is actually used. Therefore, the value for argument
<code>proj_knots_rho_bd</code> should correspond to monthly stock indicators; it is internally adjusted for quarterly stocks.
This argument aims at reaching a compromise for the set periods outside (before or after) the provided benchmarks
(anchor points), i.e., Denton-type (straight line) adjustments as <code>rho</code> approaches 1 (when <code>rho &gt; proj_knots_rho_bd</code>)
and a natural looking (not overly contorted) spline otherwise (when <code>rho &lt;= proj_knots_rho_bd</code>). Section <strong>Details</strong>
contains more information on this subject and some illustrative cases are provided in section <strong>Examples</strong>.</p>
<p><strong>Default value</strong> is <code>proj_knots_rho_bd = 0.995</code> (\(0.995^3\) for quarterly stock indicators).</p></dd>


<dt id="arg-tolv-tolp">tolV, tolP<a class="anchor" aria-label="anchor" href="#arg-tolv-tolp"></a></dt>
<dd><p>(optional)</p>
<p>Nonnegative real number, or <code>NA</code>, specifying the tolerance, in absolute value or percentage, to be used
for the validation of the output binding benchmarks (alterability coefficient of \(0.0\)). This validation
compares the input binding benchmark values with the equivalent values calculated from the benchmarked series
(output) data. Arguments <code>tolV</code> and <code>tolP</code> cannot be both specified (one must be specified while the other
must be <code>NA</code>).</p>
<p><strong>Example:</strong> to set a tolerance of 10 <em>units</em>, specify <code>tolV = 10, tolP = NA</code>; to set a tolerance of 1%,
specify <code>tolV = NA, tolP = 0.01</code>.</p>
<p><strong>Default values</strong> are <code>tolV = 0.001</code> and <code>tolP = NA</code>.</p></dd>


<dt id="arg-warnnegresult">warnNegResult<a class="anchor" aria-label="anchor" href="#arg-warnnegresult"></a></dt>
<dd><p>(optional)</p>
<p>Logical argument specifying whether a warning message is generated when a negative value created by the
function in the benchmarked (output) series is smaller than the threshold specified by argument <code>tolN</code>.</p>
<p><strong>Default value</strong> is <code>warnNegResult = TRUE</code>.</p></dd>


<dt id="arg-toln">tolN<a class="anchor" aria-label="anchor" href="#arg-toln"></a></dt>
<dd><p>(optional)</p>
<p>Negative real number specifying the threshold for the identification of negative values. A value is
considered negative when it is smaller than this threshold.</p>
<p><strong>Default value</strong> is <code>tolN = -0.001</code>.</p></dd>


<dt id="arg-var">var<a class="anchor" aria-label="anchor" href="#arg-var"></a></dt>
<dd><p>(optional)</p>
<p>String vector (minimum length of 1) specifying the variable name(s) in the indicator series data frame
(argument <code>series_df</code>) containing the values and (optionally) the user-defined alterability coefficients
of the series to be benchmarked. These variables must be numeric.</p>
<p>The syntax is <code>var = c("series1 &lt;/ alt_ser1&gt;", "series2 &lt;/ alt_ser2&gt;", ...)</code>. Default alterability
coefficients of \(1.0\) are used when a user-defined alterability coefficients variable is not specified
alongside an indicator series variable. See section <strong>Details</strong> for more information on alterability coefficients.</p>
<p><strong>Example:</strong> <code>var = "value / alter"</code> would benchmark indicator series data frame variable <code>value</code> with the
alterability coefficients contained in variable <code>alter</code> while <code>var = c("value / alter", "value2")</code> would
additionally benchmark variable <code>value2</code> with default alterability coefficients of \(1.0\).</p>
<p><strong>Default value</strong> is <code>var = "value"</code> (benchmark variable <code>value</code> using default alterability coefficients of
\(1.0\)).</p></dd>


<dt id="arg-with">with<a class="anchor" aria-label="anchor" href="#arg-with"></a></dt>
<dd><p>(optional)</p>
<p>String vector (same length as argument <code>var</code>), or <code>NULL</code>, specifying the variable name(s) in the benchmarks data
frame (argument <code>benchmarks_df</code>) containing the values and (optionally) the user-defined alterability coefficients
of the benchmarks. These variables must be numeric. Specifying <code>with = NULL</code> results in using benchmark variable(s)
with the same names(s) as those specified with argument <code>var</code> without user-defined benchmark alterability coefficients
(i.e., default alterability coefficients of \(0.0\) corresponding to binding benchmarks).</p>
<p>The syntax is <code>with = NULL</code> or <code>with = c("bmk1 &lt;/ alt_bmk1&gt;", "bmk2 &lt;/ alt_bmk2&gt;", ...)</code>. Default alterability
coefficients of \(0.0\) (binding benchmarks) are used when a user-defined alterability coefficients variable
is not specified alongside a benchmark variable. See section <strong>Details</strong> for more information on alterability
coefficients.</p>
<p><strong>Example:</strong> <code>with = "val_bmk"</code> would use benchmarks data frame variable <code>val_bmk</code> with default benchmark
alterability coefficients of \(0.0\) to benchmark the indicator series while
<code>with = c("val_bmk", "val_bmk2 / alt_bmk2")</code> would additionally benchmark a second indicator series using
benchmark variable <code>val_bmk2</code> with the benchmark alterability coefficients contained in variable <code>alt_bmk2</code>.</p>
<p><strong>Default value</strong> is <code>with = NULL</code> (same benchmark variable(s) as argument <code>var</code> using default benchmark
alterability coefficients of \(0.0\)).</p></dd>


<dt id="arg-by">by<a class="anchor" aria-label="anchor" href="#arg-by"></a></dt>
<dd><p>(optional)</p>
<p>String vector (minimum length of 1), or <code>NULL</code>, specifying the variable name(s) in the input data frames
(arguments <code>series_df</code> and <code>benchmarks_df</code>) to be used to form groups (for <em>BY-group</em> processing) and allow
the benchmarking of multiple series in a single function call. BY-group variables can be numeric or
character (factors or not), must be present in both input data frames and will appear in all three output
data frames (see section <strong>Value</strong>). BY-group processing is not  implemented when <code>by = NULL</code>. See
"Benchmarking Multiple Series" in section <strong>Details</strong> for more information.</p>
<p><strong>Default value</strong> is <code>by = NULL</code> (no BY-group processing).</p></dd>


<dt id="arg-constant">constant<a class="anchor" aria-label="anchor" href="#arg-constant"></a></dt>
<dd><p>(optional)</p>
<p>Real number that specifies a value to be temporarily added to both the indicator series and the
benchmarks before solving proportional benchmarking problems (<code>lambda != 0.0</code>). The temporary
constant is removed from the final output benchmarked series. E.g., specifying a (small) constant
would allow proportional benchmarking with <code>rho = 1</code> (e.g., proportional Denton benchmarking) on
indicator series that include values of 0. Otherwise, proportional benchmarking with values of 0 in
the indicator series is only possible when <code>rho &lt; 1</code>. Specifying a constant with additive benchmarking
(<code>lambda = 0.0</code>) has no impact on the resulting benchmarked data. The data variables in the <strong>graphTable</strong>
output data frame include the constant, corresponding to the benchmarking problem that was actually solved.</p>
<p><strong>Default value</strong> is <code>constant = 0</code> (no temporary additive constant).</p></dd>


<dt id="arg-neginput-option">negInput_option<a class="anchor" aria-label="anchor" href="#arg-neginput-option"></a></dt>
<dd><p>(optional)</p>
<p>Handling of negative values in the input data for proportional benchmarking (<code>lambda != 0.0</code>):</p><ul><li><p><code>0</code>: Do not allow negative values with proportional benchmarking. An error message is displayed in the
presence of negative values in the input indicator series or benchmarks and missing (<code>NA</code>) values are
returned for the benchmarked series. This corresponds to the G-Series 2.0 behaviour.</p></li>
<li><p><code>1</code>: Allow negative values with proportional benchmarking but display a warning message.</p></li>
<li><p><code>2</code>: Allow negative values with proportional benchmarking without displaying any message.</p></li>
</ul><p><strong>Default value</strong> is <code>negInput_option = 0</code> (do not allow negative values with proportional benchmarking).</p></dd>


<dt id="arg-allcols">allCols<a class="anchor" aria-label="anchor" href="#arg-allcols"></a></dt>
<dd><p>(optional)</p>
<p>Logical argument specifying whether all variables in the indicator series data frame (argument <code>series_df</code>),
other than <code>year</code> and <code>period</code>, determine the set of series to benchmark. Values specified with arguments <code>var</code>
and <code>with</code> are ignored when <code>allCols = TRUE</code>, which automatically implies default alterability coefficients,
and variables with the same names as the indicator series must exist in the benchmarks data frame (argument
<code>benchmarks_df</code>).</p>
<p><strong>Default value</strong> is <code>allCols = FALSE</code>.</p></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p>(optional)</p>
<p>Logical argument specifying whether or not to display only essential information such as warning messages,
error messages and variable (series) or BY-group information when multiple series are benchmarked in a single call
to the function. We advise against <em>wrapping</em> your <code><a href="benchmarking.html">benchmarking()</a></code> call with <code><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages()</a></code> to further suppress
the display of variable (series) or BY-group information when processing multiple series as this would make
troubleshooting difficult in case of issues with individual series. Note that specifying <code>quiet = TRUE</code> would
also <em>nullify</em> argument <code>verbose</code>.</p>
<p><strong>Default value</strong> is <code>quiet = FALSE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The function returns is a list of four data frames:</p><ul><li><p><strong>series</strong>: data frame containing the benchmarked data (primary function output). BY-group variables
specified with argument <code>by</code> would be included in the data frame but not alterability coefficient variables
specified with argument <code>var</code>.</p></li>
<li><p><strong>benchmarks</strong>: copy of the input benchmarks data frame (excluding invalid benchmarks when applicable).
BY-group variables specified with argument <code>by</code> would be included in the data frame but not alterability
coefficient variables specified with argument <code>with</code>.</p></li>
<li><p><strong>graphTable</strong>: data frame containing supplementary data useful to produce analytical tables and graphs
(see function <code><a href="plot_graphTable.html">plot_graphTable()</a></code>). It contains the following variables in addition to the BY-group variables
specified with argument <code>by</code>:</p><ul><li><p><code>varSeries</code>: Name of the indicator series variable</p></li>
<li><p><code>varBenchmarks</code>: Name of the benchmark variable</p></li>
<li><p><code>altSeries</code>: Name of the user-defined indicator series alterability coefficients variable</p></li>
<li><p><code>altSeriesValue</code>: Indicator series alterability coefficients</p></li>
<li><p><code>altbenchmarks</code>: Name of the user-defined benchmark alterability coefficients variable</p></li>
<li><p><code>altBenchmarksValue</code>: Benchmark alterability coefficients</p></li>
<li><p><code>t</code>: Indicator series period identifier (1 to \(T\))</p></li>
<li><p><code>m</code>: Benchmark coverage periods identifier (1 to \(M\))</p></li>
<li><p><code>year</code>: Data point calendar year</p></li>
<li><p><code>period</code>: Data point period (cycle) value (1 to <code>periodicity</code>)</p></li>
<li><p><code>rho</code>: Autoregressive parameter \(\rho\) (argument <code>rho</code>)</p></li>
<li><p><code>lambda</code>: Adjustment model parameter \(\lambda\) (argument <code>lambda</code>)</p></li>
<li><p><code>bias</code>: Bias adjustment (default, user-defined or estimated bias according to arguments <code>biasOption</code> and <code>bias</code>)</p></li>
<li><p><code>periodicity</code>: The maximum number of periods in a year (e.g. 4 for a quarterly indicator series)</p></li>
<li><p><code>date</code>: Character string combining the values of variables <code>year</code> and <code>period</code></p></li>
<li><p><code>subAnnual</code>: Indicator series values</p></li>
<li><p><code>benchmarked</code>: Benchmarked series values</p></li>
<li><p><code>avgBenchmark</code>: Benchmark values divided by the number of coverage periods</p></li>
<li><p><code>avgSubAnnual</code>: Indicator series values (variable <code>subAnnual</code>) averaged over the benchmark coverage period</p></li>
<li><p><code>subAnnualCorrected</code>: Bias corrected indicator series values</p></li>
<li><p><code>benchmarkedSubAnnualRatio</code>: Difference (\(\lambda = 0\)) or ratio (\(\lambda \ne 0\)) of the values
of variables <code>benchmarked</code> and <code>subAnnual</code></p></li>
<li><p><code>avgBenchmarkSubAnnualRatio</code>: Difference (\(\lambda = 0\)) or ratio (\(\lambda \ne 0\)) of the values
of variables <code>avgBenchmark</code> and <code>avgSubAnnual</code></p></li>
<li><p><code>growthRateSubAnnual</code>: Period to period difference (\(\lambda = 0\)) or relative difference (\(\lambda \ne 0\)) of the indicator series values (variable <code>subAnnual</code>)</p></li>
<li><p><code>growthRateBenchmarked</code>: Period to period difference (\(\lambda = 0\)) or relative difference (\(\lambda \ne 0\)) of the benchmarked series values (variable <code>benchmarked</code>)</p></li>
</ul></li>
<li><p><strong>splineKnots</strong>: set of <code>x</code> and <code>y</code> coordinates (knots) used to estimate the natural cubic spline with
function <code><a href="https://rdrr.io/r/stats/splinefun.html" class="external-link">stats::spline()</a></code>. In addition to the original set of knots corresponding to binding benchmarks
(anchor points), extra knots are also added at the beginning and end in order to deal with the <em>benchmarking
timeliness issue</em> and approximate a <em>slope=0</em> spline at both ends (see section <strong>Details</strong>). It contains the following
variables in addition to the BY-group variables specified with argument <code>by</code>:</p><ul><li><p><code>varSeries</code>: Name of the indicator series variable</p></li>
<li><p><code>varBenchmarks</code>: Name of the benchmark variable</p></li>
<li><p><code>x</code>: Cubic spline <code>x</code> coordinate</p></li>
<li><p><code>y</code>: Cubic spline <code>y</code> coordinate</p></li>
<li><p><code>extraKnot</code>: Logical value identifying the extra knots added at the beginning and end</p></li>
</ul><p>Rows for which <code>extraKnot == FALSE</code> correspond to rows in the <strong>graphTable</strong> output data frame for which
<code>m</code> is not missing (not <code>NA</code>), with <code>x = t</code> and <code>y = benchmarkedSubAnnualRatio</code>.</p></li>
</ul><p>Notes:</p><ul><li><p>The output <strong>benchmarks</strong> data frame always contains the original benchmarks provided in the input
benchmarks data frame. Modified nonbinding benchmarks, when applicable, can be recovered (calculated)
from the output <strong>series</strong> data frame.</p></li>
<li><p>The function returns a <code>NULL</code> object if an error occurs before data processing could start. Otherwise,
if execution gets far enough so that data processing could start, then an incomplete object would be
returned in case of errors (e.g., output <strong>series</strong> data frame with <code>NA</code> values for the benchmarked data).</p></li>
<li><p>The function returns "data.frame" objects that can be explicitly coerced to other types of objects with
the appropriate <code>as*()</code> function (e.g., <code><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">tibble::as_tibble()</a></code> would coerce any of them to a tibble).</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>

<div class="section">
<h3 id="comparison-with-benchmarking-">Comparison with <code><a href="benchmarking.html">benchmarking()</a></code><a class="anchor" aria-label="anchor" href="#comparison-with-benchmarking-"></a></h3>


<p>With stock series, <code><a href="benchmarking.html">benchmarking()</a></code> is known to produce breaks in the benchmarking adjustments at
periods corresponding to the benchmark stocks (anchor points). <code>stock_benchmarking()</code> addresses this issue
by working directly on the benchmarking adjustments. Smooth adjustments for stocks are ensured by
estimating a <em>slope=0</em> cubic spline (a spline that is flat at the end knots) going through knots
corresponding to the difference (when argument <code>lambda = 0.0</code>) or ratio (otherwise) between the benchmarks
(anchor points) and the corresponding indicator series values. These knots are sometimes referred to as
<em>BI</em> (<em><strong>B</strong></em>enchmark-to-<em><strong>I</strong></em>ndicator) <em>differences</em> or <em>BI ratios</em>. Interpolations from the estimated
cubic spline then provide the adjustments for the periods between benchmarks.</p>
<p>Arguments <code>rho</code>, <code>lambda</code>, <code>biasOption</code>and <code>bias</code> play a similar role as in <code><a href="benchmarking.html">benchmarking()</a></code>. However,
note that for <code>stock_benchmarking()</code>, argument <code>rho</code> only affects the results for periods outside of, or
around the, first and last benchmarks and <code>lambda</code> only takes two values in practice: <code>lambda = 0.0</code> for
additive adjustments (spline interpolations where the knots are <em>BI differences</em>) or <code>lambda = 1.0</code> for
multiplicative adjustments (spline interpolations where the knots are <em>BI ratios</em>). Any nonzero value for
<code>lambda</code> would return the same result as <code>lambda = 1.0</code>. Alterability coefficients also play a similar role
as in <code><a href="benchmarking.html">benchmarking()</a></code> and have the same default values, i.e., \(1.0\) for the indicator series
(nonbinding values) and \(0.0\) for the benchmarks (binding benchmarks). However, similar to argument
<code>lambda</code>, alterability coefficients in this function only take two values in practice: \(0.0\) for binding
values or \(1.0\) for nonbinding values. Any nonzero alterability coefficient would return the same result
as a coefficient of \(1.0\). Another difference with <code><a href="benchmarking.html">benchmarking()</a></code> is that user-defined
alterability coefficients are allowed even when <code>rho = 1</code> with <code>stock_benchmarking()</code>. Finally, specifying a
nonbinding benchmark with <code>stock_benchmarking()</code>  is equivalent to ignoring the benchmark entirely, as if the
benchmark was not included in the input benchmarks file. Compared to <code><a href="benchmarking.html">benchmarking()</a></code>, this generally
translates into nonbinding benchmarks having a larger impact on the resulting benchmarked stocks.</p>
</div>

<div class="section">
<h3 id="solution-around-the-first-and-last-benchmarks-benchmarking-timeliness-issue-">Solution around the first and last benchmarks (benchmarking <em>timeliness issue</em>)<a class="anchor" aria-label="anchor" href="#solution-around-the-first-and-last-benchmarks-benchmarking-timeliness-issue-"></a></h3>


<p>A <em>slope=0</em> spline is chosen because it conceptually corresponds to the (popular) <em>Denton benchmarking</em>
approach (<code>rho = 1</code>). In order to provide a solution before the first benchmark and after the last benchmark
that is similar to <code><a href="benchmarking.html">benchmarking()</a></code> when <code>rho &lt; 1</code>, i.e., adjustments converging to the bias at a speed
dictated by argument <code>rho</code>, extra knots are added at both ends before estimating the spline. By default, one
extra low frequency (as defined with argument <code>low_freq_periodicity</code>) knot is added on each side (beginning
and end), i.e. one extra knot is added before the first benchmark and after the last benchmark. Then, high
(indicator series) frequency knots are added to cover the indicator series span to which is added an extra
year worth of high frequency knots. The value of all those extra knots is based on arguments <code>rho</code>, <code>biasOption</code>
and <code>bias</code>. This produces natural looking, smooth adjustments for periods outside of or around the first and last
benchmarks that gradually converge to the bias, similarly to <code><a href="benchmarking.html">benchmarking()</a></code>. The number of extra low
frequency knots to be added can be modified with argument <code>n_low_freq_proj</code>. Using high frequency knots right
away (<code>n_low_freq_proj = 0</code>) would produce the same projected adjustments as <code><a href="benchmarking.html">benchmarking()</a></code>. However,
note that this tends to produce an unnatural looking (overly contorted) spline around the first and last
benchmarks that could be substantially revised once the next benchmark is available. Using the default
<code>n_low_freq_proj = 1</code> generally works better. However, when <code>rho</code> is <em>close to 1</em> (see argument <code>proj_knots_rho_bd</code>),
high frequency knots are immediately added on each side in order to ensure Denton-type (straight line) projected
adjustments for periods outside of the first and last benchmarks. Finally, a <em>slope=0</em> cubic spline is fitted through
the (original and extra) knots. Note that in practice, the <em>slope=0</em> spline is actually approximated by
replicating the value of the end knots 100 times within the following period (at a frequency corresponding
to 100 times the indicator series frequency).</p>
<p>A <em>natural spline</em> at the original end knots (first and last benchmarks) can be approximated by specifying
a large value for argument <code>low_freq_periodicity</code>. The larger the value of <code>low_freq_periodicity</code>, the more
the cubic spline at the end knots will behave like a <em>natural spline</em> (2<sup>nd</sup> derivative equal to 0
at the end knots, i.e., a spline that keeps a constant slope at the end knots as opposed to being flat like
a <em>slope=0</em> spline).</p>
<p>In summary, the projected adjustments are controlled with arguments <code>rho</code>, <code>bias</code> (and <code>biasOption</code>),
<code>n_low_freq_proj</code>, <code>proj_knots_rho_bd</code> and <code>low_freq_periodicity</code>:</p><ul><li><p>Default values for these arguments produce <code><a href="benchmarking.html">benchmarking()</a></code> function-like projected adjustments
(reasonably slow convergence to the bias).</p></li>
<li><p>Smaller values of <code>rho</code> would generate faster convergence to the bias.</p></li>
<li><p>Specifying a user-defined bias with argument <code>bias</code> when <code>rho &lt; 1</code> is another way to influence the shape
of the projected adjustments.</p></li>
<li><p>Specifying <code>rho = 1</code> produce Denton-like projected adjustments (repeated first/last adjustments without
convergence to the bias).</p></li>
<li><p>Specifying a large value for <code>low_freq_periodicity</code> generates projected adjustments that behave more
like a natural spline, i.e., adjustments that continue in the same direction at the first/last benchmark.
The larger the value of <code>low_freq_periodicity</code>, the more the projected adjustments keep on going in the
same direction before <em>turning around</em>.</p></li>
</ul></div>

<div class="section">
<h3 id="note-on-revisions-to-the-benchmarking-adjustments">Note on revisions to the benchmarking adjustments<a class="anchor" aria-label="anchor" href="#note-on-revisions-to-the-benchmarking-adjustments"></a></h3>


<p><code><a href="benchmarking.html">benchmarking()</a></code> adjustments would not be revised if all future benchmarks were to fall exactly on the
projected ones (based on the bias and value of <code>rho</code>) and the bias was fixed. The same could be achieved
with <code>stock_benchmarking()</code> if <em>enough</em> low (e.g., benchmarks) frequency knots were projected. The problem
with this approach, however, is that the projected adjustments may not look natural as the spline may
oscillate more than desired around the projected knots. This is clearly noticeable as <code>rho</code> approaches 1
and the spline oscillates around the horizontally aligned projected knots instead of being aligned in a
perfectly straight line. The default implementation of the spline around the first and last benchmarks
described previously aims at reaching a <em>best compromise</em> solution:</p><ul><li><p>a natural looking spline around the end knots avoiding oscillations and excessive contortions;</p></li>
<li><p>small revisions to the spline if the next benchmark is close to the projected one when <code>rho</code> is <em>far enough</em>
from 1 (<code>rho &lt;= proj_knots_rho_bd</code>);</p></li>
<li><p>projected adjustments that are in a straight line (free of oscillations) as <code>rho</code> approaches 1 (<code>rho &gt; proj_knots_rho_bd</code>).</p></li>
</ul><p>Subsections <em>Benchmarking Multiple Series</em>, <em>Arguments <code>constant</code> and <code>negInput_option</code></em> and <em>Treatment
of Missing (<code>NA</code>) Values</em> at the end of the <code><a href="benchmarking.html">benchmarking()</a></code> <strong>Details</strong> section are also relevant for
<code>stock_benchmarking()</code>. Consult them as necessary.</p>
<p>Finally, note that the cubic spline associated to the <code>stock_benchmarking()</code> adjustments can be conveniently
plotted with <code><a href="plot_benchAdj.html">plot_benchAdj()</a></code>. The latter is used in the <strong>Examples</strong> to illustrate some of the topics discussed
above.</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Statistics Canada (2012). "Chapter 5: Benchmarking Stock". <strong>Theory and Application of Benchmarking
(Course code 0436)</strong>. Statistics Canada, Ottawa, Canada.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="benchmarking.html">benchmarking()</a></code> <code><a href="plot_graphTable.html">plot_graphTable()</a></code> <a href="bench_graphs.html">bench_graphs</a> <code><a href="plot_benchAdj.html">plot_benchAdj()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Quarterly stock series (same pattern repeated every year)</span></span></span>
<span class="r-in"><span><span class="va">my_series</span> <span class="op">&lt;-</span> <span class="fu"><a href="ts_to_tsDF.html">ts_to_tsDF</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/ts.html" class="external-link">ts</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">85</span>, <span class="fl">95</span>, <span class="fl">125</span>, <span class="fl">95</span><span class="op">)</span>, <span class="fl">7</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2013</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           frequency <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">my_series</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   year period value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 2013      1    85</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 2013      2    95</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 2013      3   125</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 2013      4    95</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 2014      1    85</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 2014      2    95</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Annual benchmarks (end-of-year stocks)</span></span></span>
<span class="r-in"><span><span class="va">my_benchmarks</span> <span class="op">&lt;-</span> <span class="fu"><a href="ts_to_bmkDF.html">ts_to_bmkDF</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/ts.html" class="external-link">ts</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">135</span>, <span class="fl">125</span>, <span class="fl">155</span>, <span class="fl">145</span>, <span class="fl">165</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                start <span class="op">=</span> <span class="fl">2013</span>,</span></span>
<span class="r-in"><span>                                frequency <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                             discrete_flag <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                             alignment <span class="op">=</span> <span class="st">"e"</span>,</span></span>
<span class="r-in"><span>                             ind_frequency <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">my_benchmarks</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   startYear startPeriod endYear endPeriod value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1      2013           4    2013         4   135</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2      2014           4    2014         4   125</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3      2015           4    2015         4   155</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4      2016           4    2016         4   145</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5      2017           4    2017         4   165</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Benchmark using...</span></span></span>
<span class="r-in"><span><span class="co">#   - recommended `rho` value for quarterly series (`rho = 0.729`)</span></span></span>
<span class="r-in"><span><span class="co">#   - proportional model (`lambda = 1`)</span></span></span>
<span class="r-in"><span><span class="co">#   - bias-corrected indicator series with the estimated bias (`biasOption = 3`)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ... with `benchmarking()` ("Proc Benchmarking" approach)</span></span></span>
<span class="r-in"><span><span class="va">out_PB</span> <span class="op">&lt;-</span> <span class="fu"><a href="benchmarking.html">benchmarking</a></span><span class="op">(</span><span class="va">my_series</span>,</span></span>
<span class="r-in"><span>                       <span class="va">my_benchmarks</span>,</span></span>
<span class="r-in"><span>                       rho <span class="op">=</span> <span class="fl">0.729</span>,</span></span>
<span class="r-in"><span>                       lambda <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>                       biasOption <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> --- Package gstest 3.0.0 - (EN) 'G-Series' in 'R' | (FR) 'G-Séries' en 'R' ---</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Created on April 8, 2025, at 3:40:01 PM EDT</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> URL: https://ferlmic.github.io/gstest/en/</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>      https://ferlmic.github.io/gstest/fr/</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Email: g-series@statcan.gc.ca</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> benchmarking() function:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     series_df          = my_series</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     benchmarks_df      = my_benchmarks</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     rho                = 0.729</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     lambda             = 1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     biasOption         = 3 (Calculate bias, use calculated bias)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     bias               (ignored)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     tolV               = 0.001 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     warnNegResult      = TRUE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     tolN               = -0.001 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     var                = value (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     with               = NULL (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     by                 = NULL (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     verbose            = FALSE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)constant        = 0 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)negInput_option = 0 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)allCols         = FALSE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)quiet           = FALSE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*) indicates new arguments in G-Series 3.0</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of observations in the BENCHMARKS data frame .............:  5</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of valid observations in the BENCHMARKS data frame .......:  5</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of observations in the SERIES data frame .................: 28</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of valid observations in the SERIES data frame ...........: 28</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> BIAS = 1.526316 (calculated)</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ... with `stock_benchmarking()` ("Stock Benchmarking" approach)</span></span></span>
<span class="r-in"><span><span class="va">out_SB</span> <span class="op">&lt;-</span> <span class="fu">stock_benchmarking</span><span class="op">(</span><span class="va">my_series</span>,</span></span>
<span class="r-in"><span>                             <span class="va">my_benchmarks</span>,</span></span>
<span class="r-in"><span>                             rho <span class="op">=</span> <span class="fl">0.729</span>,</span></span>
<span class="r-in"><span>                             lambda <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>                             biasOption <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> --- Package gstest 3.0.0 - (EN) 'G-Series' in 'R' | (FR) 'G-Séries' en 'R' ---</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Created on April 8, 2025, at 3:40:01 PM EDT</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> URL: https://ferlmic.github.io/gstest/en/</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>      https://ferlmic.github.io/gstest/fr/</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Email: g-series@statcan.gc.ca</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> stock_benchmarking() function:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     series_df            = my_series</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     benchmarks_df        = my_benchmarks</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     rho                  = 0.729</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     lambda               = 1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     biasOption           = 3 (Calculate bias, use calculated bias)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     bias                 (ignored)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     low_freq_periodicity = NA (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     n_low_freq_proj      = 1 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     proj_knots_rho_bd    = 0.995 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     tolV                 = 0.001 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     warnNegResult        = TRUE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     tolN                 = -0.001 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     var                  = value (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     with                 = NULL (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     by                   = NULL (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     constant             = 0 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     negInput_option      = 0 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     allCols              = FALSE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     quiet                = FALSE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of observations in the BENCHMARKS data frame .............:  5</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of valid observations in the BENCHMARKS data frame .......:  5</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of observations in the SERIES data frame .................: 28</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of valid observations in the SERIES data frame ...........: 28</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> BIAS = 1.526316 (calculated)</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Compare the benchmarking adjustments of both approaches</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_benchAdj.html">plot_benchAdj</a></span><span class="op">(</span>PB_graphTable <span class="op">=</span> <span class="va">out_PB</span><span class="op">$</span><span class="va">graphTable</span>,</span></span>
<span class="r-in"><span>              SB_graphTable <span class="op">=</span> <span class="va">out_SB</span><span class="op">$</span><span class="va">graphTable</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="stock_benchmarking-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Have you noticed how smoother the `stock_benchmarking()` adjustments are compared </span></span></span>
<span class="r-in"><span><span class="co"># to the `benchmarking()` ones?</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The gain in the quality of the resulting benchmarked stocks might not necessarily</span></span></span>
<span class="r-in"><span><span class="co"># be obvious in this example</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out_SB</span><span class="op">$</span><span class="va">graphTable</span><span class="op">$</span><span class="va">t</span>, <span class="va">out_SB</span><span class="op">$</span><span class="va">graphTable</span><span class="op">$</span><span class="va">benchmarked</span>,</span></span>
<span class="r-in"><span>     type <span class="op">=</span> <span class="st">"b"</span>, col <span class="op">=</span> <span class="st">"red"</span>, xlab <span class="op">=</span> <span class="st">"t"</span>, ylab <span class="op">=</span> <span class="st">"Benchmarked Stock"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">out_PB</span><span class="op">$</span><span class="va">graphTable</span><span class="op">$</span><span class="va">t</span>, <span class="va">out_PB</span><span class="op">$</span><span class="va">graphTable</span><span class="op">$</span><span class="va">benchmarked</span>,</span></span>
<span class="r-in"><span>      type <span class="op">=</span> <span class="st">"b"</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"topleft"</span>, bty <span class="op">=</span> <span class="st">"n"</span>, inset <span class="op">=</span> <span class="fl">0.05</span>, lty <span class="op">=</span> <span class="fl">1</span>, pch <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>       col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"blue"</span><span class="op">)</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"out_SB"</span>, <span class="st">"out_PB"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Benchmarked Stock"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="stock_benchmarking-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># What about cases where a flat indicator is used, which may happen in practice</span></span></span>
<span class="r-in"><span><span class="co"># in absence of a good indicator of the quarterly (sub-annual) movement?</span></span></span>
<span class="r-in"><span><span class="va">my_series2</span> <span class="op">&lt;-</span> <span class="va">my_series</span></span></span>
<span class="r-in"><span><span class="va">my_series2</span><span class="op">$</span><span class="va">value</span> <span class="op">&lt;-</span> <span class="fl">1</span>  <span class="co"># flat indicator</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">my_series2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   year period value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 2013      1     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 2013      2     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 2013      3     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 2013      4     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 2014      1     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 2014      2     1</span>
<span class="r-in"><span><span class="va">out_PB2</span> <span class="op">&lt;-</span> <span class="fu"><a href="benchmarking.html">benchmarking</a></span><span class="op">(</span><span class="va">my_series2</span>,</span></span>
<span class="r-in"><span>                        <span class="va">my_benchmarks</span>,</span></span>
<span class="r-in"><span>                        rho <span class="op">=</span> <span class="fl">0.729</span>,</span></span>
<span class="r-in"><span>                        lambda <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>                        biasOption <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>                        quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>  <span class="co"># don't show the function header</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">out_SB2</span> <span class="op">&lt;-</span> <span class="fu">stock_benchmarking</span><span class="op">(</span><span class="va">my_series2</span>,</span></span>
<span class="r-in"><span>                              <span class="va">my_benchmarks</span>,</span></span>
<span class="r-in"><span>                              rho <span class="op">=</span> <span class="fl">0.729</span>,</span></span>
<span class="r-in"><span>                              lambda <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>                              biasOption <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>                              quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>  <span class="co"># don't show the function header</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out_SB2</span><span class="op">$</span><span class="va">graphTable</span><span class="op">$</span><span class="va">t</span>, <span class="va">out_SB2</span><span class="op">$</span><span class="va">graphTable</span><span class="op">$</span><span class="va">benchmarked</span>,</span></span>
<span class="r-in"><span>     type <span class="op">=</span> <span class="st">"b"</span>, col <span class="op">=</span> <span class="st">"red"</span>, xlab <span class="op">=</span> <span class="st">"t"</span>, ylab <span class="op">=</span> <span class="st">"Benchmarked Stock"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">out_PB2</span><span class="op">$</span><span class="va">graphTable</span><span class="op">$</span><span class="va">t</span>, <span class="va">out_PB2</span><span class="op">$</span><span class="va">graphTable</span><span class="op">$</span><span class="va">benchmarked</span>,</span></span>
<span class="r-in"><span>      type <span class="op">=</span> <span class="st">"b"</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"bottomright"</span>, bty <span class="op">=</span> <span class="st">"n"</span>, inset <span class="op">=</span> <span class="fl">0.05</span>, lty <span class="op">=</span> <span class="fl">1</span>, pch <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>       col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"blue"</span><span class="op">)</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"out_SB2"</span>, <span class="st">"out_PB2"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Benchmarked Stock - Flat Indicator"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="stock_benchmarking-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The awkwardness of the benchmarked stocks produced by `benchmarking()` suddenly</span></span></span>
<span class="r-in"><span><span class="co"># becomes obvious. That's because the benchmarked series corresponds to the</span></span></span>
<span class="r-in"><span><span class="co"># benchmarking adjustments when using a flat indicator (e.g., a series on 1's</span></span></span>
<span class="r-in"><span><span class="co"># with proportional benchmarking):</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_benchAdj.html">plot_benchAdj</a></span><span class="op">(</span>PB_graphTable <span class="op">=</span> <span class="va">out_PB2</span><span class="op">$</span><span class="va">graphTable</span>,</span></span>
<span class="r-in"><span>              SB_graphTable <span class="op">=</span> <span class="va">out_SB2</span><span class="op">$</span><span class="va">graphTable</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="stock_benchmarking-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The shortcomings of the "Proc Benchmarking" approach (function `benchmarking()`)</span></span></span>
<span class="r-in"><span><span class="co"># with stocks is also quite noticeable in this case when looking at the resulting</span></span></span>
<span class="r-in"><span><span class="co"># quarterly growth rates, which are conveniently produced by `plot_graphTable()`.</span></span></span>
<span class="r-in"><span><span class="co"># Pay particular attention to the transition in the growth rates from Q4 to Q1</span></span></span>
<span class="r-in"><span><span class="co"># every year in the generated PDF graphs.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_graphTable.html">plot_graphTable</a></span><span class="op">(</span><span class="va">out_PB2</span><span class="op">$</span><span class="va">graphTable</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"PB_stock_flat_ind.pdf"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Generating the benchmarking graphics. Please be patient...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Benchmarking graphics generated for 1 series in the following PDF file:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   %TEMP%\Rtmp0M5DK2\PB_stock_flat_ind.pdf</span>
<span class="r-in"><span><span class="fu"><a href="plot_graphTable.html">plot_graphTable</a></span><span class="op">(</span><span class="va">out_SB2</span><span class="op">$</span><span class="va">graphTable</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"SB_stock_flat_ind.pdf"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Generating the benchmarking graphics. Please be patient...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Benchmarking graphics generated for 1 series in the following PDF file:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   %TEMP%\Rtmp0M5DK2\SB_stock_flat_ind.pdf</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Illustrate approximating a natural cubic spline at the original end knots (first and </span></span></span>
<span class="r-in"><span><span class="co"># last benchmarks) by specifying a large `low_freq_periodicity` value.</span></span></span>
<span class="r-in"><span><span class="va">out_SB3</span> <span class="op">&lt;-</span> <span class="fu">stock_benchmarking</span><span class="op">(</span><span class="va">my_series</span>,</span></span>
<span class="r-in"><span>                              <span class="va">my_benchmarks</span>,</span></span>
<span class="r-in"><span>                              rho <span class="op">=</span> <span class="fl">0.729</span>,</span></span>
<span class="r-in"><span>                              lambda <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>                              biasOption <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>                              </span></span>
<span class="r-in"><span>                              <span class="co"># Large value to approximate a natural cubic spline</span></span></span>
<span class="r-in"><span>                              low_freq_periodicity <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>                              </span></span>
<span class="r-in"><span>                              quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_benchAdj.html">plot_benchAdj</a></span><span class="op">(</span>SB_graphTable <span class="op">=</span> <span class="va">out_SB3</span><span class="op">$</span><span class="va">graphTable</span>,</span></span>
<span class="r-in"><span>              SB_splineKnots <span class="op">=</span> <span class="va">out_SB3</span><span class="op">$</span><span class="va">splineKnots</span>,</span></span>
<span class="r-in"><span>              legendPos <span class="op">=</span> <span class="st">"topleft"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="stock_benchmarking-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Illustrate "oscillations" of the cubic spline beyond the original end knots with</span></span></span>
<span class="r-in"><span><span class="co"># Denton-type benchmarking (`rho ~ 1`) caused by using low frequency (annual) extra knots.</span></span></span>
<span class="r-in"><span><span class="va">out_SB4</span> <span class="op">&lt;-</span> <span class="fu">stock_benchmarking</span><span class="op">(</span><span class="va">my_series</span>,</span></span>
<span class="r-in"><span>                              <span class="va">my_benchmarks</span>,</span></span>
<span class="r-in"><span>                              rho <span class="op">=</span> <span class="fl">0.999</span>,</span></span>
<span class="r-in"><span>                              lambda <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>                              biasOption <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>                              </span></span>
<span class="r-in"><span>                              <span class="co"># Use 3 annual extra knots first</span></span></span>
<span class="r-in"><span>                              n_low_freq_proj <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>                              proj_knots_rho_bd <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>                              </span></span>
<span class="r-in"><span>                              quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_benchAdj.html">plot_benchAdj</a></span><span class="op">(</span>SB_graphTable <span class="op">=</span> <span class="va">out_SB4</span><span class="op">$</span><span class="va">graphTable</span>,</span></span>
<span class="r-in"><span>              SB_splineKnots <span class="op">=</span> <span class="va">out_SB4</span><span class="op">$</span><span class="va">splineKnots</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="stock_benchmarking-6.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># No "oscillations" with the default `proj_knots_rho_bd` value because high frequency </span></span></span>
<span class="r-in"><span><span class="co"># (quarterly) extra knots are used right away (`n_low_freq_proj` is ignored) since </span></span></span>
<span class="r-in"><span><span class="co"># `rho = 0.999` exceeds the default `proj_knots_rho_bd` value (0.995^3 for quarterly data). </span></span></span>
<span class="r-in"><span><span class="co"># These projected adjustments are more in line with Denton-type adjustments (straight line).</span></span></span>
<span class="r-in"><span><span class="va">out_SB4b</span> <span class="op">&lt;-</span> <span class="fu">stock_benchmarking</span><span class="op">(</span><span class="va">my_series</span>,</span></span>
<span class="r-in"><span>                               <span class="va">my_benchmarks</span>,</span></span>
<span class="r-in"><span>                               rho <span class="op">=</span> <span class="fl">0.999</span>,</span></span>
<span class="r-in"><span>                               lambda <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>                               biasOption <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>                               quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_benchAdj.html">plot_benchAdj</a></span><span class="op">(</span>SB_graphTable <span class="op">=</span> <span class="va">out_SB4b</span><span class="op">$</span><span class="va">graphTable</span>,</span></span>
<span class="r-in"><span>              SB_splineKnots <span class="op">=</span> <span class="va">out_SB4b</span><span class="op">$</span><span class="va">splineKnots</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="stock_benchmarking-7.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Illustrate "contortions" of the cubic spline around the original end knots caused</span></span></span>
<span class="r-in"><span><span class="co"># by using high frequency extra knots right away (`n_low_freq_proj = 0`), i.e., using </span></span></span>
<span class="r-in"><span><span class="co"># the same projected adjustments as those that would be obtained with `benchmarking()`.</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># To exacerbate the phenomenon, we'll use monthly data (11 periods between each annual </span></span></span>
<span class="r-in"><span><span class="co"># benchmark compared to only 3 for quarterly data, i.e., a less constrained spline) </span></span></span>
<span class="r-in"><span><span class="co"># and a rather small value for `rho` (0.5 &lt; 0.9 = recommended value for monthly data) </span></span></span>
<span class="r-in"><span><span class="co"># for a faster convergence to the bias of the projected adjustments.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">yr_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">my_series</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">my_series3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">yr_vec</span>, each <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                         period <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">yr_vec</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                         value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">12</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">yr_vec</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  <span class="co"># flat indicator</span></span></span>
<span class="r-in"><span><span class="va">my_benchmarks2</span> <span class="op">&lt;-</span> <span class="va">my_benchmarks</span></span></span>
<span class="r-in"><span><span class="va">my_benchmarks2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"startPeriod"</span>, <span class="st">"endPeriod"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">12</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">out_SB5</span> <span class="op">&lt;-</span> <span class="fu">stock_benchmarking</span><span class="op">(</span><span class="va">my_series3</span>,</span></span>
<span class="r-in"><span>                              <span class="va">my_benchmarks2</span>,</span></span>
<span class="r-in"><span>                              rho <span class="op">=</span> <span class="fl">0.5</span>,</span></span>
<span class="r-in"><span>                              lambda <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>                              biasOption <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>                              </span></span>
<span class="r-in"><span>                              <span class="co"># Use monthly extra knots right away</span></span></span>
<span class="r-in"><span>                              n_low_freq_proj <span class="op">=</span> <span class="fl">0</span>,</span></span>
<span class="r-in"><span>                              </span></span>
<span class="r-in"><span>                              quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_benchAdj.html">plot_benchAdj</a></span><span class="op">(</span>SB_graphTable <span class="op">=</span> <span class="va">out_SB5</span><span class="op">$</span><span class="va">graphTable</span>,</span></span>
<span class="r-in"><span>              SB_splineKnots <span class="op">=</span> <span class="va">out_SB5</span><span class="op">$</span><span class="va">splineKnots</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="stock_benchmarking-8.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># No excessive "contortions" around the original end knots with the default  </span></span></span>
<span class="r-in"><span><span class="co"># `n_low_freq_proj = 1`, i.e., use 1 low frequency (annual) extra knot first.</span></span></span>
<span class="r-in"><span><span class="va">out_SB5b</span> <span class="op">&lt;-</span> <span class="fu">stock_benchmarking</span><span class="op">(</span><span class="va">my_series3</span>,</span></span>
<span class="r-in"><span>                               <span class="va">my_benchmarks2</span>,</span></span>
<span class="r-in"><span>                               rho <span class="op">=</span> <span class="fl">0.5</span>,</span></span>
<span class="r-in"><span>                               lambda <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>                               biasOption <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>                               quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_benchAdj.html">plot_benchAdj</a></span><span class="op">(</span>SB_graphTable <span class="op">=</span> <span class="va">out_SB5b</span><span class="op">$</span><span class="va">graphTable</span>,</span></span>
<span class="r-in"><span>              SB_splineKnots <span class="op">=</span> <span class="va">out_SB5b</span><span class="op">$</span><span class="va">splineKnots</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="stock_benchmarking-9.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># To even better highlight the potential excessive "contortions" of the cubic spline </span></span></span>
<span class="r-in"><span><span class="co"># when enforcing the `benchmarking()` projected adjustment (i.e., low frequency extra </span></span></span>
<span class="r-in"><span><span class="co"># knots right away with `n_low_freq_proj = 0`), let's plot the previous two sets of </span></span></span>
<span class="r-in"><span><span class="co"># adjustments on the same plot (the blue line corresponds to the `n_low_freq_proj = 0` </span></span></span>
<span class="r-in"><span><span class="co"># case, i.e., the `benchmarking()` projected adjustments while the red line corresponds </span></span></span>
<span class="r-in"><span><span class="co"># to the default `stock_benchmarking()` adjustments, i.e., `n_low_freq_proj = 1`).</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_benchAdj.html">plot_benchAdj</a></span><span class="op">(</span>PB_graphTable <span class="op">=</span> <span class="va">out_SB5</span><span class="op">$</span><span class="va">graphTable</span>,</span></span>
<span class="r-in"><span>              SB_graphTable <span class="op">=</span> <span class="va">out_SB5b</span><span class="op">$</span><span class="va">graphTable</span>,</span></span>
<span class="r-in"><span>              legend <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="stock_benchmarking-10.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michel Ferland, Statistics Canada.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

