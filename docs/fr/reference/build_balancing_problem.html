<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="fr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Construire les éléments de base des problèmes d'équilibrage. — build_balancing_problem • gstest</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Construire les éléments de base des problèmes d'équilibrage. — build_balancing_problem"><meta name="description" content="Cette fonction est utilisée à l'interne par tsbalancing() pour construire les éléments de base des problèmes
d'équilibrage. Elle peut également être utile pour dériver manuellement les séries indirectes associées aux
contraintes d'équilibrage d'égalité (en dehors du contexte de tsbalancing())."><meta property="og:description" content="Cette fonction est utilisée à l'interne par tsbalancing() pour construire les éléments de base des problèmes
d'équilibrage. Elle peut également être utile pour dériver manuellement les séries indirectes associées aux
contraintes d'équilibrage d'égalité (en dehors du contexte de tsbalancing())."><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script></head><body>
    <a href="#main" class="visually-hidden-focusable">Passer au contenu</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Navigation sur le site"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gstest</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Dernière version publiée">3.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Activer la navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/gstest.html">Prise en main</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Référence</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/benchmarking-cookbook.html">Livre de recette sur l'étalonnage</a></li>
    <li><a class="dropdown-item" href="../articles/benchmarking-demo-script.html">Un script d'étalonnage pour débutant</a></li>
    <li><a class="dropdown-item" href="../articles/osqp-settings-sequence-dataframe.html">« Data frame » pour la séquence de paramètres d'OSQP</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-nouveaut-s" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Nouveautés</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-nouveaut-s"><li><h6 class="dropdown-header" data-toc-skip>Versions</h6></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ferlmic/gstest/tree/main/">G-Séries 3.0 (version la plus récente - librairie R gstest 3.0.0)</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ferlmic/gstest/releases/tag/v2.0/">G-Séries 2.0 (version SAS®)</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ferlmic/gstest/releases/tag/v1.04/">G-Séries 1.04 (version SAS®)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changements</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Rechercher sur le site" placeholder="Rechercher" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ferlmic/gstest/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>

    <ul class="navbar-nav"><li class="nav-item"><a class="nav-link" href="#" onclick="window.location = location.href.replace('/fr/','/en/');"><span class="fa fa-language fa-lg"></span> English</a></li></ul></div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Construire les éléments de base des problèmes d'équilibrage.</h1>
      <small class="dont-index">Source : <a href="https://github.com/ferlmic/gstest/tree/main/fr/R/tsbalancing.R" class="external-link"><code>R/tsbalancing.R</code></a></small>
      <div class="d-none name"><code>build_balancing_problem.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Cette fonction est utilisée à l'interne par <code><a href="tsbalancing.html">tsbalancing()</a></code> pour construire les éléments de base des problèmes
d'équilibrage. Elle peut également être utile pour dériver manuellement les séries indirectes associées aux
contraintes d'équilibrage d'égalité (en dehors du contexte de <code><a href="tsbalancing.html">tsbalancing()</a></code>).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Utilisation<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">build_balancing_problem</span><span class="op">(</span></span>
<span>  <span class="va">in_ts</span>,</span>
<span>  <span class="va">problem_specs_df</span>,</span>
<span>  in_ts_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/deparse.html" class="external-link">deparse1</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span><span class="va">in_ts</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  ts_freq <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/time.html" class="external-link">frequency</a></span><span class="op">(</span><span class="va">in_ts</span><span class="op">)</span>,</span>
<span>  periods <span class="op">=</span> <span class="fu"><a href="time_values_conv.html">gs.time2str</a></span><span class="op">(</span><span class="va">in_ts</span><span class="op">)</span>,</span>
<span>  n_per <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">in_ts</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  specs_df_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/deparse.html" class="external-link">deparse1</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span><span class="va">problem_specs_df</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  temporal_grp_periodicity <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  alter_pos <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  alter_neg <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  alter_mix <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  lower_bound <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>,</span>
<span>  upper_bound <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  validation_only <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-in-ts">in_ts<a class="anchor" aria-label="anchor" href="#arg-in-ts"></a></dt>
<dd><p>(obligatoire)</p>
<p>Objet de type série chronologique (« ts » ou « mts »), ou objet compatible, qui contient les données des séries
chronologiques à réconcilier. Il s'agit des données d'entrée (solutions initiales) des problèmes d'équilibrage
(« <em>balancing</em> »).</p></dd>


<dt id="arg-problem-specs-df">problem_specs_df<a class="anchor" aria-label="anchor" href="#arg-problem-specs-df"></a></dt>
<dd><p>(obligatoire)</p>
<p><em>Data frame</em> des spécifications du problème d'équilibrage. En utilisant un format clairsemé (épars) inspiré de la
procédure LP de SAS/OR\(^\circledR\) (SAS Institute 2015), il ne contient que les informations pertinentes
telles que les coefficients non nuls des contraintes d'équilibrage ainsi que les coefficients d'altérabilité et les
bornes inférieures/supérieures à utiliser au lieu des valeurs par défaut (c.-à-d., les valeurs qui auraient la priorité
sur celles définies avec les arguments <code>alter_pos</code>, <code>alter_neg</code>, <code>alter_mix</code>, <code>alter_temporal</code>, <code>lower_bound</code> et
<code>upper_bound</code>).</p>
<p>Les informations sont fournies à l'aide de quatre variables obligatoires (<code>type</code>, <code>col</code>, <code>row</code> et <code>coef</code>) et d'une
variable facultative (<code>timeVal</code>). Un enregistrement (une rangée) dans le <em>data frame</em> des spécifications du problème
définit soit une étiquette pour l'un des sept types d'éléments du problème d'équilibrage avec les colonnes <code>type</code> et <code>row</code>
(voir <em>Enregistrements de définition d'étiquette</em> ci-dessous) ou bien spécifie des coefficients (valeurs numériques) pour
ces éléments du problème d'équilibrage avec les variables <code>col</code>, <code>row</code>, <code>coef</code> et <code>timeVal</code> (voir <em>Enregistrements de
spécification d'information</em> ci-dessous).</p><ul><li><p><strong>Enregistrements de définition d'étiquette</strong> (<code>type</code> n'est pas manquant (n'est pas <code>NA</code>))</p><ul><li><p><code>type</code> (car) : mot-clé réservé identifiant le type d'élément du problème en cours de définition :</p><ul><li><p><code>EQ</code> : contrainte d'équilibrage d'égalité (\(=\))</p></li>
<li><p><code>LE</code> : contrainte d'équilibrage d'inégalité de type inférieure ou égale (\(\le\))</p></li>
<li><p><code>GE</code> : contrainte d'équilibrage d'inégalité de type supérieure ou égale (\(\ge\))</p></li>
<li><p><code>lowerBd</code> : borne inférieure des valeurs de période</p></li>
<li><p><code>upperBd</code> : borne supérieure des valeurs de période</p></li>
<li><p><code>alter</code> : coefficient d'altérabilité des valeurs de période</p></li>
<li><p><code>alterTmp</code> : coefficient d'altérabilité des totaux temporels</p></li>
</ul></li>
<li><p><code>row</code> (car) : étiquette à associer à l'élément du problème (<em>mot-clé <code>type</code></em>)</p></li>
<li><p><em>toutes les autres variables ne sont pas pertinentes et devraient contenir des données manquantes (valeurs <code>NA</code>)</em> <br><br></p></li>
</ul></li>
<li><p><strong>Enregistrements de spécification d'information</strong> (<code>type</code> est manquant (est <code>NA</code>))</p><ul><li><p><code>type</code> (car) : non applicable (<code>NA</code>)</p></li>
<li><p><code>col</code> (car) : nom de la série ou mot réservé <code>_rhs_</code> pour spécifier la valeur du côté droit (<em>RHS</em> pour
<em><strong>R</strong>ight-<strong>H</strong>and <strong>S</strong>ide</em>)
d'une contrainte d'équilibrage.</p></li>
<li><p><code>row</code> (car) : étiquette de l'élément du problème.</p></li>
<li><p><code>coef</code> (num) : valeur de l'élément du problème :</p><ul><li><p>coefficient de la série dans la contrainte d'équilibrage ou valeur <em>RHS</em></p></li>
<li><p>borne inférieure ou supérieure des valeurs de période de la série</p></li>
<li><p>coefficient d'altérabilité des valeurs de période ou des totaux temporels de la série</p></li>
</ul></li>
<li><p><code>timeVal</code> (num) : valeur de temps optionnelle pour restreindre l'application des bornes ou coefficients
d'altérabilité des séries à une période (ou groupe temporel) spécifique. Elle correspond à la valeur de temps,
telle que renvoyée par <code><a href="https://rdrr.io/r/stats/time.html" class="external-link">stats::time()</a></code>, pour une période (observation) donnée des séries chronologiques d'entrée
(argument <code>in_ts</code>) et correspond conceptuellement à \(ann\acute{e}e + (p\acute{e}riode - 1) / fr\acute{e}quence\).</p></li>
</ul></li>
</ul><p>Notez que les chaînes de caractères vides (<code>""</code> ou <code>''</code>) pour les variables de type caractère sont interprétées comme
manquantes (<code>NA</code>) par la fonction. La variable <code>row</code> identifie les éléments du problème d'équilibrage et est la variable
clé qui fait le lien entre les deux types d'enregistrements. La même étiquette (<code>row</code>) ne peut être associée à plus d'un
type d'éléments du problème (<code>type</code>) et plusieurs étiquettes (<code>row</code>) ne peuvent pas être définies pour un même type
d'éléments du problème donné (<code>type</code>), à l'exception des contraintes d'équilibrage (valeurs <code>"EQ"</code>, <code>"LE"</code> et <code>"GE"</code> de
la colonne <code>type</code>). Voici certaines caractéristiques conviviales du <em>data frame</em> des spécifications du problème :</p><ul><li><p>L'ordre des enregistrements (rangées) n'est pas important.</p></li>
<li><p>Les valeurs des variables de type caractère (<code>type</code>, <code>row</code> et <code>col</code>) ne sont pas sensibles à la casse (ex., les chaînes de
caractères <code>"Constraint 1"</code> et <code>"CONSTRAINT 1"</code> pour la variable <code>row</code> seraient considérées comme une même étiquette d'élément
du problème), sauf lorsque <code>col</code> est utilisé pour spécifier un nom de série (une colonne de l'objet d'entrée de type série
chronologique) où <strong>la sensibilité à la casse est appliquée</strong>.</p></li>
<li><p>Les noms des variables du <em>data frame</em> des spécifications du problème ne sont pas non plus sensibles à la casse (ex.,
<code>type</code>, <code>Type</code> ou <code>TYPE</code> sont tous des noms de variable valides) et <code>time_val</code> est un nom de variable accepté (au lieu de
<code>timeVal</code>).</p></li>
</ul><p>Enfin, le tableau suivant dresse la liste des alias valides (acceptés) pour les <em>mots-clés <code>type</code></em>
(type d'éléments du problème) :</p><table class="table table"><tr><td><strong>Mot-clé</strong></td><td><strong>Alias</strong></td></tr><tr><td><code>EQ</code></td><td><code>==</code>, <code>=</code></td></tr><tr><td><code>LE</code></td><td><code>&lt;=</code>, <code>&lt;</code></td></tr><tr><td><code>GE</code></td><td><code>&gt;=</code>, <code>&gt;</code></td></tr><tr><td><code>lowerBd</code></td><td><code>lowerBound</code>, <code>lowerBnd</code>, + <em>mêmes termes avec '_', '.' ou ' ' entre les mots</em></td></tr><tr><td><code>upperBd</code></td><td><code>upperBound</code>, <code>upperBnd</code>, + <em>mêmes termes avec '_', '.' ou ' ' entre les mots</em></td></tr><tr><td><code>alterTmp</code></td><td><code>alterTemporal</code>, <code>alterTemp</code>, + <em>mêmes termes avec '_', '.' ou ' ' entre les mots</em></td></tr></table><p>L'examen des <strong>Exemples</strong> devrait aider à conceptualiser le <em>data frame</em> des spécifications du problème d'équilibrage.</p></dd>


<dt id="arg-in-ts-name">in_ts_name<a class="anchor" aria-label="anchor" href="#arg-in-ts-name"></a></dt>
<dd><p>(optional)</p>
<p>Chaîne de caractères contenant la valeur de l'argument <code>in_ts</code>.</p>
<p><strong>La valeur par défaut</strong> est <code>in_ts_name = deparse1(substitute(in_ts))</code>.</p></dd>


<dt id="arg-ts-freq">ts_freq<a class="anchor" aria-label="anchor" href="#arg-ts-freq"></a></dt>
<dd><p>(optional)</p>
<p>Fréquence de l'object the type série chronologique (argument <code>in_ts</code>).</p>
<p><strong>La valeur par défaut</strong> est <code>ts_freq = stats::frequency(in_ts)</code>.</p></dd>


<dt id="arg-periods">periods<a class="anchor" aria-label="anchor" href="#arg-periods"></a></dt>
<dd><p>(optional)</p>
<p>Vecteur de chaînes de caractères décrivant les périodes de l'object the type série chronologique (argument <code>in_ts</code>).</p>
<p><strong>La valeur par défaut</strong> est <code>periods = gs.time2str(in_ts)</code>.</p></dd>


<dt id="arg-n-per">n_per<a class="anchor" aria-label="anchor" href="#arg-n-per"></a></dt>
<dd><p>(optional)</p>
<p>Nombre de périodes de l'object the type série chronologique (argument <code>in_ts</code>).</p>
<p><strong>La valeur par défaut</strong> est <code>n_per = nrow(as.matrix(in_ts))</code>.</p></dd>


<dt id="arg-specs-df-name">specs_df_name<a class="anchor" aria-label="anchor" href="#arg-specs-df-name"></a></dt>
<dd><p>(optional)</p>
<p>Chaîne de caractères contenant la valeur de l'argument <code>problem_specs_df</code>.</p>
<p><strong>La valeur par défaut</strong> est <code>specs_df_name = deparse1(substitute(problem_specs_df))</code>.</p></dd>


<dt id="arg-temporal-grp-periodicity">temporal_grp_periodicity<a class="anchor" aria-label="anchor" href="#arg-temporal-grp-periodicity"></a></dt>
<dd><p>(optionnel)</p>
<p>Nombre entier positif définissant le nombre de périodes dans les groupes temporels pour lesquels les totaux doivent
être préservés. Par exemple, spécifiez <code>temporal_grp_periodicity = 3</code> avec des séries chronologiques mensuelles pour la
préservation des totaux trimestriels et <code>temporal_grp_periodicity = 12</code> (ou <code>temporal_grp_periodicity = frequency(in_ts)</code>)
pour la préservation des totaux annuels. Spécifier <code>temporal_grp_periodicity = 1</code> (<em>défaut</em>) correspond à un traitement
période par période sans préservation des totaux temporels.</p>
<p><strong>La valeur par défaut</strong> est <code>temporal_grp_periodicity = 1</code> (traitement période par période sans préservation des
totaux temporels).</p></dd>


<dt id="arg-alter-pos">alter_pos<a class="anchor" aria-label="anchor" href="#arg-alter-pos"></a></dt>
<dd><p>(optionnel)</p>
<p>Nombre réel non négatif spécifiant le coefficient d'altérabilité par défaut associé aux valeurs des séries chronologiques
avec des coefficients <strong>positifs</strong> dans toutes les contraintes d'équilibrage dans lesquelles elles sont impliquées (ex.,
les séries composantes dans les problèmes de ratissage (« <em>raking</em> ») de tables d'agrégation). Les coefficients
d'altérabilité fournis dans le <em>data frame</em> des spécifications du problème (argument <code>problem_specs_df</code>) remplacent cette
valeur.</p>
<p><strong>La valeur par défaut</strong> est <code>alter_pos = 1.0</code> (valeurs non contraignantes).</p></dd>


<dt id="arg-alter-neg">alter_neg<a class="anchor" aria-label="anchor" href="#arg-alter-neg"></a></dt>
<dd><p>(optionnel)</p>
<p>Nombre réel non négatif spécifiant le coefficient d'altérabilité par défaut associé aux valeurs des séries chronologiques
avec des coefficients <strong>négatifs</strong> dans toutes les contraintes d'équilibrage dans lesquelles elles sont impliquées (ex.,
les séries de total de marge dans les problèmes de ratissage (« <em>raking</em> ») de tables d'agrégation). Les coefficients
d'altérabilité fournis dans le <em>data frame</em> des spécifications du problème (argument <code>problem_specs_df</code>) remplacent cette
valeur.</p>
<p><strong>La valeur par défaut</strong> est <code>alter_neg = 1.0</code> (valeurs non contraignantes).</p></dd>


<dt id="arg-alter-mix">alter_mix<a class="anchor" aria-label="anchor" href="#arg-alter-mix"></a></dt>
<dd><p>(optionnel)</p>
<p>Nombre réel non négatif spécifiant le coefficient d'altérabilité par défaut associé aux valeurs des séries chronologiques
avec un mélange de coefficients <strong>positifs et négatifs</strong> dans les contraintes d'équilibrage dans lesquelles elles sont
impliquées. Les coefficients d'altérabilité fournis dans le <em>data frame</em> des spécifications du problème (argument
<code>problem_specs_df</code>) remplacent cette valeur.</p>
<p><strong>La valeur par défaut</strong> est <code>alter_mix = 1.0</code> (valeurs non contraignantes).</p></dd>


<dt id="arg-lower-bound">lower_bound<a class="anchor" aria-label="anchor" href="#arg-lower-bound"></a></dt>
<dd><p>(optionnel)</p>
<p>Nombre réel spécifiant la borne inférieure par défaut pour les valeurs des séries chronologiques. Les bornes inférieures
fournies dans le <em>data frame</em> des spécifications du problème (argument <code>problem_specs_df</code>) remplacent cette valeur.</p>
<p><strong>La valeur par défaut</strong> est <code>lower_bound = -Inf</code> (non borné).</p></dd>


<dt id="arg-upper-bound">upper_bound<a class="anchor" aria-label="anchor" href="#arg-upper-bound"></a></dt>
<dd><p>(optionnel)</p>
<p>Nombre réel spécifiant la borne supérieure par défaut pour les valeurs des séries chronologiques. Les bornes supérieures
fournies dans le <em>data frame</em> des spécifications du problème (argument <code>problem_specs_df</code>) remplacent cette valeur.</p>
<p><strong>La valeur par défaut</strong> est <code>upper_bound = Inf</code> (non borné).</p></dd>


<dt id="arg-validation-only">validation_only<a class="anchor" aria-label="anchor" href="#arg-validation-only"></a></dt>
<dd><p>(optionnel)</p>
<p>Argument logique (<em>logical</em>) spécifiant si la fonction doit uniquement effectuer la validation des données d'entrée ou
non. Lorsque <code>validation_only = TRUE</code>, les <em>contraintes d'équilibrage</em> et les <em>bornes (inférieures et supérieures) des
valeurs de période</em> spécifiées sont validées par rapport aux données de séries chronologiques d'entrée, en permettant
des écarts jusqu'à la valeur spécifiée avec l'argument <code>validation_tol</code>. Sinon, lorsque <code>validation_only = FALSE</code>
(par défaut), les données d'entrée sont d'abord réconciliées et les données résultantes (en sortie) sont ensuite
validées.</p>
<p><strong>La valeur par défaut</strong> est <code>validation_only = FALSE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="valeur-de-retour">Valeur de retour<a class="anchor" aria-label="anchor" href="#valeur-de-retour"></a></h2>
    <p>Une liste avec les éléments des problèmes d'équilibrage (excluant l'information sur les totaux temporels) :</p><ul><li><p><code>labels_df</code> : version nettoyée des <em>enregistrements de définition d'étiquette</em> provenant de <code>problem_specs_df</code>
(enregistrements où <code>type</code> n'est pas manquant (n'est pas <code>NA</code>)); colonnes supplémentaires :</p><ul><li><p><code>type.lc</code>  : <code>tolower(type)</code></p></li>
<li><p><code>row.lc</code>   : <code>tolower(row)</code></p></li>
<li><p><code>con.flag</code> : <code>type.lc %in% c("eq", "le", "ge")</code></p></li>
</ul></li>
<li><p><code>coefs_df</code>  : version nettoyée des <em>enregistrements de spécification d'information</em> provenant de <code>problem_specs_df</code>
(enregistrements où <code>type</code> est manquant (est <code>NA</code>)); colonnes supplémentaires :</p><ul><li><p><code>row.lc</code>   : <code>tolower(row)</code></p></li>
<li><p><code>con.flag</code> : <code>labels_df$con.flag</code> attribuée à travers <code>row.lc</code></p></li>
</ul></li>
<li><p><code>values_ts</code>: version réduite de <code>in_ts</code> avec seulement les séries pertinentes (voir vecteur <code>ser_names</code>)</p></li>
<li><p><code>lb</code>        : information sur les bornes inférieures (<code>type.lc  = "lowerbd"</code>) des séries pertinentes; liste avec
les éléments suivants :</p><ul><li><p><code>coefs_ts</code>        : object « mts » contenant les bornes inférieures des séries pertientes (voir vecteur <code>ser_names</code>)</p></li>
<li><p><code>nondated_coefs</code>  : vecteur des bornes non datées de <code>problem_specs_df</code> (<code>timeVal</code> est <code>NA</code>)</p></li>
<li><p><code>nondated_id_vec</code> : vecteur d'identificateurs de <code>ser_names</code> associés au vecteur <code>nondated_coefs</code></p></li>
<li><p><code>dated_id_vec</code>    : vecteur d'identificateurs de <code>ser_names</code> associés aux bornes inférieures datées de
<code>problem_specs_df</code> (<code>timeVal</code> n'est pas <code>NA</code>)</p></li>
</ul></li>
<li><p><code>ub</code>        : équivalent de <code>lb</code> pour les bornes supérieures (<code>type.lc = "upperbd"</code>)</p></li>
<li><p><code>alter</code>     : équivalent de <code>lb</code> pour les coefficients d'altérabilité des valeurs de période (<code>type.lc = "alter"</code>)</p></li>
<li><p><code>altertmp</code>  : équivalent de <code>lb</code> pour les coefficients d'altérabilité des totaux temporels (<code>type.lc = "altertmp"</code>)</p></li>
<li><p><code>ser_names</code> : vecteur des noms de séries pertinentes (ensemble de séries impliquées dans les contraintes d'équilibrage)</p></li>
<li><p><code>pos_ser</code>   : vecteur des noms de séries qui n'ont que des coefficients non nuls positifs à travers toutes les contraintes</p></li>
<li><p><code>neg_ser</code>   : vecteur des noms de séries qui n'ont que des coefficients non nuls négatifs à travers toutes les contraintes</p></li>
<li><p><code>mix_ser</code>   : vecteur des noms de séries qui ont des coefficients non nuls positifs et négatifs à travers toutes les
contraintes</p></li>
<li><p><code>A1</code>,<code>op1</code>,<code>b1</code> : éléments des contraintes d'équilibrage pour les problèmes impliquant une seule période (ex., chacune des
périodes d'un groupe temporel incomplet)</p></li>
<li><p><code>A2</code>,<code>op2</code>,<code>b2</code> : éléments des contraintes d'équilibrage pour les problèmes impliquant <code>temporal_grp_periodicity</code> périodes
(ex., l'ensemble des périodes d'un groupe temporel complet)</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="d-tails">Détails<a class="anchor" aria-label="anchor" href="#d-tails"></a></h2>
    <p>Voir <code><a href="tsbalancing.html">tsbalancing()</a></code> pour une description détaillée des problèmes d'<em>équilibrage de séries chronologiques</em>.</p>
<p>Toute valeur manquante (<code>NA</code>) trouvée dans l'objet de série chronologique d'entrée (argument <code>in_ts</code>) serait remplacée par 0
dans <code>values_ts</code> et déclencherait un message d'avertissement.</p>
<p>Les éléments renvoyés des des problèmes d'équilibrage n'incluent pas les totaux temporels implicites (c.-à-d., les éléments
<code>A2</code>, <code>op2</code> et <code>b2</code> ne contiennent que les contraintes d'équilibrage).</p>
<p>Les éléments <code>A2</code>, <code>op2</code> et <code>b2</code> d'un problème d'équilibrage impliquant plusieurs périodes (lorsque
<code>temporal_grp_periodicity &gt; 1</code>) sont construits <em>colonne par colonne</em> (selon le principe « column-major order » en anglais),
ce qui correspond au comportement par défaut de R lors de la conversion d'objets de la classe « matrix » en vecteurs.
Autrement dit, les contraintes d'équilibrage correspondent conceptuellement à :</p><ul><li><p><code>A1 %*% values_ts[t, ] op1 b1</code> pour des problèmes impliquant une seule période (<code>t</code>)</p></li>
<li><p><code>A2 %*% as.vector(values_ts[t1:t2, ]) op2 b2</code> pour des problèmes impliquant <code>temporal_grp_periodicity</code> périodes (<code>t1:t2</code>)</p></li>
</ul><p>Notez que l'argument <code>alter_temporal</code> n'a pas encore été appliqué à ce stade et que <code>altertmp$coefs_ts</code> ne contient que les
coefficients spécifiés dans le <em>data frame</em> des spécifications du problème (argument <code>problem_specs_df</code>). Autrement dit,
<code>altertmp$coefs_ts</code> contient des valeurs manquantes (<code>NA</code>) à l'exception des coefficients d'altérabilité de total temporel
inclus dans (spécifiés avec) <code>problem_specs_df</code>. Ceci est fait afin de faciliter l'identification du premier coefficient
d'altérabilité non manquant (non <code>NA</code>) de chaque groupe temporel complet (à survenir ultérieurement, le cas échéant, dans
<code><a href="tsbalancing.html">tsbalancing()</a></code>).</p>
    </div>
    <div class="section level2">
    <h2 id="voir-galement">Voir également<a class="anchor" aria-label="anchor" href="#voir-galement"></a></h2>
    <div class="dont-index"><p><code><a href="tsbalancing.html">tsbalancing()</a></code> <code><a href="build_raking_problem.html">build_raking_problem()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Exemples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">######################################################################################</span></span></span>
<span class="r-in"><span><span class="co">#  Cadre de dérivation des séries indirectes avec les métadonnées de `tsbalancing()`</span></span></span>
<span class="r-in"><span><span class="co">######################################################################################</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># Il est supposé (convenu) que...</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># a) Toutes les contraintes d'équilibrage sont des contraintes d'égalité (`type = EQ`).</span></span></span>
<span class="r-in"><span><span class="co"># b) Toutes les contraintes n'ont qu'une seule série non contraignante (libre) : la </span></span></span>
<span class="r-in"><span><span class="co">#    série à dériver (c.-à-d., toutes les séries ont un coef. d'alt. de 0 sauf la </span></span></span>
<span class="r-in"><span><span class="co">#    série à dériver).</span></span></span>
<span class="r-in"><span><span class="co"># c) Chaque contrainte dérive une série différente (une nouvelle série).</span></span></span>
<span class="r-in"><span><span class="co"># d) Les contraintes sont les mêmes pour toutes les périodes (c.-à-d., il n'y a pas </span></span></span>
<span class="r-in"><span><span class="co">#    de coef. d'alt. « datés » spécifiés à l'aide de la colonne `timeVal`).</span></span></span>
<span class="r-in"><span><span class="co">######################################################################################</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Dériver les totaux de marge d'un cube de données à deux dimensions (2 x 3) en </span></span></span>
<span class="r-in"><span><span class="co"># utilisant les métadonnées de `tsbalancing()` (les contraintes d'agrégation d'un </span></span></span>
<span class="r-in"><span><span class="co"># cube de données respectent les hypothèses ci-dessus).</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Construire les spécifications du problème d'équilibrage à travers les métadonnées </span></span></span>
<span class="r-in"><span><span class="co"># (plus simples) de ratissage.</span></span></span>
<span class="r-in"><span><span class="va">mes_specs</span> <span class="op">&lt;-</span> <span class="fu"><a href="rkMeta_to_blSpecs.html">rkMeta_to_blSpecs</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>series <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A1"</span>, <span class="st">"A2"</span>, <span class="st">"A3"</span>,</span></span>
<span class="r-in"><span>                        <span class="st">"B1"</span>, <span class="st">"B2"</span>, <span class="st">"B3"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             total1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"totA"</span>, <span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                        <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"totB"</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             total2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tot1"</span>, <span class="st">"tot2"</span>, <span class="st">"tot3"</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  alterSeries <span class="op">=</span> <span class="fl">0</span>,  <span class="co"># séries composantes contraignantes (fixes)</span></span></span>
<span class="r-in"><span>  alterTotal1 <span class="op">=</span> <span class="fl">1</span>,  <span class="co"># totaux de marge non contraignants (libres, à dériver)</span></span></span>
<span class="r-in"><span>  alterTotal2 <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>  <span class="co"># totaux de marge non contraignants (libres, à dériver)</span></span></span>
<span class="r-in"><span><span class="va">mes_specs</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     type  col                       row coef timeVal</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     EQ &lt;NA&gt;   Marginal Total 1 (totA)   NA      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   &lt;NA&gt;   A1   Marginal Total 1 (totA)    1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3   &lt;NA&gt;   A2   Marginal Total 1 (totA)    1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4   &lt;NA&gt;   A3   Marginal Total 1 (totA)    1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   &lt;NA&gt; totA   Marginal Total 1 (totA)   -1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6     EQ &lt;NA&gt;   Marginal Total 2 (totB)   NA      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7   &lt;NA&gt;   B1   Marginal Total 2 (totB)    1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8   &lt;NA&gt;   B2   Marginal Total 2 (totB)    1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9   &lt;NA&gt;   B3   Marginal Total 2 (totB)    1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10  &lt;NA&gt; totB   Marginal Total 2 (totB)   -1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11    EQ &lt;NA&gt;   Marginal Total 3 (tot1)   NA      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12  &lt;NA&gt;   A1   Marginal Total 3 (tot1)    1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13  &lt;NA&gt;   B1   Marginal Total 3 (tot1)    1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14  &lt;NA&gt; tot1   Marginal Total 3 (tot1)   -1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15    EQ &lt;NA&gt;   Marginal Total 4 (tot2)   NA      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16  &lt;NA&gt;   A2   Marginal Total 4 (tot2)    1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17  &lt;NA&gt;   B2   Marginal Total 4 (tot2)    1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18  &lt;NA&gt; tot2   Marginal Total 4 (tot2)   -1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19    EQ &lt;NA&gt;   Marginal Total 5 (tot3)   NA      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20  &lt;NA&gt;   A3   Marginal Total 5 (tot3)    1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21  &lt;NA&gt;   B3   Marginal Total 5 (tot3)    1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22  &lt;NA&gt; tot3   Marginal Total 5 (tot3)   -1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23 alter &lt;NA&gt; Period Value Alterability   NA      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24  &lt;NA&gt;   A1 Period Value Alterability    0      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25  &lt;NA&gt;   A2 Period Value Alterability    0      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26  &lt;NA&gt;   A3 Period Value Alterability    0      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 27  &lt;NA&gt;   B1 Period Value Alterability    0      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28  &lt;NA&gt;   B2 Period Value Alterability    0      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 29  &lt;NA&gt;   B3 Period Value Alterability    0      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 30  &lt;NA&gt; totA Period Value Alterability    1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 31  &lt;NA&gt; totB Period Value Alterability    1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 32  &lt;NA&gt; tot1 Period Value Alterability    1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 33  &lt;NA&gt; tot2 Period Value Alterability    1      NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 34  &lt;NA&gt; tot3 Period Value Alterability    1      NA</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 6 périodes (trimestres) de données avec totaux de marge initialisés à zéro (0): ces </span></span></span>
<span class="r-in"><span><span class="co"># derniers doivent OBLIGATOIREMENT exister dans les données d'entrée ET contenir des </span></span></span>
<span class="r-in"><span><span class="co"># données valides (non `NA`).</span></span></span>
<span class="r-in"><span><span class="va">mes_series</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ts.html" class="external-link">ts</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>A1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">10</span>, <span class="fl">12</span>,  <span class="fl">9</span>, <span class="fl">15</span>,  <span class="fl">7</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                            B1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">21</span>, <span class="fl">15</span>, <span class="fl">17</span>, <span class="fl">19</span>, <span class="fl">18</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                            A2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">14</span>,  <span class="fl">9</span>,  <span class="fl">8</span>,  <span class="fl">9</span>, <span class="fl">11</span>, <span class="fl">10</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                            B2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">29</span>, <span class="fl">20</span>, <span class="fl">24</span>, <span class="fl">21</span>, <span class="fl">17</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                            A3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">13</span>, <span class="fl">15</span>, <span class="fl">17</span>, <span class="fl">14</span>, <span class="fl">16</span>, <span class="fl">12</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                            B3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">24</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">23</span>, <span class="fl">21</span>, <span class="fl">19</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                            tot1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                            tot2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                            tot3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                            totA <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                            totB <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 start <span class="op">=</span> <span class="fl">2019</span>, frequency <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Obtenir les éléments du problème d'équilibrage.</span></span></span>
<span class="r-in"><span><span class="va">n_per</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mes_series</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">build_balancing_problem</span><span class="op">(</span><span class="va">mes_series</span>, <span class="va">mes_specs</span>, </span></span>
<span class="r-in"><span>                             temporal_grp_periodicity <span class="op">=</span> <span class="va">n_per</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># `A2`, `op2` et `b2` définissent 30 constraintes (5 totaux de marge X 6 périodes) </span></span></span>
<span class="r-in"><span><span class="co"># impliquant un total de 66 points de données (11 séries X 6 périodes) desquels 36 </span></span></span>
<span class="r-in"><span><span class="co"># réfèrent aux 6 séries composantes et 30 réfèrent aux 5 totaux de marge.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="va">A2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 30 66</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Obtenir les noms des totaux de marge (séries avec un coef. d'alt. non nul), dans </span></span></span>
<span class="r-in"><span><span class="co"># l'ordre où les contraintes correspondantes apparaissent dans les spécifications </span></span></span>
<span class="r-in"><span><span class="co"># (ordre de spécification des constraintes).</span></span></span>
<span class="r-in"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">$</span><span class="va">coefs_df</span><span class="op">$</span><span class="va">col</span><span class="op">[</span><span class="va">p</span><span class="op">$</span><span class="va">coefs_df</span><span class="op">$</span><span class="va">con.flag</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">noms_tot</span> <span class="op">&lt;-</span> <span class="va">tmp</span><span class="op">[</span><span class="va">tmp</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">p</span><span class="op">$</span><span class="va">ser_names</span><span class="op">[</span><span class="va">p</span><span class="op">$</span><span class="va">alter</span><span class="op">$</span><span class="va">nondated_id_vec</span><span class="op">[</span><span class="va">p</span><span class="op">$</span><span class="va">alter</span><span class="op">$</span><span class="va">nondated_coefs</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">]</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Définir des drapeaux logiques identifiant les colonnes de total de marge :</span></span></span>
<span class="r-in"><span><span class="co"># - `col_tot_logi1` : éléments à période unique (de longueur 11 = nombre de séries)</span></span></span>
<span class="r-in"><span><span class="co"># - `col_tot_logi2` : éléments multi-périodes (de longueur 66 = nombre de points de</span></span></span>
<span class="r-in"><span><span class="co">#                     données), selon le principe « column-major order » en anglais </span></span></span>
<span class="r-in"><span><span class="co">#                     (l'ordre de construction des éléments de la matrice `A2`)</span></span></span>
<span class="r-in"><span><span class="va">col_tot_logi1</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">$</span><span class="va">ser_names</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">noms_tot</span></span></span>
<span class="r-in"><span><span class="va">col_tot_logi2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">col_tot_logi1</span>, each <span class="op">=</span> <span class="va">n_per</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Ordre des totaux de marge à dériver selon</span></span></span>
<span class="r-in"><span><span class="co"># ... les colonnes des données d'entrée (objet « mts » `mes_series`)</span></span></span>
<span class="r-in"><span><span class="va">p</span><span class="op">$</span><span class="va">ser_names</span><span class="op">[</span><span class="va">col_tot_logi1</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "tot1" "tot2" "tot3" "totA" "totB"</span>
<span class="r-in"><span><span class="co"># ... la spécification des contraintes (« data frame » `mes_specs`)</span></span></span>
<span class="r-in"><span><span class="va">noms_tot</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "totA" "totB" "tot1" "tot2" "tot3"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculer les 5 totaux de marge pour les 6 périodes.</span></span></span>
<span class="r-in"><span><span class="co"># Note : le calcul suivant prend en compte les contraintes d'égalité linéaires </span></span></span>
<span class="r-in"><span><span class="co">#        générales, c.-à-d.,</span></span></span>
<span class="r-in"><span><span class="co">#        a) des valeurs non nulles du côté droit des contraintes (`b2`) et </span></span></span>
<span class="r-in"><span><span class="co">#        b) des coefficients de contrainte non nuls autres que 1 pour les séries </span></span></span>
<span class="r-in"><span><span class="co">#           composantes et -1 pour la série à dériver. </span></span></span>
<span class="r-in"><span><span class="va">mes_series</span><span class="op">[</span>, <span class="va">noms_tot</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="co"># Côté droit des contraintes</span></span></span>
<span class="r-in"><span>    <span class="va">p</span><span class="op">$</span><span class="va">b2</span> <span class="op">-</span> </span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co"># Sommes des composantes (« pondérées » par les coefficients des contraintes)</span></span></span>
<span class="r-in"><span>    <span class="va">p</span><span class="op">$</span><span class="va">A2</span><span class="op">[</span>, <span class="op">!</span><span class="va">col_tot_logi2</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="va">values_ts</span><span class="op">[</span>, <span class="op">!</span><span class="va">col_tot_logi1</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span> <span class="op">/</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Coefficients des séries dérivées : `t()` permet une recherche « par ligne » dans </span></span></span>
<span class="r-in"><span>  <span class="co"># la matrice `A2` (c.-à-d., selon l'ordre de spécification des constraintes)</span></span></span>
<span class="r-in"><span>  <span class="co"># Note: `diag(p$A2[, tot_col_logi2])` fonctionnerait si `p$ser_names[col_tot_logi1]` </span></span></span>
<span class="r-in"><span>  <span class="co">#       et `noms_tot` étaient identiques (même ordre pour les totaux); par contre, </span></span></span>
<span class="r-in"><span>  <span class="co">#       la recherche « par ligne » ci-dessous fonctionnera toujours (et est </span></span></span>
<span class="r-in"><span>  <span class="co">#       nécessaire dans le cas qui nous concerne).</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="va">A2</span><span class="op">[</span>, <span class="va">col_tot_logi2</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="va">A2</span><span class="op">[</span>, <span class="va">col_tot_logi2</span><span class="op">]</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">mes_series</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         A1 B1 A2 B2 A3 B3 tot1 tot2 tot3 totA totB</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2019 Q1 12 20 14 20 13 24   32   34   37   39   64</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2019 Q2 10 21  9 29 15 20   31   38   35   34   70</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2019 Q3 12 15  8 20 17 30   27   28   47   37   65</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2019 Q4  9 17  9 24 14 23   26   33   37   32   64</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q1 15 19 11 21 16 21   34   32   37   42   61</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q2  7 18 10 17 12 19   25   27   31   29   54</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table des matières"><h2>Sur cette page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Développé par Michel Ferland, Statistics Canada.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site créé avec <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

