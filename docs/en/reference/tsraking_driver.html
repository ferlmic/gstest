<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Helper function for tsraking() — tsraking_driver • gstest</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Helper function for tsraking() — tsraking_driver"><meta name="description" content="
Helper function for the tsraking() function that conveniently determines the required set of raking
problems to be solved and internally generates the individual calls to tsraking(). It is especially
useful in the context of temporal total (e.g., annual total) preservation where each individual raking
problem either involves a single period for incomplete temporal groups (e.g., incomplete years) or several
periods for complete temporal groups (e.g., the set of periods of a complete year)."><meta property="og:description" content="
Helper function for the tsraking() function that conveniently determines the required set of raking
problems to be solved and internally generates the individual calls to tsraking(). It is especially
useful in the context of temporal total (e.g., annual total) preservation where each individual raking
problem either involves a single period for incomplete temporal groups (e.g., incomplete years) or several
periods for complete temporal groups (e.g., the set of periods of a complete year)."><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gstest</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">3.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/gstest.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/benchmarking-cookbook.html">Benchmarking CookBook</a></li>
    <li><a class="dropdown-item" href="../articles/benchmarking-demo-script.html">A Beginner's Benchmarking Demo Script</a></li>
    <li><a class="dropdown-item" href="../articles/osqp-settings-sequence-dataframe.html">OSQP Settings Sequence Data Frame</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news"><li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ferlmic/gstest/tree/main/">G-Series 3.0 (latest - R package gstest 3.0.0)</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ferlmic/gstest/releases/tag/v2.0/">G-Series 2.0 (SAS® version)</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/ferlmic/gstest/releases/tag/v1.04/">G-Series 1.04 (SAS® version)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ferlmic/gstest/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>

    <ul class="navbar-nav"><li class="nav-item"><a class="nav-link" href="#" onclick="window.location = location.href.replace('/en/','/fr/');"><span class="fa fa-language fa-lg"></span> Français</a></li></ul></div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Helper function for <code><a href="tsraking.html">tsraking()</a></code></h1>
      <small class="dont-index">Source: <a href="https://github.com/ferlmic/gstest/tree/main/R/tsraking_driver.R" class="external-link"><code>R/tsraking_driver.R</code></a></small>
      <div class="d-none name"><code>tsraking_driver.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p></p>
<p>Helper function for the <code><a href="tsraking.html">tsraking()</a></code> function that conveniently determines the required set of raking
problems to be solved and internally generates the individual calls to <code><a href="tsraking.html">tsraking()</a></code>. It is especially
useful in the context of temporal total (e.g., annual total) preservation where each individual raking
problem either involves a single period for incomplete temporal groups (e.g., incomplete years) or several
periods for complete temporal groups (e.g., the set of periods of a complete year).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">tsraking_driver</span><span class="op">(</span></span>
<span>  <span class="va">in_ts</span>,</span>
<span>  <span class="va">...</span>,  <span class="co"># `tsraking()` arguments excluding `data_df`</span></span>
<span>  temporal_grp_periodicity <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  temporal_grp_start <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-in-ts">in_ts<a class="anchor" aria-label="anchor" href="#arg-in-ts"></a></dt>
<dd><p>(mandatory)</p>
<p>Time series ("ts" or "mts"), or object to be coerced to one, that contains the time series data to be
reconciled. They are the raking problems' input data (initial solutions).</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Arguments passed on to <code><a href="tsraking.html">tsraking</a></code></p><dl><dt><code>metadata_df</code></dt>
<dd><p>(mandatory)</p>
<p>Data frame, or object to be coerced to one, that describes the cross-sectional aggregation constraints
(additivity rules) for the raking problem. Two character variables must be included in the metadata data frame:
<code>series</code> and <code>total1</code>. Two variables are optional: <code>total2</code> (character) and <code>alterAnnual</code> (numeric). The values
of variable <code>series</code> represent the variable names of the component series in the input time series data frame
(argument <code>data_df</code>). Similarly, the values of variables <code>total1</code> and <code>total2</code> represent the variable names of
the 1<sup>st</sup> and 2<sup>nd</sup> dimension cross-sectional control totals in the input time series data
frame. Variable <code>alterAnnual</code> contains the alterability coefficient for the temporal constraint associated to
each component series. When specified, the latter will override the default alterability coefficient specified
with argument <code>alterAnnual</code>.</p></dd>

    <dt><code>alterability_df</code></dt>
<dd><p>(optional)</p>
<p>Data frame, or object to be coerced to one, or <code>NULL</code>, that contains the alterability coefficients variables.
They must correspond to a component series or a cross-sectional control total, that is, a variable with the same
name must exist in the input time series data frame (argument <code>data_df</code>). The values of these alterability
coefficients will override the default alterability coefficients specified with arguments <code>alterSeries</code>,
<code>alterTotal1</code> and <code>alterTotal2</code>. When the input time series data frame contains several observations and the
alterability coefficients data frame contains only one, the alterability coefficients are used (repeated) for
all observations of the input time series data frame. Alternatively, the alterability coefficients data frame
may contain as many observations as the input time series data frame.</p>
<p><strong>Default value</strong> is <code>alterability_df = NULL</code> (default alterability coefficients).</p></dd>

    <dt><code>alterSeries</code></dt>
<dd><p>(optional)</p>
<p>Nonnegative real number specifying the default alterability coefficient for the component series values. It
will apply to component series for which alterability coefficients have not already been specified in the
alterability coefficients data frame (argument <code>alterability_df</code>).</p>
<p><strong>Default value</strong> is <code>alterSeries = 1.0</code> (nonbinding component series values).</p></dd>

    <dt><code>alterTotal1</code></dt>
<dd><p>(optional)</p>
<p>Nonnegative real number specifying the default alterability coefficient for the 1<sup>st</sup> dimension
cross-sectional control totals. It will apply to cross-sectional control totals for which alterability
coefficients have not already been specified in the alterability coefficients data frame (argument
<code>alterability_df</code>).</p>
<p><strong>Default value</strong> is <code>alterTotal1 = 0.0</code> (binding 1<sup>st</sup> dimension cross-sectional control totals)</p></dd>

    <dt><code>alterTotal2</code></dt>
<dd><p>(optional)</p>
<p>Nonnegative real number specifying the default alterability coefficient for the 2<sup>nd</sup> dimension
cross-sectional control totals. It will apply to cross-sectional control totals for which alterability
coefficients have not already been specified in the alterability coefficients data frame (argument
<code>alterability_df</code>).</p>
<p><strong>Default value</strong> is <code>alterTotal2 = 0.0</code> (binding 2<sup>nd</sup> dimension cross-sectional control totals).</p></dd>

    <dt><code>alterAnnual</code></dt>
<dd><p>(optional)</p>
<p>Nonnegative real number specifying the default alterability coefficient for the component series temporal
constraints (e.g., annual totals). It will apply to component series for which alterability coefficients
have not already been specified in the metadata data frame (argument <code>metadata_df</code>).</p>
<p><strong>Default value</strong> is <code>alterAnnual = 0.0</code> (binding temporal control totals).</p></dd>

    <dt><code>tolV,tolP</code></dt>
<dd><p>(optional)</p>
<p>Nonnegative real number, or <code>NA</code>, specifying the tolerance, in absolute value or percentage, to be used
when performing the ultimate test in the case of binding totals (alterability coefficient of \(0.0\)
for temporal or cross-sectional control totals). The test compares the input binding control totals with
the ones calculated from the reconciled (output) component series. Arguments <code>tolV</code> and <code>tolP</code> cannot be both
specified together (one must be specified while the other must be <code>NA</code>).</p>
<p><strong>Example:</strong> to set a tolerance of 10 <em>units</em>, specify <code>tolV = 10, tolP = NA</code>; to set a tolerance of 1%,
specify <code>tolV = NA, tolP = 0.01</code>.</p>
<p><strong>Default values</strong> are <code>tolV = 0.001</code> and <code>tolP = NA</code>.</p></dd>

    <dt><code>warnNegResult</code></dt>
<dd><p>(optional)</p>
<p>Logical argument specifying whether a warning message is generated when a negative value created by the
function in the reconciled (output) series is smaller than the threshold specified by argument <code>tolN</code>.</p>
<p><strong>Default value</strong> is <code>warnNegResult = TRUE</code>.</p></dd>

    <dt><code>tolN</code></dt>
<dd><p>(optional)</p>
<p>Negative real number specifying the threshold for the identification of negative values. A value is
considered negative when it is smaller than this threshold.</p>
<p><strong>Default value</strong> is <code>tolN = -0.001</code>.</p></dd>

    <dt><code>id</code></dt>
<dd><p>(optional)</p>
<p>String vector (minimum length of 1), or <code>NULL</code>, specifying the name of additional variables to be transferred
from the input time series data frame (argument <code>data_df</code>) to the output time series data frame, the
object returned by the function (see section <strong>Value</strong>). By default, the output series data frame only contains
the variables listed in the metadata data frame (argument <code>metadata_df</code>).</p>
<p><strong>Default value</strong> is <code>id = NULL</code>.</p></dd>

    <dt><code>verbose</code></dt>
<dd><p>(optional)</p>
<p>Logical argument specifying whether information on intermediate steps with execution time (real time,
not CPU time) should be displayed. Note that specifying argument <code>quiet = TRUE</code> would <em>nullify</em> argument
<code>verbose</code>.</p>
<p><strong>Default value</strong> is <code>verbose = FALSE</code>.</p></dd>

    <dt><code>Vmat_option</code></dt>
<dd><p>(optional)</p>
<p>Specification of the option for the variance matrices (\(V_e\) and \(V_\epsilon\); see section <strong>Details</strong>):</p><table class="table table"><tr><td><strong>Value</strong></td><td><strong>Description</strong></td></tr><tr><td><code>1</code></td><td>Use vectors \(x\) and \(g\) in the variance matrices.</td></tr><tr><td><code>2</code></td><td>Use vectors \(|x|\) and \(|g|\) in the variance matrices.</td></tr></table><p>See Ferland (2016) and subsection <strong>Arguments <code>Vmat_option</code> and <code>warnNegInput</code></strong> in section <strong>Details</strong> for
more information.</p>
<p><strong>Default value</strong> is <code>Vmat_option = 1</code>.</p></dd>

    <dt><code>warnNegInput</code></dt>
<dd><p>(optional)</p>
<p>Logical argument specifying whether a warning message is generated when a negative value smaller than
the threshold specified by argument <code>tolN</code> is found in the input time series data frame (argument <code>data_df</code>).</p>
<p><strong>Default value</strong> is <code>warnNegInput = TRUE</code>.</p></dd>

    <dt><code>quiet</code></dt>
<dd><p>(optional)</p>
<p>Logical argument specifying whether or not to display only essential information such as warnings and errors.
Specifying <code>quiet = TRUE</code> would also <em>nullify</em> argument <code>verbose</code> and is equivalent to <em>wrapping</em> your
<code><a href="tsraking.html">tsraking()</a></code> call with <code><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages()</a></code>.</p>
<p><strong>Default value</strong> is <code>quiet = FALSE</code>.</p></dd>


</dl></dd>


<dt id="arg-temporal-grp-periodicity">temporal_grp_periodicity<a class="anchor" aria-label="anchor" href="#arg-temporal-grp-periodicity"></a></dt>
<dd><p>(optional)</p>
<p>Positive integer defining the number of periods in temporal groups for which the totals should be preserved.
E.g., specify <code>temporal_grp_periodicity = 3</code> with a monthly time series for quarterly total preservation and
<code>temporal_grp_periodicity = 12</code> (or <code>temporal_grp_periodicity = frequency(in_ts)</code>) for annual total preservation.
Specifying <code>temporal_grp_periodicity = 1</code> (<em>default</em>) corresponds to period-by-period processing without
temporal total preservation.</p>
<p><strong>Default value</strong> is <code>temporal_grp_periodicity = 1</code> (period-by-period processing without temporal total preservation).</p></dd>


<dt id="arg-temporal-grp-start">temporal_grp_start<a class="anchor" aria-label="anchor" href="#arg-temporal-grp-start"></a></dt>
<dd><p>(optional)</p>
<p>Integer in the [1 .. <code>temporal_grp_periodicity</code>] interval specifying the starting period (cycle) for temporal
total preservation. E.g., annual totals corresponding to fiscal years defined from April to March of the
following year would be specified with <code>temporal_grp_start = 4</code> for a monthly time series (<code>frequency(in_ts) = 12</code>)
and <code>temporal_grp_start = 2</code> for a quarterly time series (<code>frequency(in_ts) = 4</code>). This argument has no effect
for period-by-period processing without temporal total preservation (<code>temporal_grp_periodicity = 1</code>).</p>
<p><strong>Default value</strong> is <code>temporal_grp_start = 1</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The function returns a time series object ("ts" or "mts") containing the reconciled component series, reconciled
cross-sectional control totals and other series specified with <code><a href="tsraking.html">tsraking()</a></code> argument <code>id</code>. It can be explicitly
coerced to another type of object with the appropriate <code>as*()</code> function (e.g., <code><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html" class="external-link">tsibble::as_tsibble()</a></code> would
coerce it to a tsibble).</p>
<p>Note that a <code>NULL</code> object is returned if an error occurs before data processing could start. Otherwise, if execution
gets far enough so that data processing could start, then an incomplete object (with <code>NA</code> values) would be returned
in case of errors.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function solves one raking problem with <code><a href="tsraking.html">tsraking()</a></code> per processing group (see section <strong>Processing groups</strong> for
details). The mathematical expression of these raking problem can be found in the <strong>Details</strong> section of the <code><a href="tsraking.html">tsraking()</a></code>
documentation.</p>
<p>The alterability coefficients data frame (argument <code>alterability_df</code>) specified with <code>tsraking_driver()</code> can either
contain:</p><ul><li><p>A single observation: the specified coefficients will be used for all periods of input time series object (argument
<code>in_ts</code>).</p></li>
<li><p>A number of observations equal to <code>frequency(in_ts)</code>: the specified coefficients will be used for the
corresponding <em>cycle</em> of the input time series object (argument <code>in_ts</code>) periods. Monthly data example: 1<sup>st</sup>
observation for January, 2<sup>nd</sup> observation for February, etc.).</p></li>
<li><p>A number of observations equal to <code>nrow(in_ts)</code>: the specified coefficients will be used for the corresponding
periods of the input time series object (argument <code>in_ts</code>), i.e., 1<sup>st</sup> observation for the 1<sup>st</sup>
period, 2<sup>nd</sup> observation for the 2<sup>nd</sup> period, etc.).</p></li>
</ul><p>Specifying <code>quiet = TRUE</code> will suppress the <code><a href="tsraking.html">tsraking()</a></code> messages (e.g., function header) and only
display essential information such as warnings, errors and the period (or set of periods) being reconciled.
We advise against <em>wrapping</em> your <code>tsraking_driver()</code> function call with <code><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages()</a></code> to further
suppress the display of the <em>raking period(s)</em> information as this would make troubleshooting difficult
in case of issues with individual raking problems.</p>
<p>Although <code><a href="tsraking.html">tsraking()</a></code> could be called with <code>*apply()</code> to successively reconcile all the periods of the input time
series (<code>in_ts</code>), using <code>tsraking_driver()</code> has a few advantages, namely:</p><ul><li><p>temporal total preservation (only period-by-period processing, without temporal total preservation,
would be possible with <code>*apply()</code>);</p></li>
<li><p>more flexibility in the specification of user-defined alterability coefficients (e.g., period-specific values);</p></li>
<li><p>display of the period being processed (reconciled) in the console, which is useful for troubleshooting individual
raking problems;</p></li>
<li><p>improved error handling, i.e., better management of warnings or errors if they were to occur only for some
raking problems (periods);</p></li>
<li><p>readily returns a "ts" ("mts") object.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="processing-groups">Processing groups<a class="anchor" aria-label="anchor" href="#processing-groups"></a></h2>
    <p>The set of periods of a given reconciliation (raking or balancing) problem is called a <em>processing group</em>
and either corresponds to:</p><ul><li><p>a <strong>single period</strong> with period-by-period processing or, when preserving temporal totals, for the individual
periods of an incomplete temporal group (e.g., an incomplete year)</p></li>
<li><p>or the <strong>set of periods of a complete temporal group</strong> (e.g., a complete year) when preserving temporal
totals.</p></li>
</ul><p>The total number of processing groups (total number of reconciliation problems) depends on the set of
periods in the input time series object (argument <code>in_ts</code>) and on the value of arguments
<code>temporal_grp_periodicity</code> and <code>temporal_grp_start</code>.</p>
<p>Common scenarios include <code>temporal_grp_periodicity = 1</code> (default) for period-by period processing without
temporal total preservation and <code>temporal_grp_periodicity = frequency(in_ts)</code> for the preservation of annual
totals (calendar years by default). Argument <code>temporal_grp_start</code> allows the specification of other types of
(<em>non-calendar</em>) years. E.g., fiscal years starting on April correspond to <code>temporal_grp_start = 4</code> with monthly
data and <code>temporal_grp_start = 2</code> with quarterly data. Preserving quarterly totals with monthly data would
correspond to <code>temporal_grp_periodicity = 3</code>.</p>
<p>By default, temporal groups covering more than a year (i.e., corresponding to <code>temporal_grp_periodicity &gt; frequency(in_ts)</code> start on a
year that is a multiple of <code>
ceiling(temporal_grp_periodicity / frequency(in_ts))</code>. E.g., biennial groups corresponding to <code>temporal_grp_periodicity = 2 * frequency(in_ts)</code>
start on an <em>even year</em> by default. This behaviour can be changed with argument <code>temporal_grp_start</code>. E.g., the
preservation of biennial totals starting on an <em>odd year</em> instead of an <em>even year</em> (default) corresponds to
<code>temporal_grp_start = frequency(in_ts) + 1</code> (along with <code>temporal_grp_periodicity = 2 * frequency(in_ts)</code>).</p>
<p>See the <code><a href="gs.build_proc_grps.html">gs.build_proc_grps()</a></code> <strong>Examples</strong> for common processing group scenarios.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Statistics Canada (2018). "Chapter 6: Advanced topics", <strong>Theory and Application of Reconciliation
(Course code 0437)</strong>, Statistics Canada, Ottawa, Canada.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="tsraking.html">tsraking()</a></code> <code><a href="tsbalancing.html">tsbalancing()</a></code> <code><a href="rkMeta_to_blSpecs.html">rkMeta_to_blSpecs()</a></code> <code><a href="gs.build_proc_grps.html">gs.build_proc_grps()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># 1-dimensional raking problem where the quarterly sales of cars in the 3 prairie</span></span></span>
<span class="r-in"><span><span class="co"># provinces (Alb., Sask. and Man.) for 8 quarters, from 2019 Q2 to 2021 Q1, must</span></span></span>
<span class="r-in"><span><span class="co"># sum up to the total (`cars_tot`).</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Problem metadata</span></span></span>
<span class="r-in"><span><span class="va">my_metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>series <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cars_alb"</span>, <span class="st">"cars_sask"</span>, <span class="st">"cars_man"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                          total1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"cars_tot"</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">my_metadata</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      series   total1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  cars_alb cars_tot</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 cars_sask cars_tot</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  cars_man cars_tot</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Problem data</span></span></span>
<span class="r-in"><span><span class="va">my_series</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ts.html" class="external-link">ts</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">14</span>, <span class="fl">18</span>, <span class="fl">14</span>, <span class="fl">58</span>,</span></span>
<span class="r-in"><span>                         <span class="fl">17</span>, <span class="fl">14</span>, <span class="fl">16</span>, <span class="fl">44</span>,</span></span>
<span class="r-in"><span>                         <span class="fl">14</span>, <span class="fl">19</span>, <span class="fl">18</span>, <span class="fl">58</span>,</span></span>
<span class="r-in"><span>                         <span class="fl">20</span>, <span class="fl">18</span>, <span class="fl">12</span>, <span class="fl">53</span>,</span></span>
<span class="r-in"><span>                         <span class="fl">16</span>, <span class="fl">16</span>, <span class="fl">19</span>, <span class="fl">44</span>,</span></span>
<span class="r-in"><span>                         <span class="fl">14</span>, <span class="fl">15</span>, <span class="fl">16</span>, <span class="fl">50</span>,</span></span>
<span class="r-in"><span>                         <span class="fl">19</span>, <span class="fl">20</span>, <span class="fl">14</span>, <span class="fl">52</span>,</span></span>
<span class="r-in"><span>                         <span class="fl">16</span>, <span class="fl">15</span>, <span class="fl">19</span>, <span class="fl">51</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                       ncol <span class="op">=</span> <span class="fl">4</span>,</span></span>
<span class="r-in"><span>                       byrow <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                       dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cars_alb"</span>, <span class="st">"cars_sask"</span>,</span></span>
<span class="r-in"><span>                                               <span class="st">"cars_man"</span>, <span class="st">"cars_tot"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2019</span>, <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                frequency <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">###########</span></span></span>
<span class="r-in"><span><span class="co"># Example 1: Period-by-period processing without temporal total preservation.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Reconcile the data</span></span></span>
<span class="r-in"><span><span class="va">out_raked1</span> <span class="op">&lt;-</span> <span class="fu">tsraking_driver</span><span class="op">(</span><span class="va">my_series</span>, <span class="va">my_metadata</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Raking period [2019-2]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ======================</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> --- Package gstest 3.0.0 - (EN) 'G-Series' in 'R' | (FR) 'G-Séries' en 'R' ---</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Created on April 8, 2025, at 3:40:01 PM EDT</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> URL: https://ferlmic.github.io/gstest/en/</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>      https://ferlmic.github.io/gstest/fr/</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Email: g-series@statcan.gc.ca</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> tsraking() function:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     data_df         = &lt;argument 'data_df'&gt;</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     metadata_df     = &lt;argument 'metadata_df'&gt;</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterability_df = NULL (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterSeries     = 1 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterTotal1     = 0 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterTotal2     = 0 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterAnnual     = 0 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     tolV            = 0.001 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     warnNegResult   = TRUE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     tolN            = -0.001 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     id              = NULL (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     verbose         = FALSE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)Vmat_option  = 1 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)warnNegInput = TRUE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)quiet        = FALSE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*) indicates new arguments in G-Series 3.0</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Raking period [2019-3]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ======================</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> --- Package gstest 3.0.0 - (EN) 'G-Series' in 'R' | (FR) 'G-Séries' en 'R' ---</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Created on April 8, 2025, at 3:40:01 PM EDT</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> URL: https://ferlmic.github.io/gstest/en/</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>      https://ferlmic.github.io/gstest/fr/</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Email: g-series@statcan.gc.ca</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> tsraking() function:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     data_df         = &lt;argument 'data_df'&gt;</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     metadata_df     = &lt;argument 'metadata_df'&gt;</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterability_df = NULL (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterSeries     = 1 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterTotal1     = 0 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterTotal2     = 0 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterAnnual     = 0 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     tolV            = 0.001 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     warnNegResult   = TRUE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     tolN            = -0.001 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     id              = NULL (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     verbose         = FALSE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)Vmat_option  = 1 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)warnNegInput = TRUE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)quiet        = FALSE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*) indicates new arguments in G-Series 3.0</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Raking period [2019-4]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ======================</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> --- Package gstest 3.0.0 - (EN) 'G-Series' in 'R' | (FR) 'G-Séries' en 'R' ---</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Created on April 8, 2025, at 3:40:01 PM EDT</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> URL: https://ferlmic.github.io/gstest/en/</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>      https://ferlmic.github.io/gstest/fr/</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Email: g-series@statcan.gc.ca</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> tsraking() function:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     data_df         = &lt;argument 'data_df'&gt;</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     metadata_df     = &lt;argument 'metadata_df'&gt;</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterability_df = NULL (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterSeries     = 1 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterTotal1     = 0 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterTotal2     = 0 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterAnnual     = 0 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     tolV            = 0.001 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     warnNegResult   = TRUE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     tolN            = -0.001 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     id              = NULL (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     verbose         = FALSE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)Vmat_option  = 1 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)warnNegInput = TRUE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)quiet        = FALSE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*) indicates new arguments in G-Series 3.0</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Raking period [2020-1]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ======================</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> --- Package gstest 3.0.0 - (EN) 'G-Series' in 'R' | (FR) 'G-Séries' en 'R' ---</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Created on April 8, 2025, at 3:40:01 PM EDT</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> URL: https://ferlmic.github.io/gstest/en/</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>      https://ferlmic.github.io/gstest/fr/</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Email: g-series@statcan.gc.ca</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> tsraking() function:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     data_df         = &lt;argument 'data_df'&gt;</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     metadata_df     = &lt;argument 'metadata_df'&gt;</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterability_df = NULL (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterSeries     = 1 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterTotal1     = 0 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterTotal2     = 0 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterAnnual     = 0 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     tolV            = 0.001 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     warnNegResult   = TRUE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     tolN            = -0.001 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     id              = NULL (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     verbose         = FALSE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)Vmat_option  = 1 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)warnNegInput = TRUE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)quiet        = FALSE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*) indicates new arguments in G-Series 3.0</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Raking period [2020-2]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ======================</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> --- Package gstest 3.0.0 - (EN) 'G-Series' in 'R' | (FR) 'G-Séries' en 'R' ---</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Created on April 8, 2025, at 3:40:01 PM EDT</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> URL: https://ferlmic.github.io/gstest/en/</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>      https://ferlmic.github.io/gstest/fr/</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Email: g-series@statcan.gc.ca</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> tsraking() function:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     data_df         = &lt;argument 'data_df'&gt;</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     metadata_df     = &lt;argument 'metadata_df'&gt;</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterability_df = NULL (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterSeries     = 1 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterTotal1     = 0 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterTotal2     = 0 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterAnnual     = 0 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     tolV            = 0.001 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     warnNegResult   = TRUE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     tolN            = -0.001 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     id              = NULL (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     verbose         = FALSE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)Vmat_option  = 1 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)warnNegInput = TRUE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)quiet        = FALSE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*) indicates new arguments in G-Series 3.0</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Raking period [2020-3]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ======================</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> --- Package gstest 3.0.0 - (EN) 'G-Series' in 'R' | (FR) 'G-Séries' en 'R' ---</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Created on April 8, 2025, at 3:40:01 PM EDT</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> URL: https://ferlmic.github.io/gstest/en/</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>      https://ferlmic.github.io/gstest/fr/</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Email: g-series@statcan.gc.ca</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> tsraking() function:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     data_df         = &lt;argument 'data_df'&gt;</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     metadata_df     = &lt;argument 'metadata_df'&gt;</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterability_df = NULL (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterSeries     = 1 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterTotal1     = 0 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterTotal2     = 0 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterAnnual     = 0 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     tolV            = 0.001 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     warnNegResult   = TRUE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     tolN            = -0.001 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     id              = NULL (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     verbose         = FALSE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)Vmat_option  = 1 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)warnNegInput = TRUE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)quiet        = FALSE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*) indicates new arguments in G-Series 3.0</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Raking period [2020-4]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ======================</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> --- Package gstest 3.0.0 - (EN) 'G-Series' in 'R' | (FR) 'G-Séries' en 'R' ---</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Created on April 8, 2025, at 3:40:01 PM EDT</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> URL: https://ferlmic.github.io/gstest/en/</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>      https://ferlmic.github.io/gstest/fr/</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Email: g-series@statcan.gc.ca</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> tsraking() function:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     data_df         = &lt;argument 'data_df'&gt;</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     metadata_df     = &lt;argument 'metadata_df'&gt;</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterability_df = NULL (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterSeries     = 1 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterTotal1     = 0 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterTotal2     = 0 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterAnnual     = 0 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     tolV            = 0.001 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     warnNegResult   = TRUE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     tolN            = -0.001 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     id              = NULL (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     verbose         = FALSE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)Vmat_option  = 1 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)warnNegInput = TRUE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)quiet        = FALSE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*) indicates new arguments in G-Series 3.0</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Raking period [2021-1]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ======================</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> --- Package gstest 3.0.0 - (EN) 'G-Series' in 'R' | (FR) 'G-Séries' en 'R' ---</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Created on April 8, 2025, at 3:40:01 PM EDT</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> URL: https://ferlmic.github.io/gstest/en/</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>      https://ferlmic.github.io/gstest/fr/</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Email: g-series@statcan.gc.ca</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> tsraking() function:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     data_df         = &lt;argument 'data_df'&gt;</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     metadata_df     = &lt;argument 'metadata_df'&gt;</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterability_df = NULL (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterSeries     = 1 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterTotal1     = 0 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterTotal2     = 0 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     alterAnnual     = 0 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     tolV            = 0.001 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     warnNegResult   = TRUE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     tolN            = -0.001 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     id              = NULL (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     verbose         = FALSE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)Vmat_option  = 1 (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)warnNegInput = TRUE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*)quiet        = FALSE (default)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     (*) indicates new arguments in G-Series 3.0</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Initial data</span></span></span>
<span class="r-in"><span><span class="va">my_series</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         cars_alb cars_sask cars_man cars_tot</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2019 Q2       14        18       14       58</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2019 Q3       17        14       16       44</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2019 Q4       14        19       18       58</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q1       20        18       12       53</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q2       16        16       19       44</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q3       14        15       16       50</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q4       19        20       14       52</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2021 Q1       16        15       19       51</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Reconciled data</span></span></span>
<span class="r-in"><span><span class="va">out_raked1</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         cars_alb cars_sask cars_man cars_tot</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2019 Q2 17.65217  22.69565 17.65217       58</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2019 Q3 15.91489  13.10638 14.97872       44</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2019 Q4 15.92157  21.60784 20.47059       58</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q1 21.20000  19.08000 12.72000       53</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q2 13.80392  13.80392 16.39216       44</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q3 15.55556  16.66667 17.77778       50</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q4 18.64151  19.62264 13.73585       52</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2021 Q1 16.32000  15.30000 19.38000       51</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Check the output cross-sectional constraint</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">out_raked1</span><span class="op">[</span>, <span class="va">my_metadata</span><span class="op">$</span><span class="va">series</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">out_raked1</span><span class="op">[</span>, <span class="st">"cars_tot"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Check the control total (fixed)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">my_series</span><span class="op">[</span>, <span class="st">"cars_tot"</span><span class="op">]</span>, <span class="va">out_raked1</span><span class="op">[</span>, <span class="st">"cars_tot"</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">###########</span></span></span>
<span class="r-in"><span><span class="co"># Example 2: Annual total preservation for year 2020 (period-by-period processing</span></span></span>
<span class="r-in"><span><span class="co">#            for incomplete years 2019 and 2021), with `quiet = TRUE` to avoid</span></span></span>
<span class="r-in"><span><span class="co">#            displaying the function header for all processing groups.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># First, check that the 2020 annual total for the total series (`cars_tot`) and the</span></span></span>
<span class="r-in"><span><span class="co"># sum of the component series (`cars_alb`, `cars_sask` and `cars_man`) matches.</span></span></span>
<span class="r-in"><span><span class="co"># Otherwise, this "grand total" discrepancy would first have to be resolved before</span></span></span>
<span class="r-in"><span><span class="co"># calling `tsraking_driver()`.</span></span></span>
<span class="r-in"><span><span class="va">tot2020</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate.ts</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/window.html" class="external-link">window</a></span><span class="op">(</span><span class="va">my_series</span>, start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2020</span>, <span class="fl">1</span><span class="op">)</span>, end <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2020</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">tot2020</span><span class="op">[</span>, <span class="st">"cars_tot"</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">tot2020</span><span class="op">[</span>, <span class="va">my_metadata</span><span class="op">$</span><span class="va">series</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Reconcile the data</span></span></span>
<span class="r-in"><span><span class="va">out_raked2</span> <span class="op">&lt;-</span> <span class="fu">tsraking_driver</span><span class="op">(</span>in_ts <span class="op">=</span> <span class="va">my_series</span>,</span></span>
<span class="r-in"><span>                              metadata_df <span class="op">=</span> <span class="va">my_metadata</span>,</span></span>
<span class="r-in"><span>                              quiet <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                              temporal_grp_periodicity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/time.html" class="external-link">frequency</a></span><span class="op">(</span><span class="va">my_series</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Raking period [2019-2]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ======================</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Raking period [2019-3]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ======================</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Raking period [2019-4]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ======================</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Raking periods [2020-1 - 2020-4]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ================================</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Raking period [2021-1]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ======================</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Initial data</span></span></span>
<span class="r-in"><span><span class="va">my_series</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         cars_alb cars_sask cars_man cars_tot</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2019 Q2       14        18       14       58</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2019 Q3       17        14       16       44</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2019 Q4       14        19       18       58</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q1       20        18       12       53</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q2       16        16       19       44</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q3       14        15       16       50</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q4       19        20       14       52</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2021 Q1       16        15       19       51</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Reconciled data</span></span></span>
<span class="r-in"><span><span class="va">out_raked2</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         cars_alb cars_sask cars_man cars_tot</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2019 Q2 17.65217  22.69565 17.65217       58</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2019 Q3 15.91489  13.10638 14.97872       44</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2019 Q4 15.92157  21.60784 20.47059       58</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q1 21.15283  19.04513 12.80204       53</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q2 13.74700  13.75373 16.49927       44</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q3 15.50782  16.62184 17.87034       50</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q4 18.59234  19.57931 13.82835       52</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2021 Q1 16.32000  15.30000 19.38000       51</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Check the output cross-sectional constraint</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">out_raked2</span><span class="op">[</span>, <span class="va">my_metadata</span><span class="op">$</span><span class="va">series</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">out_raked2</span><span class="op">[</span>, <span class="st">"cars_tot"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Check the output temporal constraints (2020 annual totals for each series)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">tot2020</span>,</span></span>
<span class="r-in"><span>          <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate.ts</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/window.html" class="external-link">window</a></span><span class="op">(</span><span class="va">out_raked2</span>, start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2020</span>, <span class="fl">1</span><span class="op">)</span>, end <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2020</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Check the control total (fixed)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">my_series</span><span class="op">[</span>, <span class="st">"cars_tot"</span><span class="op">]</span>, <span class="va">out_raked2</span><span class="op">[</span>, <span class="st">"cars_tot"</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">###########</span></span></span>
<span class="r-in"><span><span class="co"># Example 3: Annual total preservation for fiscal years defined from April to March</span></span></span>
<span class="r-in"><span><span class="co">#            (2019Q2-2020Q1 and 2020Q2-2021Q1).</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate the fiscal year totals (as an annual "ts" object)</span></span></span>
<span class="r-in"><span><span class="va">fiscalYr_tot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ts.html" class="external-link">ts</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate.ts</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/window.html" class="external-link">window</a></span><span class="op">(</span><span class="va">my_series</span>,</span></span>
<span class="r-in"><span>                                             start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2019</span>, <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                             end <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2020</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                         <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate.ts</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/window.html" class="external-link">window</a></span><span class="op">(</span><span class="va">my_series</span>,</span></span>
<span class="r-in"><span>                                             start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2020</span>, <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                             end <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2021</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                   start <span class="op">=</span> <span class="fl">2019</span>,</span></span>
<span class="r-in"><span>                   frequency <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Discrepancies in both fiscal year totals (total series vs. sum of the component series)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">fiscalYr_tot</span><span class="op">[</span>, <span class="st">"cars_tot"</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">fiscalYr_tot</span><span class="op">[</span>, <span class="va">my_metadata</span><span class="op">$</span><span class="va">series</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 19 -2</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 3a) Reconcile the fiscal year totals (rake the fiscal year totals of the component series</span></span></span>
<span class="r-in"><span><span class="co">#     to those of the total series).</span></span></span>
<span class="r-in"><span><span class="va">new_fiscalYr_tot</span> <span class="op">&lt;-</span> <span class="fu">tsraking_driver</span><span class="op">(</span>in_ts <span class="op">=</span> <span class="va">fiscalYr_tot</span>,</span></span>
<span class="r-in"><span>                                    metadata_df <span class="op">=</span> <span class="va">my_metadata</span>,</span></span>
<span class="r-in"><span>                                    quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Raking period [2019]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ====================</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Raking period [2020]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ====================</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Confirm that the previous discrepancies are now "gone" (are both zero)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">new_fiscalYr_tot</span><span class="op">[</span>, <span class="st">"cars_tot"</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">new_fiscalYr_tot</span><span class="op">[</span>, <span class="va">my_metadata</span><span class="op">$</span><span class="va">series</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0 0</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 3b) Benchmark the quarterly component series to these new (coherent) fiscal year totals.</span></span></span>
<span class="r-in"><span><span class="va">out_bench</span> <span class="op">&lt;-</span> <span class="fu"><a href="benchmarking.html">benchmarking</a></span><span class="op">(</span>series_df <span class="op">=</span> <span class="fu"><a href="ts_to_tsDF.html">ts_to_tsDF</a></span><span class="op">(</span><span class="va">my_series</span><span class="op">[</span>, <span class="va">my_metadata</span><span class="op">$</span><span class="va">series</span><span class="op">]</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                          benchmarks_df <span class="op">=</span> <span class="fu"><a href="ts_to_bmkDF.html">ts_to_bmkDF</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>                            <span class="va">new_fiscalYr_tot</span><span class="op">[</span>, <span class="va">my_metadata</span><span class="op">$</span><span class="va">series</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                            ind_frequency <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/time.html" class="external-link">frequency</a></span><span class="op">(</span><span class="va">my_series</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                            </span></span>
<span class="r-in"><span>                            <span class="co"># Fiscal years starting on Q2 (April)</span></span></span>
<span class="r-in"><span>                            bmk_interval_start <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                          </span></span>
<span class="r-in"><span>                          rho <span class="op">=</span> <span class="fl">0.729</span>,</span></span>
<span class="r-in"><span>                          lambda <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>                          biasOption <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>                          allCols <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                          quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Benchmarking indicator series [cars_alb] with benchmarks [cars_alb]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> -------------------------------------------------------------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Benchmarking indicator series [cars_sask] with benchmarks [cars_sask]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ---------------------------------------------------------------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Benchmarking indicator series [cars_man] with benchmarks [cars_man]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> -------------------------------------------------------------------</span>
<span class="r-in"><span><span class="va">my_new_ser</span> <span class="op">&lt;-</span> <span class="fu"><a href="tsDF_to_ts.html">tsDF_to_ts</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">out_bench</span><span class="op">$</span><span class="va">series</span>, cars_tot <span class="op">=</span> <span class="va">my_series</span><span class="op">[</span>, <span class="st">"cars_tot"</span><span class="op">]</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                         frequency <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/time.html" class="external-link">frequency</a></span><span class="op">(</span><span class="va">my_series</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 3c) Reconcile the quarterly data with preservation of fiscal year totals.</span></span></span>
<span class="r-in"><span><span class="va">out_raked3</span> <span class="op">&lt;-</span> <span class="fu">tsraking_driver</span><span class="op">(</span>in_ts <span class="op">=</span> <span class="va">my_new_ser</span>,</span></span>
<span class="r-in"><span>                              metadata_df <span class="op">=</span> <span class="va">my_metadata</span>,</span></span>
<span class="r-in"><span>                              temporal_grp_periodicity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/time.html" class="external-link">frequency</a></span><span class="op">(</span><span class="va">my_series</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                              </span></span>
<span class="r-in"><span>                              <span class="co"># Fiscal years starting on Q2 (April)</span></span></span>
<span class="r-in"><span>                              temporal_grp_start <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>                              </span></span>
<span class="r-in"><span>                              quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Raking periods [2019-2 - 2020-1]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ================================</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Raking periods [2020-2 - 2021-1]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ================================</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Initial data</span></span></span>
<span class="r-in"><span><span class="va">my_series</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         cars_alb cars_sask cars_man cars_tot</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2019 Q2       14        18       14       58</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2019 Q3       17        14       16       44</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2019 Q4       14        19       18       58</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q1       20        18       12       53</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q2       16        16       19       44</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q3       14        15       16       50</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q4       19        20       14       52</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2021 Q1       16        15       19       51</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># With coherent fiscal year totals</span></span></span>
<span class="r-in"><span><span class="va">my_new_ser</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         cars_alb cars_sask cars_man cars_tot</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2019 Q2 15.40737  19.84939 15.41097       58</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2019 Q3 18.90614  15.54094 17.78267       44</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2019 Q4 15.45221  20.98489 19.84697       58</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q1 21.60026  19.38252 12.83568       53</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q2 16.44068  16.41619 19.39307       44</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q3 13.91243  14.89512 15.85700       50</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q4 18.49133  19.47043 13.65082       52</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2021 Q1 15.50230  14.55494 18.41569       51</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Reconciled data</span></span></span>
<span class="r-in"><span><span class="va">out_raked3</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         cars_alb cars_sask cars_man cars_tot</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2019 Q2 17.77916  22.53212 17.68872       58</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2019 Q3 16.07232  12.91959 15.00808       44</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2019 Q4 16.06497  21.42285 20.51217       58</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q1 21.44952  18.88317 12.66732       53</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q2 13.84015  13.79962 16.36024       44</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q3 15.57114  16.65292 17.77593       50</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2020 Q4 18.62985  19.59265 13.77750       52</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2021 Q1 16.30560  15.29149 19.40291       51</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Check the output cross-sectional constraint</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">out_raked3</span><span class="op">[</span>, <span class="va">my_metadata</span><span class="op">$</span><span class="va">series</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">out_raked3</span><span class="op">[</span>, <span class="st">"cars_tot"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Check the output temporal constraints (both fiscal year totals for all series)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate.ts</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/window.html" class="external-link">window</a></span><span class="op">(</span><span class="va">my_new_ser</span>, start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2019</span>, <span class="fl">2</span><span class="op">)</span>, end <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2020</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate.ts</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/window.html" class="external-link">window</a></span><span class="op">(</span><span class="va">my_new_ser</span>, start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2020</span>, <span class="fl">2</span><span class="op">)</span>, end <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2021</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>          <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate.ts</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/window.html" class="external-link">window</a></span><span class="op">(</span><span class="va">out_raked3</span>, start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2019</span>, <span class="fl">2</span><span class="op">)</span>, end <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2020</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate.ts</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/window.html" class="external-link">window</a></span><span class="op">(</span><span class="va">out_raked3</span>, start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2020</span>, <span class="fl">2</span><span class="op">)</span>, end <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2021</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Check the control total (fixed)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">my_series</span><span class="op">[</span>, <span class="st">"cars_tot"</span><span class="op">]</span>, <span class="va">out_raked3</span><span class="op">[</span>, <span class="st">"cars_tot"</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michel Ferland, Statistics Canada.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

